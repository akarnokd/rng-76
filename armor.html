<html lang="en">
    <head>
        <title>Fallout 76 Armor Defense Calculator</title>
        <style>
            * {
                font-family: sans-serif;
                font-size: 20px;
            }
            td {
                padding: 1px;
            }

            #table1 td:nth-child(2) {
                padding-left: 15px;
            }

            #table2 td:nth-child(2) {
                padding-left: 15px;
            }
            #enemytable td:nth-child(2) {
                padding-left: 15px;
            }
            #bottom1 td {
                padding-left: 3px;
                padding-right: 3px;
            }
            #bottom2 td {
                padding-left: 3px;
                padding-right: 3px;
            }
            
            table.infoTable {
               border: 1px solid black;
               border-collapse: collapse;
            }
            table.infoTable td {
               border: 1px solid black;
            }
            .halfopaque {
                opacity: 0.3;
                font-weight: bold; 
                font-size: 26px;
            }
            .results {
                font-weight: bold; 
                font-size: 26px;
            }
            .ptr {
                cursor: pointer;
            }
            .num6 {
                width: 90px;
                text-align: right;
            }
            .bold {
                font-weight: bold;
            }
            .center {
                text-align: center;
            }
            .topline {
                border-top: 1px solid black;
            }
            .leftline {
                border-left: 1px solid black;
            }
            .border {
                border: 1px solid black;
            }
            .right {
                text-align: right;
            }
            .footer {
                position: fixed;
                right: 0;
                bottom: 0;
                left: 0;
            }

        </style>
        <meta name="keywords" content="Fallout,Fallout 76,Armor,Damage,Resistance,DR,ER,Reduction,Calculation,Comparison,Comparator">
    </head>
    <body style="height: 90%; overflow-y: scroll;">
        <center>
            <span style="font-size: 36px; font-weight: bold;">Fallout 76 Armor Defense Calculator (0.4.0)</span>
            <br/>
            <!-- <i>(Notification here)</i> -->
        <br/>
        <a href="#enemy">Jump to Enemy setup</a>&nbsp;|&nbsp;<a href="#comparison">Jump to Comparison</a>
        <br/>
        <br/>
        <a name="top"></a>
        <table id="parent" style='width: 100%;'>
            <tr>
                <td style='vertical-align: top;' width='46%' align='right'>
                    <table id="table1" style="border: 1px solid black;">
                        <tr>
                            <td class='bold'>Kind</td>
                            <td>
                                <label class='ptr'><input type="radio" id="NonPA1" name="PA1" value="0"/> Armor</label>
                                &nbsp;&nbsp;&nbsp;&nbsp;
                                <label class='ptr'><input type="radio" id="PA1" name="PA1" value="1"/> Power Armor</label>
                                &nbsp;&nbsp;&nbsp;&nbsp;
                                <label class='ptr'><input type="radio" id="Suit1" name="PA1" value="1"/> Suit</label>
                            </td>
                        </tr>
        
                    </table>            
                </td>
                <td style="padding-left: 20px; padding-right:20px; text-align: center; vertical-align: top; width: 8%; white-space: nowrap;">
                    <button id="copyright" title="Copy Right">&gt;&gt;</button>
                    <br/>
                    <button id="copyleft" title="Copy left">&lt;&lt;</button>
                    <br/>
                    <br/>
                    <br/>
                    <a id='linkleftleft' href="#" title='Link to the left armor' target='_blank'>&lt; Link</a>
                    <br/>
                    <br/>
                    <a id='linkrightright' href="#" title='Link to the right armor' target='_blank'>Link &gt;</a>
                    <br/>
                    <br/>
                    <a id='linkboth' href="#" title='Link to both armor' target='_blank'>&lt; Link &gt;</a>
                    <br/>
                    <br/>
                    <button id="clear" title="Clear" onclick='clearPage(); return false;'>Clear</button>
                </td>
                <td style='vertical-align: top;' width='46%' align='left'>
                    <table id="table2" style="border: 1px solid black;">
                        <tr>
                            <td class='bold'>Kind</td>
                            <td>
                                <label class='ptr'><input type="radio" id="NonPA2" name="PA2" value="0"/> Armor</label>
                                &nbsp;&nbsp;&nbsp;&nbsp;
                                <label class='ptr'><input type="radio" id="PA2" name="PA2" value="1"/> Power Armor</label>
                                &nbsp;&nbsp;&nbsp;&nbsp;
                                <label class='ptr'><input type="radio" id="Suit2" name="PA2" value="1"/> Suit</label>
                            </td>
                        </tr>
        
                    </table>            
                </td>
            </tr>
            <tr>
                <td colspan="3" align='center'>
                    <br/>
                    <a name="enemy"></a>
                    <h2>Enemy <sup>(<a href="#top">Top</a>)</sup></h2>
                    <br/>
                    <table id='enemytable' style='border-collapse: collapse; border: 1px solid black;'>
                        <tr>
                            <td id='enemykindselect'>Kind</td>
                            <td><select id='enemykind'>
                                <option value="Any">Any</option>
                                <option value="Player">Player</option>
                                <option value="Human">Human</option>
                                <option value="SuperMutant">Super Mutant</option>
                                <option value="Animal">Animal</option>
                                <option value="Ghoul">Ghoul</option>
                                <option value="Robot">Robot</option>
                                <option value="Insect">Insect</option>
                                <option value="Mirelurk">Mirelurk</option>
                                <option value="Scorched">Scorched</option>
                            </select></td>
                        </tr>
                        <tr>
                            <td>Damage amount</td>
                            <td>
                                <table style='padding-left: 20px;'>
                                    <tr>
                                        <td>Ballistic</td>
                                        <td><input type="number" class='num6' min='0' maxlength='6' value='100' id='dmgBallistic'></td>
                                        <td>Energy</td>
                                        <td><input type="number" class='num6' min='0' maxlength='6' value='0' id='dmgEnergy'></td>
                                        <td>Radiation</td>
                                        <td><input type="number" class='num6' min='0' maxlength='6' value='0' id='dmgRadiation'></td>
                                    </tr>
                                    <tr>
                                        <td>Fire</td>
                                        <td><input type="number" class='num6' min='0' maxlength='6' value='0' id='dmgFire'></td>
                                        <td>Cryo</td>
                                        <td><input type="number" class='num6' min='0' maxlength='6' value='0' id='dmgCryo'></td>
                                        <td>Poison</td>
                                        <td><input type="number" class='num6' min='0' maxlength='6' value='0' id='dmgPoison'></td>
                                        </tr>
                                        <tr>
                                            <td>Explosive</td>
                                            <td><input type="number" class='num6' min='0' maxlength='6' value='0' id='dmgExplosive'></td>
                                        </tr>
                                    </table>
                            </td>
                        </tr>
                        <!--
                        <tr>
                            <td>Hit rate</td>
                            <td>
                                <input type="number" class='num6' min='0' maxlength='6' value='1' id='hitsPerSecond'> per second
                            </td>
                        </tr>
                        -->
                        <tr>
                            <td>Armor ignore</td>
                            <td>
                                <input type="number" class='num6' min='0' maxlength='6' value='0' id='armorIgnore'> %
                            </td>
                        </tr>
                        <tr>
                            <td id='damagetypemelee'>Damage mode</td>
                            <td>
                                <label class='ptr'><input type='radio' name='dmgType' value='melee' id='dmgTypeMelee'> Melee</label>
                                &nbsp;&nbsp;&nbsp;
                                <label class='ptr'><input type='radio' name='dmgType' value='ranged' id='dmgTypeRanged' checked> Ranged</label>
                            </td>
                        </tr>
                        <tr>
                            <td id="energytypeplasma">Energy damage type</td>
                            <td>
                                <label class='ptr'><input type='radio' name='energyType' value='laser' id='energyTypeLaser' checked> Laser</label>
                                &nbsp;&nbsp;&nbsp;
                                <label class='ptr'><input type='radio' name='energyType' value='plasma' id='energyTypePlasma'> Plasma</label>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td colspan="3" align='center'>
                    <br/>
                    <a name="comparison"></a>
                    <h2>Comparison <sup>(<a href="#top">Top</a>)</sup></h2>
                    <br/>
                    <table id='comparisonTable' class='border' style='border-collapse: collapse;'>
                        <tr>
                            <td class='bold border' colspan='3'>Left</td>
                            <td style='width: 30px;'>&nbsp;</td>
                            <td class='bold border' colspan="3">Right</td>
                        </tr>
                        <tr>
                            <td class='bold border' >Damage type</td>
                            <td class='bold border' >Amount</td>
                            <td class='bold border' >Compare Right</td>
                            <td style='width: 30px;'>&nbsp;</td>
                            <td class='bold border' >Damage type</td>
                            <td class='bold border' >Amount</td>
                            <td class='bold border' >Compare Left</td>
                        </tr>
                    </table>
                </td>
            </tr>
    </table>
    </center>
    <div style='height: 100px;'>&nbsp;</div>
    <div class='footer' style='background-color: #F8F8F8;'>
        <table style='width: 100%'>
            <tr>
                <td width='50%' align='center' style='vertical-align: bottom;'>
                    <br>
                    <table id='bottom1' style='width: 80%; border-collapse: collapse; border: 1px solid black; background-color: #EFEFEF;'>
                        <tr class='bold'>
                            <td rowspan='2'>&#x2316;</td>
                            <td id='dr1' class='right'>0</td>
                            <td rowspan='2' class='leftline'>&#x21AF;</td>
                            <td id='er1' class='right'>0</td>
                            <td rowspan='2' class='leftline'>&#x2622;</td>
                            <td id='rr1' class='right'>0</td>
                            <td rowspan='2' class='leftline'>&#x1F525;</td>
                            <td id='fr1' class='right'>0</td>
                            <td rowspan='2' class='leftline'>&#x2744;</td>
                            <td id='cr1' class='right'>0</td>
                            <td rowspan='2' class='leftline'>&#x1F4A7;</td>
                            <td id='pr1' class='right'>0</td>
                            <td rowspan='2' class='leftline'>&#x1F4A5;</td>
                            <td id='xr1' class='right'>0</td>
                        </tr>
                        <tr class='bold'>
                            <td id='dred1' class='right'>0.00%</td>
                            <td id='ered1' class='right'>0.00%</td>
                            <td id='rred1' class='right'>0.00%</td>
                            <td id='fred1' class='right'>0.00%</td>
                            <td id='cred1' class='right'>0.00%</td>
                            <td id='pred1' class='right'>0.00%</td>
                            <td id='xred1' class='right'>0.00%</td>
                        </tr>
                    </table>
                </td>
                <td width='50%' align='center' style='vertical-align: bottom;'>
                    <br>
                    <table id='bottom2' style='width: 80%; border-collapse: collapse; border: 1px solid black; background-color: #EFEFEF;'>
                        <tr class='bold'>
                            <td rowspan='2'>&#x2316;</td>
                            <td id='dr2' class='right'>0</td>
                            <td rowspan='2' class='leftline'>&#x21AF;</td>
                            <td id='er2' class='right'>0</td>
                            <td rowspan='2' class='leftline'>&#x2622;</td>
                            <td id='rr2' class='right'>0</td>
                            <td rowspan='2' class='leftline'>&#x1F525;</td>
                            <td id='fr2' class='right'>0</td>
                            <td rowspan='2' class='leftline'>&#x2744;</td>
                            <td id='cr2' class='right'>0</td>
                            <td rowspan='2' class='leftline'>&#x1F4A7;</td>
                            <td id='pr2' class='right'>0</td>
                            <td rowspan='2' class='leftline'>&#x1F4A5;</td>
                            <td id='xr2' class='right'>0</td>
                        </tr>
                        <tr class='bold'>
                            <td id='dred2' class='right'>0.00%</td>
                            <td id='ered2' class='right'>0.00%</td>
                            <td id='rred2' class='right'>0.00%</td>
                            <td id='fred2' class='right'>0.00%</td>
                            <td id='cred2' class='right'>0.00%</td>
                            <td id='pred2' class='right'>0.00%</td>
                            <td id='xred2' class='right'>0.00%</td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
    </div>
    <script>
            var infoMap = new Map();

            infoMap.set("suppressorweapon", 
                "Reduce the enemy damage output by 25% for 3 seconds after you attack."
                + "<br>Enable this if the enemy was hit by a weapon having the legendary Suppressor's prefix.");
            infoMap.set("suppressor", 
                "Reduce the enemy damage output by 10%, 20% or 30% for 2 seconds after you attack."
            );
            infoMap.set("health", 
                "Affects the following:"
                + "<ul>"
                + "<li>Bolstering (Legendary mod): more resistances the lower</li>"
                + "<li>Vanguard (Legendary mod): more resistances the higher</li>"
                + "<li>Serendipity (Perk): chance to avoid damage below 30% (Non PA)</li>"
                + "<li>Nerd Rage (Perk): more ballistic resistance below 20%</li>"
                + "</ul>"
            );
            infoMap.set("caps", 
                "Affects the following:"
                + "<ul>"
                + "<li>Aristocrats's (Legendary mod): more resistances the higher</li>"
                + "</ul>"
            );
            infoMap.set("food", 
                "Affects the following:"
                + "<ul>"
                + "<li>Overeater's (Legendary mod): more damage reduction the higher</li>"
                + "</ul>"
            );
            infoMap.set("carry", 
                "Affects the following:"
                + "<ul>"
                + "<li>Heavyweight (Legendary mod): more resistances the higher</li>"
                + "</ul>"
            );
            infoMap.set("teammates", 
                "Affects the following:"
                + "<ul>"
                + "<li>Strange In Numbers (Perk): mutations are 50% stronger if any teammate is also has the same mutation</li>"
                + "<li>Bodyguards (Perk): more resistances the more teammates there are</li>"
                + "<li>Lone Wanderer (Perk): more damage reduction without teammates</li>"
                + "<li>Blood Sacrifice (Perk): more resistances if a teammate has it and dies</li>"
                + "<li>Empath (Mutation): received damage buff or reduction depending on who is mutated in a team</li>"
                + "<li>Live &amp; Love #6 (Magazine): bonus ballistic resistance in team</li>"
                + "</ul>"
            );
            infoMap.set("teamdeaths", 
            "Affects the following:"
                + "<ul>"
                + "<li>Blood Sacrifice (Perk): more resistances if a teammate has it and dies</li>"
                + "</ul>"
            );
            infoMap.set("strength", 
                "Non Power Armor only. Affects the following:"
                + "<ul>"
                + "<li>Barbarian (Perk): more resistances the more strength</li>"
                + "</ul>"
            );
            infoMap.set("guardians", 
                "If nearby allies are equipped with Guardian's legendary armor (4th star),<br>"
                + "each piece grants +10 to Fire, Cold and Poison resistances on you."
            );
            infoMap.set("agility", 
            "Non Power Armor only. Affects the following:"
                + "<ul>"
                + "<li>Evasive (Perk): more resistances the more agility</li>"
                + "</ul>"
            );
            infoMap.set("junkamount", 
            "Non Power Armor only. Affects the following:"
                + "<ul>"
                + "<li>Junk Shield (Perk): more resistances the more pieces of junk</li>"
                + "</ul>"
            );
            infoMap.set("night", 
                "Affects the following:"
                + "<ul>"
                + "<li>Nocturnal (Legendary mod): more resistances at night</li>"
                + "<li>Guns and Bullets #6 (Magazine): more ballistic resistsance at night"
                + "</ul>"
            );
            infoMap.set("blocking", 
                "Affects the following:"
                + "<ul>"
                + "<li>Braced (Misc Mod): more damage reduction when blocking</li>"
                + "<li>-15% DMG while blocking (Legendary Mod)</li>"
                + "</ul>"
            );
            infoMap.set("fireheavy", 
                "Affects the following:"
                + "<ul>"
                + "<li>Bullet Shield (Perk): more damage resistance when firing a heavy gun</li>"
                + "</ul>"
            );
            infoMap.set("sneak", 
                "Affects the following:"
                + "<ul>"
                + "<li>U.S. Covert Ops #1 (Magazine): more ballistic resistance when sneaking</li>"
                + "</ul>"
            );
            infoMap.set("stance", 
                "Affects the following:"
                + "<ul>"
                + "<li>-15% DMG while sprinting (Legendary Mod); 75% chance</li>"
                + "<li>-15% DMG while standing still (Legendary Mod); 75% chance</li>"
                + "<li>Moving Target (Perk): more resistances when sprinting"
                + "</ul>"
            );
            infoMap.set("junkshield", 

                "Non Power Armor only. More resistances the more pieces of junk is carried and the higher the rank:"
                + "<ul>"
                + "<li>1..5 pieces: +1/+2/+3 DR and ER</li>"
                + "<li>6..10 pieces: +2/+4/+6 DR and ER</li>"
                + "<li>11..15 pieces: +3/+6/+9 DR and ER</li>"
                + "<li>16..20 pieces: +4/+8/+12 DR and ER</li>"
                + "<li>21..15 pieces: +5/+10/+15 DR and ER</li>"
                + "<li>26..30 pieces: +6/+12/+18 DR and ER</li>"
                + "<li>31..35 pieces: +7/+14/+21 DR and ER</li>"
                + "<li>36..40 pieces: +8/+16/+24 DR and ER</li>"
                + "<li>41..45 pieces: +9/+18/+27 DR and ER</li>"
                + "<li>46 or more pieces: +10/+20/+30 DR and ER</li>"
                + "</ul>"
            );
            infoMap.set("barbarian", 
                "Non Power Armor only. Each point in strength gives +2/+3/+4 DR up to a maximum of +40/+60/+80 (based on rank)"
            );
            infoMap.set("weaponmode", 
                "Certain legendary weapon mods grant resistances under their activation condition:"
                + "<ul>"
                + "<li>+50 DR while aiming</li>"
                + "<li>+250 DR while reloading</li>"
                + "<li>-40% damage while power attacking</li>"
                + "</ul>"
            );
            infoMap.set("evasive", 
                "Non Power Armor only. Each point in agility gives +1/+2/+3 DR and ER up to a maximum of +15/+30/+45 (based on rank)"
            );
            infoMap.set("ironclad", 
                "Non Power Armor only. Adds +10/+20/+30/+40/+50 DR (based on rank)"
            );
            infoMap.set("movingtarget", 
                "Non Power Armor only. Adds +15/+30/+45 DR and ER while sprinting (based on rank)"
            );
            infoMap.set("serendipity", 
                "Non Power Armor only. Below 30% health, 15%/30%/45% chance to avoid damage (based on rank)"
            );
            infoMap.set("blocker", 
                "Take 15%/30%/45% less damage from melee attacks (based on rank)."
            );
            infoMap.set("bodyguards", 
                "The more teammates (not counting you) the more resistances:"
                + "<ul>"
                + "<li>0 teammates: no bonus</li>"
                + "<li>1 teammate: +6/+8/+10/+12 DR and ER (based on rank)</li>"
                + "<li>2 teammates: +12/+16/+20/+24 DR and ER (based on rank)</li>"
                + "<li>3 teammates: +18/+24/+30/+36 DR and ER (based on rank)</li>"
                + "</ul>"
            );
            infoMap.set("bulletshield", 
                "Gain +20/+40/+60 ballistic resistance while firing a heavy gun (based on rank)"
            );
            infoMap.set("refractor", 
                "Gain +10/+20/+30/+40 energy resistance (based on rank)"
            );
            infoMap.set("dodgy", 
                "Avoid 10%/20%/30% of damage at the cost of 30 Action Points (based on rank)."
            );
            infoMap.set("nerdrage", 
                "Below 20% health, gain +20/+30/+40 ballistic resistance (based on rank)"
            );
            infoMap.set("suppressor", 
                "Reduce the damage output of the enemy you attacked by 10%/20%/30% for some amount of time (based on rank)."
            );
            infoMap.set("lonewanderer", 
                "Gain 10%/15%/20% damage reduction when not in a team (based on rank)"
            );
            infoMap.set("radresistant", 
                "Gain +10/+20/+30/+40 radiation resistance (based on rank)"
            );
            infoMap.set("fireproof", 
                "Reduce fire and explosion damage by 15%/30%/45% (based on rank)"
            );
            infoMap.set("colanut", 
                "Consuming Nuka products are twice or three times as beneficial (based on rank)"
            );
            infoMap.set("partyperson", 
                "Aka Party Boy/Girl. Consuming Alcohol is twice or three times as beneficial (based on rank)"
            );
            infoMap.set("strangeinnumbers", 
                "Positive effects of mutations are 25% stronger if any teammate also has the same mutation:"
                + "<ul>"
                + "<li>Empath: more or less damage reduction depending on who is mutated in a team</li>"
                + "<li>Carnivore (i.e., Food-related): meat-based foods are 2.5 times more beneficial</li>"
                + "<li>Herbivore (i.e., Food-related): plant-based foods are 2.5 times more beneficial</li>"
                + "<li>Grounded: +125 DR and ER</li>"
                + "<li>Scaly skin: +62 DR and ER</li>"
                + "</ul>"
            );
            infoMap.set("classfreak", 
                "Negative effects of mutations are reduced by 25%/50%/75% percent (based on rank). Affects the following mutation:"
                + "<ul>"
                + "<li>Empath: receive about 25%/16%/8% more damage in exchange for teammates to receive less damage</li>"
                + "</ul>"
            );
            infoMap.set("empath", 
                "Receive more or less damage depending on who has the mutation in a team:"
                + "<ul>"
                + "<li>Only you: receive 33% more damage (25%/16%/%8 with Class Freak)</li>"
                + "<li>A teammate: receive 25% less damage.</li>"
                + "<li>Both you and a teammate: receive 8% more damage (receive 0%/9%/17% less damage with Class Freak)"
                + "</ul>"
            );
            infoMap.set("bloodsacrifice", 
                "Gain +25/+30/+35/+40 ballistic resistance when a teammate dies (based on rank)"
            );
            infoMap.set("funkyduds", 
                "Gain +50/+100/+150/+200 poison resistance when wearing a matching set of 5 Armor or 6 Power Armor Pieces (based on rank). Does not work for Suits. A matching set only considers the base make of the armor but not if it's light or heavy. <br>Some headpieces count as full set by themselves, which is most likely a bug and ignored here."
            );
            infoMap.set("sizzlingstyle", 
                "Gain +50/+100/+150/+200 fire resistance when wearing a matching set of 5 Armor or 6 Power Armor Pieces (based on rank). Does not work for Suits. A matching set only considers the base make of the armor but not if it's light or heavy. <br>Some headpieces count as full set by themselves, which is most likely a bug and ignored here."
            );
            infoMap.set("whatrads", 
                "Gain +50/+75/+100/+300 radiation resistance when wearing a matching set of 5 Armor or 6 Power Armor Pieces (based on rank). Does not work for Suits. A matching set only considers the base make of the armor but not if it's light or heavy. <br>Some headpieces count as full set by themselves, which is most likely a bug and ignored here."            
            );
            infoMap.set("foodrelated", 
                "Select one of the mutually exlcusive mutations:"
                + "<ul>"
                + "<li>Carnivore: meat-based foods are 2 times as beneficial (2.5 times with Strange In Numbers perk)</li>"
                + "<li>Herbivore: plant-based foods are 2 times as beneficial (2.5 times with Strange In Numbers perk)</li>"
                + "</ul>"
            );
            infoMap.set("grounded", 
                "Gain 100 energy resistance (125 with Strange In Numbers perk)."
            );
            infoMap.set("scalyskin", 
                "Gain 50 DR and ER (62 with Strange In Numbers perk)"
            );
            infoMap.set("enemykind", 
                "Certain armor mods and consumables grant benefits based on the kind enemy:"
                + "<ul>"
                + "<li>Player: Assassin's (Legendary mod), certain Magazines</li>"
                + "<li>Human: Assassin's (Legendary mod)</li>"
                + "<li>Super Mutant: Mutant Slayer's (Legendary mod)</li>"
                + "<li>Animal: Hunter's (Legendary mod), certain Magazines</li>"
                + "<li>Ghoul: Ghoul Slayer's (Legendary mod)</li>"
                + "<li>Robot: Troubleshooter's (Legendary mod), certain Magazines</li>"
                + "<li>Insect: Exterminator's (Legendary mod), Insect Repellent chem, Scout's Life #6 Magazine</li>"
                + "<li>Mirelurk: Exterminator's (Legendary mod)</li>"
                + "<li>Scorched: Zealot's (Legendary mod), certain Drinks, certain Magazines</li>"
                + "</ul>"                
            );
            infoMap.set("damagetypemelee", 
                "Affects the following:"
                + "<ul>"
                + "<li>Braced (Misc mod): +15% damage reduction from melee attacks</li>"
                + "<li>Blocker (Perk): +15%/+30%/+45% damage reduction from melee attacks</li>"
                + "<li>Unstoppables #4 (Magazine): 30% chance to avoid melee damage</li>"
                + "</ul>"
            );
            infoMap.set("energytypeplasma", 
                "Affects the following:"
                + "<ul>"
                + "<li>Tesla Science #2 (Magazine): 20% less damage from plasma attacks</li>"
                + "</ul>"
            );

            // add HTML explanation marker
            function info(name) {
                return "&nbsp;<sup><a href='#' style='font-size: 14; font-weight: bold;' onclick='showinfo(this, \"" + name + "\"); return false;'>?</a></sup>";
            }

            // popup for explanation
            function showinfo(target, name) {
                var div = document.getElementById("InfoDiv" + name);
                if (div == null) {
                    var div = document.createElement("div");
                    div.style.border = "1px solid black";
                    div.style.padding = "3px";
                    div.style.position = "absolute";
                    div.style.backgroundColor = "#FFFFD0";
                    div.style.zIndex = 99;
                    div.id = "InfoDiv" + name;
                    var txt = infoMap.get(name);

                    if (txt == null) {
                        txt = "??? " + name + " ???";
                    }
                    txt += "<hr><font style='font-size: 14px'>Click to close.</font>";
                    div.innerHTML = txt;

                    target.parentElement.appendChild(div);
                    div.onclick = function() {
                        target.parentElement.removeChild(div);
                    }
                } else {
                    target.parentElement.removeChild(div);
                }
            }

            function createBasePA(drs, ers, rrs, ballRed, enerRed, radRed) {
                return (state, idx) => {
                    state.dr += drs[idx];
                    state.er += ers[idx];
                    state.rr += rrs[idx];
                    
                    var rs = getOrCreateReductionSlot(state, "base");
                    rs.ballisticReduction += ballRed;
                    rs.energyReduction += enerRed;
                    rs.radiationReduction += radRed;
                };
            }
            function createBaseNonPA(drs, ers, rrs, frs, crs, prs) {
                return (state, idx) => {
                    state.dr += drs[idx];
                    state.er += ers[idx];
                    state.rr += rrs[idx];
                    if (frs) {
                        state.fr += frs[idx];
                    }
                    if (crs) {
                        state.cr += crs[idx];
                    }
                    if (prs) {
                        state.pr += prs[idx];
                    }
                };
            }

            var paTorsoEmergencyProtocol = {
                name: "Emergency protocols",
                order: 2,
                func: (state, index) => {
                    if (state.player.hp <= 20) {
                        var rs = getOrCreateReductionSlot(state, "emergency");
                        rs.ballisticReduction += 50;
                        rs.energyReduction += 50;
                    }
                }
            };

            var standardMiscAsbestos = {
                name: "Asbestos Lining",
                order: 1,
                func: (state) => state.er += 15
            };
            var standardMiscDense = {
                name: "Dense",
                order: 1,
                func: (state) => {
                    var rs = getOrCreateReductionSlot(state, "Dense");
                    rs.explosiveReduction += 50;
                }
            };
            var standardMiscLeaded = {
                name: "Lead Lined",
                order: 1,
                func: (state) => state.rr += 10
            };
            var standardMiscPadded = {
                name: "Padded",
                order: 1,
                func: (state) => {
                    var rs = getOrCreateReductionSlot(state, "Padded");
                    rs.explosiveReduction += 25;
                }
            };
            var standardMiscBraced = {
                name: "Braced",
                order: 2,
                func: (state) => {
                    if (state.player.blocking && state.enemy.damageType === "melee") {
                        var rs = getOrCreateReductionSlot(state, "Braced");
                        rs.ballisticReduction += 15;
                        rs.energyReduction += 15;
                    }
                }
            };

            var standardEnclaveTorso = {
                name: "Chest Piece",
                order: 1,
                func: createBaseNonPA([50,60], [33,40], [0,0]),
                mods: {
                    "Main": {
                        "Standard": {
                            name: "Standard",
                            default: true,
                        },
                        "Reinforced": {
                            name: "Reinforced",
                            order: 1,
                            func: createBaseNonPA([12, 15], [5, 7], [0, 0])
                        },
                        "Shadowed": {
                            name: "Shadowed",
                            order: 1,
                            func: createBaseNonPA([13, 15], [5, 7], [0, 0])
                        },
                        "Fiberglass": {
                            name: "Fiberglass",
                            order: 1,
                            func: createBaseNonPA([17, 20], [8, 10], [0, 0])
                        },
                        "Polymer": {
                            name: "Polymer",
                            order: 1,
                            func: createBaseNonPA([21, 25], [12, 15], [0, 0])
                        },
                    },
                    "Misc": {
                        "None": {
                            name: "None",
                            default: true
                        },
                        "Asbestos": standardMiscAsbestos,
                        "Dense": standardMiscDense,
                        "Leaded": standardMiscLeaded,
                        "Padded": standardMiscPadded,
                    }
                }
            };
            var standardEnclaveArm = {
                name: "Left Arm",
                order: 1,
                func: createBaseNonPA([21,25], [17,20], [0,0]),
                mods: {
                    "Main": {
                        "Standard": {
                            name: "Standard",
                            default: true,
                        },
                        "Reinforced": {
                            name: "Reinforced",
                            order: 1,
                            func: createBaseNonPA([10, 12], [4, 5], [0, 0])
                        },
                        "Shadowed": {
                            name: "Shadowed",
                            order: 1,
                            func: createBaseNonPA([10, 12], [4, 5], [0, 0])
                        },
                        "Fiberglass": {
                            name: "Fiberglass",
                            order: 1,
                            func: createBaseNonPA([13, 16], [6, 8], [0, 0])
                        },
                        "Polymer": {
                            name: "Polymer",
                            order: 1,
                            func: createBaseNonPA([16, 20], [8, 10], [0, 0])
                        },
                    },
                    "Misc": {
                        "None": {
                            name: "None",
                            default: true
                        },
                        "Braced": standardMiscBraced,
                        "Leaded": standardMiscLeaded,
                    }
                }
            };
            var standardEnclaveLeg = {
                name: "Left Leg",
                order: 1,
                func: createBaseNonPA([21,25], [17,20], [0, 0]),
                mods: {
                    "Main": {
                        "Standard": {
                            name: "Standard",
                            default: true,
                        },
                        "Reinforced": {
                            name: "Reinforced",
                            order: 1,
                            func: createBaseNonPA([10, 12], [4, 5], [0, 0])
                        },
                        "Shadowed": {
                            name: "Shadowed",
                            order: 1,
                            func: createBaseNonPA([10, 12], [4, 5], [0, 0])
                        },
                        "Fiberglass": {
                            name: "Fiberglass",
                            order: 1,
                            func: createBaseNonPA([13, 16], [6, 8], [0, 0])
                        },
                        "Polymer": {
                            name: "Polymer",
                            order: 1,
                            func: createBaseNonPA([16, 20], [8, 10], [0, 0])
                        },
                    },
                    "Misc": {
                        "None": {
                            name: "None",
                            default: true
                        },
                        "Leaded": standardMiscLeaded,
                    }
                }
            };

            var leatherLevels = [1, 5, 10, 20, 30, 40, 50];
            function curveLinear(xstart, ystart, xend, yend, xs) {
                var result = [];
                for (var x of xs) {
                    if (x <= xstart) {
                        result.push(ystart);
                    }
                    else if (x >= xend) {
                        result.push(yend);
                    } else {
                        var dx = xend - xstart;
                        var dy = yend - ystart;
                        var y = ystart + dy * (x - xstart) / dx;
                        result.push(Math.floor(y));
                    }
                }
                return result;
            }

            // === Leather Common Mods ===
            var leatherTorsoBoiled = {
                name: "Boiled",
                order: 1,
                func: createBaseNonPA(curveLinear(1, 1, 50, 5, leatherLevels), curveLinear(1, 1, 50, 15, leatherLevels), [0,0,0,0,0,0,0])
            };
            var leatherTorsoGirded = {
                name: "Girded",
                order: 1,
                func: createBaseNonPA(curveLinear(1, 1, 50, 10, leatherLevels), curveLinear(1, 2, 50, 20, leatherLevels), [0,0,0,0,0,0,0])
            };
            var leatherTorsoTreated = {
                name: "Treated",
                order: 1,
                func: createBaseNonPA(curveLinear(1, 1, 50, 15, leatherLevels), curveLinear(1, 3, 50, 21, leatherLevels), [0,0,0,0,0,0,0])
            };
            var leatherTorsoStudded = {
                name: "Studded",
                order: 1,
                func: createBaseNonPA(curveLinear(1, 1, 50, 20, leatherLevels), curveLinear(1, 4, 50, 30, leatherLevels), [0,0,0,0,0,0,0])
            };
            var leatherTorsoShadowed = {
                name: "Shadowed",
                order: 1,
                func: createBaseNonPA(curveLinear(1, 1, 50, 5, leatherLevels), curveLinear(1, 1, 50, 15, leatherLevels), [0,0,0,0,0,0,0])
            };

            var leatherLimbBoiled = {
                name: "Boiled",
                order: 1,
                func: createBaseNonPA([1,1,1,1,1,1,1], curveLinear(1, 1, 50, 10, leatherLevels), [0,0,0,0,0,0,0])
            };
            var leatherLimbGirded = {
                name: "Girded",
                order: 1,
                func: createBaseNonPA(curveLinear(1, 1, 50, 5, leatherLevels), curveLinear(1, 2, 50, 13, leatherLevels), [0,0,0,0,0,0,0])
            };
            var leatherLimbTreated = {
                name: "Treated",
                order: 1,
                func: createBaseNonPA(curveLinear(1, 1, 50, 8, leatherLevels), curveLinear(1, 3, 50, 16, leatherLevels), [0,0,0,0,0,0,0])
            };
            var leatherLimbStudded = {
                name: "Studded",
                order: 1,
                func: createBaseNonPA(curveLinear(1, 1, 50, 10, leatherLevels), curveLinear(1, 4, 50, 30, leatherLevels), [0,0,0,0,0,0,0])
            };
            var leatherLimbShadowed = {
                name: "Shadowed",
                order: 1,
                func: createBaseNonPA([1,1,1,1,1,1,1], curveLinear(1, 1, 50, 10, leatherLevels), [0,0,0,0,0,0,0])
            };

            // === Raider Common Mods ===
            var raiderTorsoWelded = {
                name: "Welded",
                order: 1,
                func: createBaseNonPA([3,5,7,9,11],[1,2,3,4,5],[0,0,0,0,0])
            };
            var raiderTorsoTempered = {
                name: "Tempered",
                order: 1,
                func: createBaseNonPA([4,7,9,12,14],[3,5,8,11,13],[0,0,0,0,0])
            };
            var raiderTorsoHardened = {
                name: "Hardened",
                order: 1,
                func: createBaseNonPA([6,9,12,15,18],[3,5,6,7,9],[0,0,0,0,0])
            };
            var raiderTorsoButtressed = {
                name: "Buttressed",
                order: 1,
                func: createBaseNonPA([7,11,15,19,23],[4,6,7,9,11],[0,0,0,0,0])
            };

            var raiderLimbWelded = {
                name: "Welded",
                order: 1,
                func: createBaseNonPA([1,3,5,7,9],[1,2,2,3,4],[0,0,0,0,0])
            };
            var raiderLimbTempered = {
                name: "Tempered",
                order: 1,
                func: createBaseNonPA([2,4,6,8,10],[2,3,3,4,5],[0,0,0,0,0])
            };
            var raiderLimbHardened = {
                name: "Hardened",
                order: 1,
                func: createBaseNonPA([3,5,7,9,11],[3,4,4,5,6],[0,0,0,0,0])
            };
            var raiderLimbButtressed = {
                name: "Buttressed",
                order: 1,
                func: createBaseNonPA([4,6,8,10,12],[4,5,5,6,7],[0,0,0,0,0])
            };

            // === Robot Common Mods ===
            var robotLevels = [10,20,30,40,50];
            var robotTorsoPainted = {
                name: "Painted",
                order: 1,
                func: createBaseNonPA(curveLinear(1,3,50,13, robotLevels),curveLinear(1,1,50,6, robotLevels),
                    [0,0,0,0,0])
            };
            var robotTorsoEnameled = {
                name: "Enameled",
                order: 1,
                func: createBaseNonPA(curveLinear(1,2,50,12, robotLevels),curveLinear(1,2,50,12, robotLevels),
                    curveLinear(1,1,50,6, robotLevels))
            };
            var robotTorsoAlloyed = {
                name: "Alloyed",
                order: 1,
                func: createBaseNonPA(curveLinear(1,3,50,13, robotLevels),curveLinear(1,3,50,13, robotLevels),
                    curveLinear(1,1,50,7, robotLevels))
            };
            var robotTorsoPolished = {
                name: "Polished",
                order: 1,
                func: createBaseNonPA(curveLinear(1,4,50,14, robotLevels),curveLinear(1,4,50,14, robotLevels),
                    curveLinear(1,1,50,8, robotLevels))
            };
            var robotTorsoShadowed = {
                name: "Shadowed",
                order: 1,
                func: createBaseNonPA(curveLinear(1,1,50,10, robotLevels),curveLinear(1,1,50,10, robotLevels),
                    curveLinear(1,1,50,5, robotLevels))
            };

            var robotLimbPainted = {
                name: "Painted",
                order: 1,
                func: createBaseNonPA(curveLinear(1,1,50,10, robotLevels),curveLinear(1,1,50,10, robotLevels),
                    curveLinear(1,1,50,5, robotLevels))
            };
            var robotLimbEnameled = {
                name: "Enameled",
                order: 1,
                func: createBaseNonPA(curveLinear(1,1,50,12, robotLevels),curveLinear(1,1,50,12, robotLevels),
                    curveLinear(1,1,50,6, robotLevels))
            };
            var robotLimbAlloyed = {
                name: "Alloyed",
                order: 1,
                func: createBaseNonPA(curveLinear(1,3,50,13, robotLevels),curveLinear(1,3,50,13, robotLevels),
                    curveLinear(1,1,50,7, robotLevels))
            };
            var robotLimbPolished = {
                name: "Polished",
                order: 1,
                func: createBaseNonPA(curveLinear(1,4,50,14, robotLevels),curveLinear(1,4,50,14, robotLevels),
                    curveLinear(1,1,50,8, robotLevels))
            };
            var robotLimbShadowed = {
                name: "Shadowed",
                order: 1,
                func: createBaseNonPA(curveLinear(1,1,50,10, robotLevels),curveLinear(1,1,50,10, robotLevels),
                    curveLinear(1,1,50,5, robotLevels))
            };

            // === Trapper Common Mods ===
            var trapperLevels = [15,25,35,45];
            var trapperTorsoWelded = {
                name: "Welded",
                order: 1,
                func: createBaseNonPA(curveLinear(1,1,50,10, trapperLevels),curveLinear(1,1,50,5, trapperLevels),
                    curveLinear(1,1,50,10, trapperLevels))
            };
            var trapperTorsoTempered = {
                name: "Tempered",
                order: 1,
                func: createBaseNonPA(curveLinear(1,2,50,13, trapperLevels),curveLinear(1,2,50,6, trapperLevels),
                    curveLinear(1,2,50,13, trapperLevels))
            };
            var trapperTorsoHardened = {
                name: "Hardened",
                order: 1,
                func: createBaseNonPA(curveLinear(1,3,50,15, trapperLevels),curveLinear(1,3,50,7, trapperLevels),
                    curveLinear(1,3,50,15, trapperLevels))
            };
            var trapperTorsoButtressed = {
                name: "Buttressed",
                order: 1,
                func: createBaseNonPA(curveLinear(1,4,50,18, trapperLevels),curveLinear(1,4,50,8, trapperLevels),
                    curveLinear(1,4,50,18, trapperLevels))
            };

            var trapperLimbWelded = {
                name: "Welded",
                order: 1,
                func: createBaseNonPA(curveLinear(1,1,50,10, trapperLevels),curveLinear(1,1,50,5, trapperLevels),
                    curveLinear(1,1,50,5, trapperLevels))
            };
            var trapperLimbTempered = {
                name: "Tempered",
                order: 1,
                func: createBaseNonPA(curveLinear(1,2,50,13, trapperLevels),curveLinear(1,2,50,6, trapperLevels),
                    curveLinear(1,2,50,13, trapperLevels))
            };
            var trapperLimbHardened = {
                name: "Hardened",
                order: 1,
                func: createBaseNonPA(curveLinear(1,3,50,15, trapperLevels),curveLinear(1,3,50,7, trapperLevels),
                    curveLinear(1,3,50,15, trapperLevels))
            };
            var trapperLimbButtressed = {
                name: "Buttressed",
                order: 1,
                func: createBaseNonPA(curveLinear(1,4,50,18, trapperLevels),curveLinear(1,4,50,8, trapperLevels),
                    curveLinear(1,4,50,18, trapperLevels))
            };

            // === Combat Common Mods ===
            var combatLevels = [20,30,40,50];
            var combatTorsoReinforced = {
                name: "Reinforced",
                order: 1,
                func: createBaseNonPA(curveLinear(1,1,50,10, combatLevels),curveLinear(1,1,50,10, combatLevels),
                    [0,0,0,0])
            };
            var combatTorsoFiberglass = {
                name: "Fiberglass",
                order: 1,
                func: createBaseNonPA(curveLinear(1,2,50,15, combatLevels),curveLinear(1,2,50,15, combatLevels),
                    [0,0,0,0])
            };
            var combatTorsoPolymer = {
                name: "Polymer",
                order: 1,
                func: createBaseNonPA(curveLinear(1,3,50,20, combatLevels),curveLinear(1,3,50,20, combatLevels),
                    [0,0,0,0])
            };
            var combatTorsoBOS = {
                name: "Brotherhood of Steel",
                order: 1,
                func: createBaseNonPA(curveLinear(1,4,50,25, combatLevels),curveLinear(1,4,50,25, combatLevels),
                    [0,0,0,0])
            };
            var combatTorsoShadowed = {
                name: "Shadowed",
                order: 1,
                func: createBaseNonPA(curveLinear(1,1,50,10, combatLevels),curveLinear(1,1,50,10, combatLevels),
                    [0,0,0,0])
            };

            var combatLimbReinforced = {
                name: "Reinforced",
                order: 1,
                func: createBaseNonPA(curveLinear(1,1,50,7, combatLevels),curveLinear(1,1,50,7, combatLevels),
                    [0,0,0,0])
            };
            var combatLimbFiberglass = {
                name: "Fiberglass",
                order: 1,
                func: createBaseNonPA(curveLinear(1,3,50,3, combatLevels),curveLinear(1,2,50,10, combatLevels),
                    [0,0,0,0])
            };
            var combatLimbPolymer = {
                name: "Polymer",
                order: 1,
                func: createBaseNonPA(curveLinear(1,3,50,13, combatLevels),curveLinear(1,3,50,13, combatLevels),
                    [0,0,0,0])
            };
            var combatLimbBOS = {
                name: "Brotherhood of Steel",
                order: 1,
                func: createBaseNonPA(curveLinear(1,4,50,15, combatLevels),curveLinear(1,4,50,25, combatLevels),
                    [0,0,0,0])
            };
            var combatLimbShadowed = {
                name: "Shadowed",
                order: 1,
                func: createBaseNonPA(curveLinear(1,1,50,7, combatLevels),curveLinear(1,1,50,7, combatLevels),
                    [0,0,0,0])
            };

            // === Combat Common Mods ===
            var marineLevels = [35,45];
            var marineTorsoWelded = {
                name: "Welded",
                order: 1,
                func: createBaseNonPA(curveLinear(1,3,50,10, marineLevels),curveLinear(1,4,50,10, marineLevels),
                    curveLinear(1,4,50,10, marineLevels))
            };
            var marineTorsoTempered = {
                name: "Tempered",
                order: 1,
                func: createBaseNonPA(curveLinear(1,5,50,15, marineLevels),curveLinear(1,5,50,15, marineLevels),
                    curveLinear(1,5,50,15, marineLevels))
            };
            var marineTorsoHardened = {
                name: "Hardened",
                order: 1,
                func: createBaseNonPA(curveLinear(1,1,50,15, marineLevels),curveLinear(1,6,50,20, marineLevels),
                    curveLinear(1,6,50,20, marineLevels))
            };
            var marineTorsoButtressed = {
                name: "Buttressed",
                order: 1,
                func: createBaseNonPA(curveLinear(1,7,50,25, marineLevels),curveLinear(1,7,50,25, marineLevels),
                    curveLinear(1,7,50,25, marineLevels))
            };

            var marineLimbWelded = {
                name: "Welded",
                order: 1,
                func: createBaseNonPA(curveLinear(1,1,50,6, marineLevels),curveLinear(1,1,50,6, marineLevels),
                    curveLinear(1,1,50,6, marineLevels))
            };
            var marineLimbTempered = {
                name: "Tempered",
                order: 1,
                func: createBaseNonPA(curveLinear(1,2,50,8, marineLevels),curveLinear(1,2,50,8, marineLevels),
                    curveLinear(1,2,50,8, marineLevels))
            };
            var marineLimbHardened = {
                name: "Hardened",
                order: 1,
                func: createBaseNonPA(curveLinear(1,3,50,10, marineLevels),curveLinear(1,3,50,10, marineLevels),
                    curveLinear(1,3,50,10, marineLevels))
            };
            var marineLimbButtressed = {
                name: "Buttressed",
                order: 1,
                func: createBaseNonPA(curveLinear(1,4,50,13, marineLevels),curveLinear(1,4,50,13, marineLevels),
                    curveLinear(1,4,50,13, marineLevels))
            };

            // === Metal Common Mods ===
            var metalLevels = [10,20,30,40,50];
            var metalTorsoPainted = {
                name: "Painted",
                order: 1,
                func: createBaseNonPA(curveLinear(1,5,50,15, metalLevels),curveLinear(1,1,50,3, metalLevels),
                    [0,0,0,0,0])
            };
            var metalTorsoEnameled = {
                name: "Enameled",
                order: 1,
                func: createBaseNonPA(curveLinear(1,6,50,20, metalLevels),curveLinear(1,1,50,4, metalLevels),
                    [0,0,0,0,0])
            };
            var metalTorsoAlloyed = {
                name: "Alloyed",
                order: 1,
                func: createBaseNonPA(curveLinear(1,7,50,25, metalLevels),curveLinear(1,3,50,20, metalLevels),
                    [0,0,0,0,0])
            };
            var metalTorsoPolished = {
                name: "Polished",
                order: 1,
                func: createBaseNonPA(curveLinear(1,8,50,30, metalLevels),curveLinear(1,2,50,6, metalLevels),
                    [0,0,0,0,0])
            };
            var metalTorsoShadowed = {
                name: "Shadowed",
                order: 1,
                func: createBaseNonPA(curveLinear(1,5,50,15, metalLevels),curveLinear(1,1,50,3, metalLevels),
                    [0,0,0,0,0])
            };

            var metalLimbPainted = {
                name: "Painted",
                order: 1,
                func: createBaseNonPA(curveLinear(1,2,50,10, metalLevels),curveLinear(1,1,50,1, metalLevels),
                    [0,0,0,0,0])
            };
            var metalLimbEnameled = {
                name: "Enameled",
                order: 1,
                func: createBaseNonPA(curveLinear(1,3,50,13, metalLevels),curveLinear(1,1,50,2, metalLevels),
                    [0,0,0,0,0])
            };
            var metalLimbAlloyed = {
                name: "Alloyed",
                order: 1,
                func: createBaseNonPA(curveLinear(1,4,50,15, metalLevels),curveLinear(1,1,50,3, metalLevels),
                    [0,0,0,0,0])
            };
            var metalLimbPolished = {
                name: "Polished",
                order: 1,
                func: createBaseNonPA(curveLinear(1,5,50,20, metalLevels),curveLinear(1,1,50,4, metalLevels),
                    [0,0,0,0,0])
            };
            var metalLimbShadowed = {
                name: "Shadowed",
                order: 1,
                func: createBaseNonPA(curveLinear(1,2,50,10, metalLevels),curveLinear(1,1,50,1, metalLevels),
                    [0,0,0,0,0])
            };

            // datasheet
            var armor = {
                "NonPA": {
                    "LeatherLight": {
                        name: "Leather - Light",
                        levels: leatherLevels,
                        category: "Light",
                        "Torso": {
                            name: "Chest Piece",
                            order: 1,
                            func: createBaseNonPA([4, 6, 8, 10, 12, 14, 16], [10, 15, 25, 30,35, 40, 45], [0, 0, 0, 0, 0, 0, 0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Boiled": leatherTorsoBoiled,
                                    "Girded": leatherTorsoGirded,
                                    "Treated": leatherTorsoTreated,
                                    "Studded": leatherTorsoStudded,
                                    "Shadowed": leatherTorsoShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Asbestos": standardMiscAsbestos,
                                    "Leaded": standardMiscLeaded,
                                    "Dense": standardMiscDense,
                                    "Padded": standardMiscPadded
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBaseNonPA([1, 2, 3, 5, 7, 9, 11], [2, 4, 5, 9, 13, 17, 21], [0, 0, 0, 0, 0, 0, 0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Boiled": leatherLimbBoiled,
                                    "Girded": leatherLimbGirded,
                                    "Treated": leatherLimbTreated,
                                    "Studded": leatherLimbStudded,
                                    "Shadowed": leatherLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Braced": standardMiscBraced,
                                    "Leaded": standardMiscLeaded
                                }
                            }
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBaseNonPA([1, 2, 3, 5, 7, 9, 11], [2, 4, 5, 9, 13, 17, 21], [0, 0, 0, 0, 0, 0, 0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Boiled": leatherLimbBoiled,
                                    "Girded": leatherLimbGirded,
                                    "Treated": leatherLimbTreated,
                                    "Studded": leatherLimbStudded,
                                    "Shadowed": leatherLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Leaded": standardMiscLeaded
                                }
                            }
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "LeatherSturdy": {
                        name: "Leather - Sturdy",
                        levels: leatherLevels,
                        category: "Sturdy",
                        "Torso": {
                            name: "Chest Piece",
                            order: 1,
                            func: createBaseNonPA([5,8,11,13,16,18,21], [13,20,32,39,45,52,59], [0, 0, 0, 0, 0, 0, 0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Boiled": leatherTorsoBoiled,
                                    "Girded": leatherTorsoGirded,
                                    "Treated": leatherTorsoTreated,
                                    "Studded": leatherTorsoStudded,
                                    "Shadowed": leatherTorsoShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Asbestos": standardMiscAsbestos,
                                    "Leaded": standardMiscLeaded,
                                    "Dense": standardMiscDense,
                                    "Padded": standardMiscPadded
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBaseNonPA([2, 3, 5, 8, 11, 14, 17], [4,7,11,17,24,30,36], [0, 0, 0, 0, 0, 0, 0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Boiled": leatherLimbBoiled,
                                    "Girded": leatherLimbGirded,
                                    "Treated": leatherLimbTreated,
                                    "Studded": leatherLimbStudded,
                                    "Shadowed": leatherLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Braced": standardMiscBraced,
                                    "Leaded": standardMiscLeaded
                                }
                            }
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBaseNonPA([2,3,5,8,11,14,17], [4,7,11,17,24,30,36], [0, 0, 0, 0, 0, 0, 0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Boiled": leatherLimbBoiled,
                                    "Girded": leatherLimbGirded,
                                    "Treated": leatherLimbTreated,
                                    "Studded": leatherLimbStudded,
                                    "Shadowed": leatherLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Leaded": standardMiscLeaded
                                }
                            }
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "LeatherHeavy": {
                        name: "Leather - Heavy",
                        levels: leatherLevels,
                        category: "Heavy",
                        "Torso": {
                            name: "Chest Piece",
                            order: 1,
                            func: createBaseNonPA([7,11,15,17,21,24,28], [17,26,41,50,58,67,76], [0, 0, 0, 0, 0, 0, 0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Boiled": leatherTorsoBoiled,
                                    "Girded": leatherTorsoGirded,
                                    "Treated": leatherTorsoTreated,
                                    "Studded": leatherTorsoStudded,
                                    "Shadowed": leatherTorsoShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Asbestos": standardMiscAsbestos,
                                    "Leaded": standardMiscLeaded,
                                    "Dense": standardMiscDense,
                                    "Padded": standardMiscPadded
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBaseNonPA([3,4,7,11,15,19,22], [6,9,14,22,31,39,47], [0, 0, 0, 0, 0, 0, 0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Boiled": leatherLimbBoiled,
                                    "Girded": leatherLimbGirded,
                                    "Treated": leatherLimbTreated,
                                    "Studded": leatherLimbStudded,
                                    "Shadowed": leatherLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Braced": standardMiscBraced,
                                    "Leaded": standardMiscLeaded
                                }
                            }
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBaseNonPA([3,4,7,11,15,19,22], [6,9,14,22,31,39,47], [0, 0, 0, 0, 0, 0, 0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Boiled": leatherLimbBoiled,
                                    "Girded": leatherLimbGirded,
                                    "Treated": leatherLimbTreated,
                                    "Studded": leatherLimbStudded,
                                    "Shadowed": leatherLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Leaded": standardMiscLeaded
                                }
                            }
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "SecretService": {
                        name: "Secret Service",
                        levels: [40, 50],
                        category: "Heavy",
                        "Torso": {
                            name: "Chest Piece",
                            order: 1,
                            func: createBaseNonPA([75,90], [50,60], [50,60]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": {
                                        name: "Welded",
                                        order: 1,
                                        func: createBaseNonPA([9, 10], [9, 10], [9, 10])
                                    },
                                    "Tempered": {
                                        name: "Tempered",
                                        order: 1,
                                        func: createBaseNonPA([13,15], [13, 15], [13, 15])
                                    },
                                    "Hardened": {
                                        name: "Hardened",
                                        order: 1,
                                        func: createBaseNonPA([12, 15], [17, 20], [17, 20])
                                    },
                                    "Buttressed": {
                                        name: "Buttressed",
                                        order: 1,
                                        func: createBaseNonPA([22, 25], [22, 25], [22, 25])
                                    }
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Asbestos": standardMiscAsbestos,
                                    "Dense": standardMiscDense,
                                    "Leaded": standardMiscLeaded,
                                    "Padded": standardMiscPadded,
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBaseNonPA([30,40], [30,40], [30,40]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": {
                                        name: "Welded",
                                        order: 1,
                                        func: createBaseNonPA([5, 6], [5, 6], [5, 6])
                                    },
                                    "Tempered": {
                                        name: "Tempered",
                                        order: 1,
                                        func: createBaseNonPA([7, 8], [7, 8], [7, 8])
                                    },
                                    "Hardened": {
                                        name: "Hardened",
                                        order: 1,
                                        func: createBaseNonPA([9, 10], [9, 10], [9, 10])
                                    },
                                    "Buttressed": {
                                        name: "Buttressed",
                                        order: 1,
                                        func: createBaseNonPA([11, 13], [11, 13], [11, 13])
                                    }
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Braced": standardMiscBraced
                                }
                            }
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBaseNonPA([30,40], [30,40], [30,40]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": {
                                        name: "Welded",
                                        order: 1,
                                        func: createBaseNonPA([5, 6], [5, 6], [5, 6])
                                    },
                                    "Tempered": {
                                        name: "Tempered",
                                        order: 1,
                                        func: createBaseNonPA([7, 8], [7, 8], [7, 8])
                                    },
                                    "Hardened": {
                                        name: "Hardened",
                                        order: 1,
                                        func: createBaseNonPA([9, 10], [9, 10], [9, 10])
                                    },
                                    "Buttressed": {
                                        name: "Buttressed",
                                        order: 1,
                                        func: createBaseNonPA([11, 13], [11, 13], [11, 13])
                                    }
                                },
                            }
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "RaiderLight": {
                        name: "Raider - Light",
                        levels: [5,15,25,35,45],
                        category: "Light",
                        "Torso": {
                            name: "Chest Piece",
                            order: 1,
                            func: createBaseNonPA([10, 18, 26, 34, 42], [4, 6, 9, 12, 15], [0, 0, 0, 0, 0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": raiderTorsoWelded,
                                    "Tempered": raiderTorsoTempered,
                                    "Hardened": raiderTorsoHardened,
                                    "Buttressed": raiderTorsoButtressed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Asbestos": standardMiscAsbestos,
                                    "Dense": standardMiscDense,
                                    "Leaded": standardMiscLeaded,
                                    "Padded": standardMiscPadded,
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBaseNonPA([5, 8, 11, 14, 17], [2, 3, 4, 7, 8], [0, 0, 0, 0, 0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": raiderLimbWelded,
                                    "Tempered": raiderLimbTempered,
                                    "Hardened": raiderLimbHardened,
                                    "Buttressed": raiderLimbButtressed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Braced": standardMiscBraced,
                                    "Leaded": standardMiscLeaded,
                                }
                            }
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBaseNonPA([5, 8, 11, 14, 17], [2, 3, 4, 7, 8], [0, 0, 0, 0, 0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": raiderLimbWelded,
                                    "Tempered": raiderLimbTempered,
                                    "Hardened": raiderLimbHardened,
                                    "Buttressed": raiderLimbButtressed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Leaded": standardMiscLeaded,
                                }
                            }
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "RaiderSturdy": {
                        name: "Raider - Sturdy",
                        levels: [5,15,25,35,45],
                        category: "Sturdy",
                        "Torso": {
                            name: "Chest Piece",
                            order: 1,
                            func: createBaseNonPA([13, 24, 34, 44, 54], [6, 8, 11, 15, 19], [0, 0, 0, 0, 0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": raiderTorsoWelded,
                                    "Tempered": raiderTorsoTempered,
                                    "Hardened": raiderTorsoHardened,
                                    "Buttressed": raiderTorsoButtressed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Asbestos": standardMiscAsbestos,
                                    "Dense": standardMiscDense,
                                    "Leaded": standardMiscLeaded,
                                    "Padded": standardMiscPadded,
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBaseNonPA([7, 10, 14, 18, 22], [3, 5, 6, 9, 10], [0, 0, 0, 0, 0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": raiderLimbWelded,
                                    "Tempered": raiderLimbTempered,
                                    "Hardened": raiderLimbHardened,
                                    "Buttressed": raiderLimbButtressed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Braced": standardMiscBraced,
                                    "Leaded": standardMiscLeaded,
                                }
                            }
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBaseNonPA([7, 10, 14, 18, 22], [3, 5, 6, 9, 10], [0, 0, 0, 0, 0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": raiderLimbWelded,
                                    "Tempered": raiderLimbTempered,
                                    "Hardened": raiderLimbHardened,
                                    "Buttressed": raiderLimbButtressed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Leaded": standardMiscLeaded,
                                }
                            }
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "RaiderHeavy": {
                        name: "Raider - Heavy",
                        levels: [5,15,25,35,45],
                        category: "Heavy",
                        "Torso": {
                            name: "Chest Piece",
                            order: 1,
                            func: createBaseNonPA([17, 32, 44, 57, 70], [8, 11, 14, 19, 24], [0, 0, 0, 0, 0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": raiderTorsoWelded,
                                    "Tempered": raiderTorsoTempered,
                                    "Hardened": raiderTorsoHardened,
                                    "Buttressed": raiderTorsoButtressed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Asbestos": standardMiscAsbestos,
                                    "Dense": standardMiscDense,
                                    "Leaded": standardMiscLeaded,
                                    "Padded": standardMiscPadded,
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBaseNonPA([9, 13, 18, 23, 28], [4, 6, 8, 11, 13], [0, 0, 0, 0, 0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": raiderLimbWelded,
                                    "Tempered": raiderLimbTempered,
                                    "Hardened": raiderLimbHardened,
                                    "Buttressed": raiderLimbButtressed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Braced": standardMiscBraced,
                                    "Leaded": standardMiscLeaded,
                                }
                            }
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBaseNonPA([9, 13, 18, 23, 28], [4, 6, 8, 11, 13], [0, 0, 0, 0, 0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": raiderLimbWelded,
                                    "Tempered": raiderLimbTempered,
                                    "Hardened": raiderLimbHardened,
                                    "Buttressed": raiderLimbButtressed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Leaded": standardMiscLeaded,
                                }
                            }
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "RobotLight": {
                        name: "Robot - Light",
                        levels: robotLevels,
                        category: "Light",
                        "Torso": {
                            name: "Chest Piece",
                            order: 1,
                            func: createBaseNonPA([8, 12, 16, 20, 24], [8, 12, 16, 20, 24], [5, 7, 9, 11, 13]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Painted": robotTorsoPainted,
                                    "Enameled": robotTorsoEnameled,
                                    "Alloyed": robotTorsoAlloyed,
                                    "Polished": robotTorsoPolished,
                                    "Shadowed": robotTorsoShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Asbestos": standardMiscAsbestos,
                                    "Dense": standardMiscDense,
                                    "Leaded": standardMiscLeaded,
                                    "Padded": standardMiscPadded,
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBaseNonPA([3, 5, 7, 9, 10], [3, 5, 7, 9, 10], [3, 5, 7, 9, 10]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Painted": robotLimbPainted,
                                    "Enameled": robotLimbEnameled,
                                    "Alloyed": robotLimbAlloyed,
                                    "Polished": robotLimbPolished,
                                    "Shadowed": robotLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Braced": standardMiscBraced,
                                    "Leaded": standardMiscLeaded,
                                }
                            }
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBaseNonPA([3, 5, 7, 9, 10], [3, 5, 7, 9, 10], [3, 5, 7, 9, 10]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Painted": robotLimbPainted,
                                    "Enameled": robotLimbEnameled,
                                    "Alloyed": robotLimbAlloyed,
                                    "Polished": robotLimbPolished,
                                    "Shadowed": robotLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Leaded": standardMiscLeaded,
                                }
                            }
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "RobotSturdy": {
                        name: "Robot - Sturdy",
                        levels: robotLevels,
                        category: "Sturdy",
                        "Torso": {
                            name: "Chest Piece",
                            order: 1,
                            func: createBaseNonPA([11, 16, 21, 26, 32], [11, 16, 21, 26, 32], [7, 9, 11, 13, 15]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Painted": robotTorsoPainted,
                                    "Enameled": robotTorsoEnameled,
                                    "Alloyed": robotTorsoAlloyed,
                                    "Polished": robotTorsoPolished,
                                    "Shadowed": robotTorsoShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Asbestos": standardMiscAsbestos,
                                    "Dense": standardMiscDense,
                                    "Leaded": standardMiscLeaded,
                                    "Padded": standardMiscPadded,
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBaseNonPA([5, 7, 9, 12, 13], [3, 5, 6, 9, 10], [5, 7, 9, 12, 13]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Painted": robotLimbPainted,
                                    "Enameled": robotLimbEnameled,
                                    "Alloyed": robotLimbAlloyed,
                                    "Polished": robotLimbPolished,
                                    "Shadowed": robotLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Braced": standardMiscBraced,
                                    "Leaded": standardMiscLeaded,
                                }
                            }
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBaseNonPA([5, 7, 9, 12, 13], [3, 5, 6, 9, 10], [5, 7, 9, 12, 13]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Painted": robotLimbPainted,
                                    "Enameled": robotLimbEnameled,
                                    "Alloyed": robotLimbAlloyed,
                                    "Polished": robotLimbPolished,
                                    "Shadowed": robotLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Leaded": standardMiscLeaded,
                                }
                            }
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "RobotHeavy": {
                        name: "Robot - Heavy",
                        levels: robotLevels,
                        category: "Heavy",
                        "Torso": {
                            name: "Chest Piece",
                            order: 1,
                            func: createBaseNonPA([14, 16, 27, 34, 42], [14, 16, 27, 34, 42], [7, 9, 11, 13, 15]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Painted": robotTorsoPainted,
                                    "Enameled": robotTorsoEnameled,
                                    "Alloyed": robotTorsoAlloyed,
                                    "Polished": robotTorsoPolished,
                                    "Shadowed": robotTorsoShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Asbestos": standardMiscAsbestos,
                                    "Dense": standardMiscDense,
                                    "Leaded": standardMiscLeaded,
                                    "Padded": standardMiscPadded,
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBaseNonPA([7, 9, 12, 15, 17], [7, 9, 12, 15, 17], [7, 9, 11, 13, 15]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Painted": robotLimbPainted,
                                    "Enameled": robotLimbEnameled,
                                    "Alloyed": robotLimbAlloyed,
                                    "Polished": robotLimbPolished,
                                    "Shadowed": robotLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Braced": standardMiscBraced,
                                    "Leaded": standardMiscLeaded,
                                }
                            }
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBaseNonPA([7, 9, 12, 15, 17], [7, 9, 12, 15, 17], [7, 9, 11, 13, 15]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Painted": robotLimbPainted,
                                    "Enameled": robotLimbEnameled,
                                    "Alloyed": robotLimbAlloyed,
                                    "Polished": robotLimbPolished,
                                    "Shadowed": robotLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Leaded": standardMiscLeaded,
                                }
                            }
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "Trapper": {
                        name: "Trapper",
                        levels: trapperLevels,
                        category: "Light",
                        "Torso": {
                            name: "Chest Piece",
                            order: 1,
                            func: createBaseNonPA([14, 20, 26, 32], [7, 9, 12, 14], [14, 20, 26, 32]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": trapperTorsoWelded,
                                    "Tempered": trapperTorsoTempered,
                                    "Hardened": trapperTorsoHardened,
                                    "Buttressed": trapperTorsoButtressed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Asbestos": standardMiscAsbestos,
                                    "Dense": standardMiscDense,
                                    "Leaded": standardMiscLeaded,
                                    "Padded": standardMiscPadded,
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBaseNonPA([6, 9, 12, 14], [4, 6, 8, 10], [6, 9, 12, 14]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": trapperLimbWelded,
                                    "Tempered": trapperLimbTempered,
                                    "Hardened": trapperLimbHardened,
                                    "Buttressed": trapperLimbButtressed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Braced": standardMiscBraced,
                                    "Leaded": standardMiscLeaded,
                                }
                            }
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBaseNonPA([6, 9, 12, 14], [4, 6, 8, 10], [6, 9, 12, 14]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": trapperLimbWelded,
                                    "Tempered": trapperLimbTempered,
                                    "Hardened": trapperLimbHardened,
                                    "Buttressed": trapperLimbButtressed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Leaded": standardMiscLeaded,
                                }
                            }
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "CombatLight": {
                        name: "Combat - Light",
                        levels: [20,30,40,50],
                        category: "Light",
                        "Torso": {
                            name: "Chest Piece",
                            order: 1,
                            func: createBaseNonPA([16,25,30,36], [16,25,30,36], [0,0,0,0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Reinforced": combatTorsoReinforced,
                                    "Fiberglass": combatTorsoFiberglass,
                                    "Polymer": combatTorsoPolymer,
                                    "BOS": combatTorsoBOS,
                                    "Shadowed": combatTorsoShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Asbestos": standardMiscAsbestos,
                                    "Dense": standardMiscDense,
                                    "Leaded": standardMiscLeaded,
                                    "Padded": standardMiscPadded,
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBaseNonPA([6,8,10,12], [6,8,10,12], [0,0,0,0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Reinforced": combatLimbReinforced,
                                    "Fiberglass": combatLimbFiberglass,
                                    "Polymer": combatLimbPolymer,
                                    "BOS": combatLimbBOS,
                                    "Shadowed": combatLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Braced": standardMiscBraced,
                                    "Leaded": standardMiscLeaded
                                }
                            }
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBaseNonPA([6,8,10,12], [6,8,10,12], [0,0,0,0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Reinforced": combatLimbReinforced,
                                    "Fiberglass": combatLimbFiberglass,
                                    "Polymer": combatLimbPolymer,
                                    "BOS": combatLimbBOS,
                                    "Shadowed": combatLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Leaded": standardMiscLeaded
                                }
                            }
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "CombatSturdy": {
                        name: "Combat - Sturdy",
                        levels: [20,30,40,50],
                        category: "Sturdy",
                        "Torso": {
                            name: "Chest Piece",
                            order: 1,
                            func: createBaseNonPA([21,33,40,47], [21,33,40,47], [0,0,0,0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Reinforced": combatTorsoReinforced,
                                    "Fiberglass": combatTorsoFiberglass,
                                    "Polymer": combatTorsoPolymer,
                                    "BOS": combatTorsoBOS,
                                    "Shadowed": combatTorsoShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Asbestos": standardMiscAsbestos,
                                    "Dense": standardMiscDense,
                                    "Leaded": standardMiscLeaded,
                                    "Padded": standardMiscPadded,
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBaseNonPA([8,11,13,15], [8,11,13,15], [0,0,0,0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Reinforced": combatLimbReinforced,
                                    "Fiberglass": combatLimbFiberglass,
                                    "Polymer": combatLimbPolymer,
                                    "BOS": combatLimbBOS,
                                    "Shadowed": combatLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Braced": standardMiscBraced,
                                    "Leaded": standardMiscLeaded
                                }
                            }
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBaseNonPA([8,11,13,15], [8,11,13,15], [0,0,0,0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Reinforced": combatLimbReinforced,
                                    "Fiberglass": combatLimbFiberglass,
                                    "Polymer": combatLimbPolymer,
                                    "BOS": combatLimbBOS,
                                    "Shadowed": combatLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Leaded": standardMiscLeaded
                                }
                            }
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "CombatHeavy": {
                        name: "Combat - Heavy",
                        levels: [20,30,40,50],
                        category: "Heavy",
                        "Torso": {
                            name: "Chest Piece",
                            order: 1,
                            func: createBaseNonPA([27,43,52,61], [27,43,52,61], [0,0,0,0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Reinforced": combatTorsoReinforced,
                                    "Fiberglass": combatTorsoFiberglass,
                                    "Polymer": combatTorsoPolymer,
                                    "BOS": combatTorsoBOS,
                                    "Shadowed": combatTorsoShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Asbestos": standardMiscAsbestos,
                                    "Dense": standardMiscDense,
                                    "Leaded": standardMiscLeaded,
                                    "Padded": standardMiscPadded,
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBaseNonPA([11,14,17,20], [11,14,17,20], [0,0,0,0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Reinforced": combatLimbReinforced,
                                    "Fiberglass": combatLimbFiberglass,
                                    "Polymer": combatLimbPolymer,
                                    "BOS": combatLimbBOS,
                                    "Shadowed": combatLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Braced": standardMiscBraced,
                                    "Leaded": standardMiscLeaded
                                }
                            }
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBaseNonPA([11,14,17,20], [11,14,17,20], [0,0,0,0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Reinforced": combatLimbReinforced,
                                    "Fiberglass": combatLimbFiberglass,
                                    "Polymer": combatLimbPolymer,
                                    "BOS": combatLimbBOS,
                                    "Shadowed": combatLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Leaded": standardMiscLeaded
                                }
                            }
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "Marine": {
                        name: "Marine",
                        levels: marineLevels,
                        category: "Sturdy",
                        "Torso": {
                            name: "Chest Piece",
                            order: 1,
                            func: createBaseNonPA([37,46], [16,19], [16,19]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": marineTorsoWelded,
                                    "Tempered": marineTorsoTempered,
                                    "Hardened": marineTorsoHardened,
                                    "Buttressed": marineTorsoButtressed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Asbestos": standardMiscAsbestos,
                                    "Dense": standardMiscDense,
                                    "Leaded": standardMiscLeaded,
                                    "Padded": standardMiscPadded,
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBaseNonPA([16,19], [11,14], [0,0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": marineLimbWelded,
                                    "Tempered": marineLimbTempered,
                                    "Hardened": marineLimbHardened,
                                    "Buttressed": marineLimbButtressed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Braced": standardMiscBraced,
                                    "Leaded": standardMiscLeaded,
                                }
                            }
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBaseNonPA([16,19], [11,14], [0,0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": marineLimbWelded,
                                    "Tempered": marineLimbTempered,
                                    "Hardened": marineLimbHardened,
                                    "Buttressed": marineLimbButtressed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Leaded": standardMiscLeaded,
                                }
                            }
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "MetalLight": {
                        name: "Metal - Light",
                        levels: metalLevels,
                        category: "Light",
                        "Torso": {
                            name: "Chest Piece",
                            order: 1,
                            func: createBaseNonPA([20,24,33,42,51], [3,5,7,9,11], [0,0,0,0,0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Painted": metalTorsoPainted,
                                    "Enameled": metalTorsoEnameled,
                                    "Alloyed": metalTorsoAlloyed,
                                    "Polished": metalTorsoPolished,
                                    "Shadowed": metalTorsoShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Asbestos": standardMiscAsbestos,
                                    "Dense": standardMiscDense,
                                    "Leaded": standardMiscLeaded,
                                    "Padded": standardMiscPadded,
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBaseNonPA([8,12,16,18,20], [1,2,3,4,5], [0,0,0,0,0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Painted": metalLimbPainted,
                                    "Enameled": metalLimbEnameled,
                                    "Alloyed": metalLimbAlloyed,
                                    "Polished": metalLimbPolished,
                                    "Shadowed": metalLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Braced": standardMiscBraced,
                                    "Leaded": standardMiscLeaded,
                                }
                            }
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBaseNonPA([8,12,16,18,20], [1,2,3,4,5], [0,0,0,0,0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Painted": metalLimbPainted,
                                    "Enameled": metalLimbEnameled,
                                    "Alloyed": metalLimbAlloyed,
                                    "Polished": metalLimbPolished,
                                    "Shadowed": metalLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Leaded": standardMiscLeaded,
                                }
                            }
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "MetalSturdy": {
                        name: "Metal - Sturdy",
                        levels: metalLevels,
                        category: "Sturdy",
                        "Torso": {
                            name: "Chest Piece",
                            order: 1,
                            func: createBaseNonPA([26,32,43,55,67], [4,7,9,11,13], [0,0,0,0,0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Painted": metalTorsoPainted,
                                    "Enameled": metalTorsoEnameled,
                                    "Alloyed": metalTorsoAlloyed,
                                    "Polished": metalTorsoPolished,
                                    "Shadowed": metalTorsoShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Asbestos": standardMiscAsbestos,
                                    "Dense": standardMiscDense,
                                    "Leaded": standardMiscLeaded,
                                    "Padded": standardMiscPadded,
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBaseNonPA([11,16,21,24,26], [2,3,4,5,6], [0,0,0,0,0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Painted": metalLimbPainted,
                                    "Enameled": metalLimbEnameled,
                                    "Alloyed": metalLimbAlloyed,
                                    "Polished": metalLimbPolished,
                                    "Shadowed": metalLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Braced": standardMiscBraced,
                                    "Leaded": standardMiscLeaded,
                                }
                            }
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBaseNonPA([11,16,21,24,26], [2,3,4,5,6], [0,0,0,0,0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Painted": metalLimbPainted,
                                    "Enameled": metalLimbEnameled,
                                    "Alloyed": metalLimbAlloyed,
                                    "Polished": metalLimbPolished,
                                    "Shadowed": metalLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Leaded": standardMiscLeaded,
                                }
                            }
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "MetalHeavy": {
                        name: "Metal - Heavy",
                        levels: metalLevels,
                        category: "Heavy",
                        "Torso": {
                            name: "Chest Piece",
                            order: 1,
                            func: createBaseNonPA([34,42,56,72,87], [4,7,10,12,14], [0,0,0,0,0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Painted": metalTorsoPainted,
                                    "Enameled": metalTorsoEnameled,
                                    "Alloyed": metalTorsoAlloyed,
                                    "Polished": metalTorsoPolished,
                                    "Shadowed": metalTorsoShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Asbestos": standardMiscAsbestos,
                                    "Dense": standardMiscDense,
                                    "Leaded": standardMiscLeaded,
                                    "Padded": standardMiscPadded,
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBaseNonPA([14,20,27,32,34], [3,4,6,7,8], [0,0,0,0,0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Painted": metalLimbPainted,
                                    "Enameled": metalLimbEnameled,
                                    "Alloyed": metalLimbAlloyed,
                                    "Polished": metalLimbPolished,
                                    "Shadowed": metalLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Braced": standardMiscBraced,
                                    "Leaded": standardMiscLeaded,
                                }
                            }
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBaseNonPA([14,20,27,32,34], [3,4,6,7,8], [0,0,0,0,0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Painted": metalLimbPainted,
                                    "Enameled": metalLimbEnameled,
                                    "Alloyed": metalLimbAlloyed,
                                    "Polished": metalLimbPolished,
                                    "Shadowed": metalLimbShadowed,
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Leaded": standardMiscLeaded,
                                }
                            }
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "Wood": {
                        name: "Wood",
                        levels: [1,5,15,25,35,45],
                        category: "Light",
                        "Torso": {
                            name: "Chest Piece",
                            order: 1,
                            func: createBaseNonPA([7,12,19,28,37,45], [3,4,6,7,8,9], [0,0,0,0,0,0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    }
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    }
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBaseNonPA([2,4,9,14,18,22], [1,2,3,4,5,6], [0,0,0,0,0,0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    }
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    }
                                }
                            }
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBaseNonPA([2,4,9,14,18,22], [1,2,3,4,5,6], [0,0,0,0,0,0]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    }
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    }
                                }
                            }
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "Forest": {
                        name: "Forest Scout",
                        levels: [40,50],
                        category: "Sturdy",
                        set: "Scout",
                        "Torso": standardEnclaveTorso,
                        "LA": standardEnclaveArm,
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": standardEnclaveLeg,
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "Urban": {
                        name: "Urban Scout",
                        levels: [40,50],
                        category: "Sturdy",
                        set: "Scout",
                        "Torso": standardEnclaveTorso,
                        "LA": standardEnclaveArm,
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": standardEnclaveLeg,
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "Solar": {
                        name: "Solar",
                        levels: [40,50],
                        category: "Sturdy",
                        "Torso": standardEnclaveTorso,
                        "LA": standardEnclaveArm,
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": standardEnclaveLeg,
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "Thorn": {
                        name: "Thorn",
                        levels: [40,50],
                        category: "Sturdy",
                        "Torso": standardEnclaveTorso,
                        "LA": standardEnclaveArm,
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": standardEnclaveLeg,
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "Covert": {
                        name: "Covert Scout",
                        levels: [40,50],
                        category: "Sturdy",
                        set: "Scout",
                        "Torso": standardEnclaveTorso,
                        "LA": standardEnclaveArm,
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": standardEnclaveLeg,
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "Broderhood": {
                        name: "Brotherhood Recon",
                        levels: [40,50],
                        category: "Heavy",
                        "Torso": {
                            name: "Chest Piece",
                            order: 1,
                            func: createBaseNonPA([85,100], [30,40], [30,40]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": {
                                        name: "Welded",
                                        order: 1,
                                        func: createBaseNonPA([9,10], [9,10], [9,10])
                                    },
                                    "Tempered": {
                                        name: "Tempered",
                                        order: 1,
                                        func: createBaseNonPA([13,15], [13,15], [13,15])
                                    },
                                    "Hardened": {
                                        name: "Hardened",
                                        order: 1,
                                        func: createBaseNonPA([13,15], [17,20], [17,20])
                                    },
                                    "Buttressed": {
                                        name: "Buttressed",
                                        order: 1,
                                        func: createBaseNonPA([21,25], [21,25], [21,25])
                                    },
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Asbestos": standardMiscAsbestos,
                                    "Leaded": standardMiscLeaded,
                                    "Dense": standardMiscDense,
                                    "Padded": standardMiscPadded
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBaseNonPA([40,50], [20,30], [20,30]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": {
                                        name: "Welded",
                                        order: 1,
                                        func: createBaseNonPA([5,6], [5,6], [5,6])
                                    },
                                    "Tempered": {
                                        name: "Tempered",
                                        order: 1,
                                        func: createBaseNonPA([7,8], [7,8], [7,8])
                                    },
                                    "Hardened": {
                                        name: "Hardened",
                                        order: 1,
                                        func: createBaseNonPA([9,10], [9,10], [9,10])
                                    },
                                    "Buttressed": {
                                        name: "Buttressed",
                                        order: 1,
                                        func: createBaseNonPA([11,13], [11,13], [11,13])
                                    },
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Braced": standardMiscBraced,
                                    "Leaded": standardMiscLeaded
                                }
                            }
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBaseNonPA([40,50], [20,30], [20,30]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": {
                                        name: "Welded",
                                        order: 1,
                                        func: createBaseNonPA([5,6], [5,6], [5,6])
                                    },
                                    "Tempered": {
                                        name: "Tempered",
                                        order: 1,
                                        func: createBaseNonPA([7,8], [7,8], [7,8])
                                    },
                                    "Hardened": {
                                        name: "Hardened",
                                        order: 1,
                                        func: createBaseNonPA([9,10], [9,10], [9,10])
                                    },
                                    "Buttressed": {
                                        name: "Buttressed",
                                        order: 1,
                                        func: createBaseNonPA([11,13], [11,13], [11,13])
                                    },
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Leaded": standardMiscLeaded
                                }
                            }
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                    "MarineArctic": {
                        name: "Arctic Marine",
                        levels: [35,40,45,50],
                        category: "Heavy",
                        "Torso": {
                            name: "Chest Piece",
                            order: 1,
                            func: createBaseNonPA([54,58,63,67], [32,34,37,40], [28,30,32,35], undefined, [16,17,18,20]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": {
                                        name: "Welded",
                                        order: 1,
                                        func: createBaseNonPA([7,8,9,10], [7,8,9,10], [7,8,9,10])
                                    },
                                    "Tempered": {
                                        name: "Tempered",
                                        order: 1,
                                        func: createBaseNonPA([11,12,13,15], [11,12,13,15], [11,12,13,15])
                                    },
                                    "Hardened": {
                                        name: "Hardened",
                                        order: 1,
                                        func: createBaseNonPA([10,11,13,15], [15,17,18,20], [15,17,18,20])
                                    },
                                    "Buttressed": {
                                        name: "Buttressed",
                                        order: 1,
                                        func: createBaseNonPA([19,21,23,25], [19,21,23,25], [19,21,23,25])
                                    },
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Asbestos": standardMiscAsbestos,
                                    "Leaded": standardMiscLeaded,
                                    "Dense": standardMiscDense,
                                    "Padded": standardMiscPadded
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBaseNonPA([22,22,27,27], [13,13,16,16], [0,0,0,0], undefined, [7,7,8,8]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": {
                                        name: "Welded",
                                        order: 1,
                                        func: createBaseNonPA([3,4,5,6], [3,4,5,6], [3,4,5,6])
                                    },
                                    "Tempered": {
                                        name: "Tempered",
                                        order: 1,
                                        func: createBaseNonPA([5,6,7,8], [5,6,7,8], [5,6,7,8])
                                    },
                                    "Hardened": {
                                        name: "Hardened",
                                        order: 1,
                                        func: createBaseNonPA([7,8,9,10], [7,8,9,10], [7,8,9,10])
                                    },
                                    "Buttressed": {
                                        name: "Buttressed",
                                        order: 1,
                                        func: createBaseNonPA([7,9,11,13], [7,9,11,13], [7,9,11,13])
                                    },
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Braced": standardMiscBraced,
                                    "Leaded": standardMiscLeaded
                                }
                            }
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBaseNonPA([22,22,27,27], [13,13,16,16], [0,0,0,0], undefined, [7,7,8,8]),
                            mods: {
                                "Main": {
                                    "Standard": {
                                        name: "Standard",
                                        default: true,
                                    },
                                    "Welded": {
                                        name: "Welded",
                                        order: 1,
                                        func: createBaseNonPA([3,4,5,6], [3,4,5,6], [3,4,5,6])
                                    },
                                    "Tempered": {
                                        name: "Tempered",
                                        order: 1,
                                        func: createBaseNonPA([5,6,7,8], [5,6,7,8], [5,6,7,8])
                                    },
                                    "Hardened": {
                                        name: "Hardened",
                                        order: 1,
                                        func: createBaseNonPA([7,8,9,10], [7,8,9,10], [7,8,9,10])
                                    },
                                    "Buttressed": {
                                        name: "Buttressed",
                                        order: 1,
                                        func: createBaseNonPA([7,9,11,13], [7,9,11,13], [7,9,11,13])
                                    },
                                },
                                "Misc": {
                                    "None": {
                                        name: "None",
                                        default: true
                                    },
                                    "Leaded": standardMiscLeaded
                                }
                            }
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        },
                    },
                },
                "PA": {
                    "Excavator": {
                        name: "Excavator",
                        levels: [25, 35, 45],
                        category: "PA",
                        "Helmet": {
                            name: "Helmet",
                            order: 1,
                            func: createBasePA([24, 30, 36], [24, 30, 36], [35, 45, 55], 7, 7, 15)
                        },
                        "Torso": {
                            name: "Torso",
                            order: 1,
                            func: createBasePA([42, 51, 60], [42, 51, 60], [59, 75, 91], 7, 7, 15),
                            mods: {
                                "Main": {
                                    "Emergency": paTorsoEmergencyProtocol
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBasePA([24, 30, 36], [24, 30, 36], [35, 45, 55], 7, 7, 15),
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBasePA([24, 30, 36], [24, 30, 36], [35, 45, 55], 7, 7, 15),
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        }
                    },
                    "Raider": {
                        name: "Raider",
                        levels: [15, 25, 35, 45],
                        category: "PA",
                        "Helmet": {
                            name: "Helmet",
                            order: 1,
                            func: createBasePA([24, 33, 42, 51], [24, 33, 42, 51], [24, 33, 42, 51], 7, 7, 15)
                        },
                        "Torso": {
                            name: "Torso",
                            order: 1,
                            func: createBasePA([40, 55, 71, 86], [40, 55, 71, 86], [40, 55, 71, 86], 7, 7, 15),
                            mods: {
                                "Main": {
                                    "Emergency": paTorsoEmergencyProtocol
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBasePA([24, 33, 42, 51], [24, 33, 42, 51], [24, 33, 42, 51], 7, 7, 15),
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBasePA([24, 33, 42, 51], [24, 33, 42, 51], [24, 33, 42, 51], 7, 7, 15),
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        }
                    },
                    "T45": {
                        name: "T-45",
                        levels: [25, 35, 45],
                        category: "PA",
                        "Helmet": {
                            name: "Helmet",
                            order: 1,
                            func: createBasePA([34,44,54], [34,44,54], [34,44,54], 7, 7, 15)
                        },
                        "Torso": {
                            name: "Torso",
                            order: 1,
                            func: createBasePA([58,74,90], [58,74,90], [58,74,90], 7, 7, 15),
                            mods: {
                                "Main": {
                                    "Emergency": paTorsoEmergencyProtocol
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBasePA([34,44,54], [34,44,54], [34,44,54], 7, 7, 15),
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBasePA([34,44,54], [34,44,54], [34,44,54], 7, 7, 15),
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        }
                    },
                    "T51": {
                        name: "T-51",
                        levels: [30, 40, 50],
                        category: "PA",
                        "Helmet": {
                            name: "Helmet",
                            order: 1,
                            func: createBasePA([45,56,68], [45,56,68], [27,33,49], 7, 7, 15)
                        },
                        "Torso": {
                            name: "Torso",
                            order: 1,
                            func: createBasePA([75,94,114], [75,94,114], [46,55,65], 7, 7, 15),
                            mods: {
                                "Main": {
                                    "Emergency": paTorsoEmergencyProtocol
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBasePA([45,56,68], [45,56,68], [27,33,49], 7, 7, 15),
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBasePA([45,56,68], [45,56,68], [27,33,49], 7, 7, 15),
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        }
                    },
                    "T60": {
                        name: "T-60",
                        levels: [40, 50],
                        category: "PA",
                        "Helmet": {
                            name: "Helmet",
                            order: 1,
                            func: createBasePA([50, 60], [45,55], [50,60], 7, 7, 15)
                        },
                        "Torso": {
                            name: "Torso",
                            order: 1,
                            func: createBasePA([84,100], [79,95], [100,115], 7, 7, 15),
                            mods: {
                                "Main": {
                                    "Emergency": paTorsoEmergencyProtocol
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBasePA([50,60], [45,55], [50,60], 7, 7, 15),
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBasePA([50,60], [45,55], [50,60], 7, 7, 15),
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        }
                    },
                    "X01": {
                        name: "X-01",
                        levels: [40, 50],
                        category: "PA",
                        "Helmet": {
                            name: "Helmet",
                            order: 1,
                            func: createBasePA([50, 60], [56,68], [56,68], 7, 7, 15)
                        },
                        "Torso": {
                            name: "Torso",
                            order: 1,
                            func: createBasePA([82,98], [94,113], [94,113], 7, 7, 15),
                            mods: {
                                "Main": {
                                    "Emergency": paTorsoEmergencyProtocol
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBasePA([50, 60], [56,68], [56,68], 7, 7, 15),
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBasePA([50, 60], [56,68], [56,68], 7, 7, 15),
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        }
                    },
                    "Ultracite": {
                        name: "Ultracite",
                        levels: [50],
                        category: "PA",
                        "Helmet": {
                            name: "Helmet",
                            order: 1,
                            func: createBasePA([68], [59], [59], 7, 7, 15)
                        },
                        "Torso": {
                            name: "Torso",
                            order: 1,
                            func: createBasePA([113], [98], [98], 7, 7, 15),
                            mods: {
                                "Main": {
                                    "Emergency": paTorsoEmergencyProtocol
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBasePA([68], [59], [59], 7, 7, 15),
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBasePA([68], [59], [59], 7, 7, 15),
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        }
                    },
                    "Strangler": {
                        name: "Strangler Heart",
                        levels: [50],
                        category: "PA",
                        "Helmet": {
                            name: "Helmet",
                            order: 1,
                            func: createBasePA([68], [59], [75], 7, 7, 15)
                        },
                        "Torso": {
                            name: "Torso",
                            order: 1,
                            func: createBasePA([113], [98], [125], 7, 7, 15),
                            mods: {
                                "Main": {
                                    "Emergency": paTorsoEmergencyProtocol
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBasePA([68], [59], [75], 7, 7, 15),
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBasePA([68], [59], [75], 7, 7, 15),
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        }
                    },
                    "T65": {
                        name: "T-65",
                        levels: [50],
                        category: "PA",
                        "Helmet": {
                            name: "Helmet",
                            order: 1,
                            func: createBasePA([85], [70], [70], 7, 7, 15)
                        },
                        "Torso": {
                            name: "Torso",
                            order: 1,
                            func: createBasePA([140], [120], [120], 7, 7, 15),
                            mods: {
                                "Main": {
                                    "Emergency": paTorsoEmergencyProtocol
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBasePA([85], [70], [70], 7, 7, 15),
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBasePA([85], [70], [70], 7, 7, 15),
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        }
                    },
                    "Hellcat": {
                        name: "Hellcat",
                        levels: [50],
                        category: "PA",
                        "Helmet": {
                            name: "Helmet",
                            order: 1,
                            func: createBasePA([68], [48], [48], 7, 7, 15)
                        },
                        "Torso": {
                            name: "Torso",
                            order: 1,
                            func: (state, idx) => {
                                state.dr += 96;
                                state.er += 80;
                                state.rr += 80;
                                
                                var rs = getOrCreateReductionSlot(state, "base");
                                rs.ballisticReduction += 7;
                                rs.energyReduction += 7;
                                rs.radiationReduction += 15;

                                if (state.player.fullSet) {
                                    rs = getOrCreateReductionSlot(state, "hellcat");
                                    rs.ballisticReduction += 10;
                                }
                            },
                            mods: {
                                "Main": {
                                    "Emergency": paTorsoEmergencyProtocol
                                }
                            }
                        },
                        "LA": {
                            name: "Left Arm",
                            order: 1,
                            func: createBasePA([68], [48], [48], 7, 7, 15)
                        },
                        "RA": {
                            name: "Right Arm",
                            use: "LA"
                        },
                        "LL": {
                            name: "Left Leg",
                            order: 1,
                            func: createBasePA([68], [48], [48], 7, 7, 15)
                        },
                        "RL": {
                            name: "Right Leg",
                            use: "LL"
                        }
                    },
                },
                "Suit": {
                    "Hazmat": {
                        name: "Hazmat Suit",
                        levels: ["Any"],
                        category: "Suit",
                        "Body": {
                            name: "Body",
                            order: 1,
                            func: createBaseNonPA([0],[0],[1000])
                        }
                    },
                    "HazmatDamaged": {
                        name: "Damaged Hazmat Suit",
                        levels: ["Any"],
                        category: "Suit",
                        "Body": {
                            name: "Body",
                            order: 1,
                            func: createBaseNonPA([0],[0],[500])
                        }
                    },
                    "HazmatPrototype": {
                        name: "Prototype Hazmat Suit",
                        levels: ["Any"],
                        category: "Suit",
                        "Body": {
                            name: "Body",
                            order: 1,
                            func: createBaseNonPA([0],[0],[1000])
                        }
                    },
                    "HazmatCamo": {
                        name: "Swamp Camo Hazmat Suit",
                        levels: ["Any"],
                        category: "Suit",
                        "Body": {
                            name: "Body",
                            order: 1,
                            func: createBaseNonPA([0],[0],[1000])
                        }
                    },
                    "Stealth": {
                        name: "Chinese Stealth",
                        levels: [25,30,35,40,45,50],
                        category: "Suit",
                        "Body": {
                            name: "Body",
                            order: 1,
                            func: createBaseNonPA([70,84,98,112,126,140],[70,84,98,112,126,140],[1000,1000,1000,1000,1000,1000])
                        }
                    }
                }
            };

            var armorHierarchy = {
                "NonPA": {
                },
                "PA": {
                },
                "Suit": {
                }
            }

            for (var armorKind in armor) {
                for (var armorId in armor[armorKind]) {
                    var armorEntry = armor[armorKind][armorId];

                    if (armorId.endsWith("Light")) {
                        var newArmorEntry = {};
                        var idx = armorEntry.name.indexOf(" - ");
                        if (idx > 0) {
                            newArmorEntry.name = armorEntry.name.substring(0, idx);
                        } else {
                            newArmorEntry.name = armorEntry.name;
                        }
                        newArmorEntry.levels = armorEntry.levels;
                        newArmorEntry.categories = ["Light", "Sturdy", "Heavy"];

                        idx = armorId.indexOf("Light");
                        var newArmor = armorId.substring(0, idx);
                        armorHierarchy[armorKind][newArmor] = newArmorEntry;
                    } else
                    if (!armorId.endsWith("Sturdy") && !armorId.endsWith("Heavy")) {
                        var newArmorEntry = {};
                        newArmorEntry.name = armorEntry.name;
                        newArmorEntry.levels = armorEntry.levels;
                        newArmorEntry.categories = [];
                        armorHierarchy[armorKind][armorId] = newArmorEntry;
                    }
                }
            }

            var legendaryVanguardsFunc = (state) => {
                var hp = clamp(state.player.hp, 0, 100);
                var c = 0;
                if (hp > 90) {
                    c = 35;
                }
                else if (hp > 80) {
                    c = 28;
                }
                else if (hp > 70) {
                    c = 21;
                }
                else if (hp > 60) {
                    c = 14;
                }
                else if (hp > 50) {
                    c = 7;
                }
                state.dr += c;
                state.er += c;
            };

            var legendaryBolsteringFunc = (state) => {
                var hp = clamp(state.player.hp, 0, 100);
                var c = 0;
                
                if (hp > 90) {
                    c = 0;
                }
                else if (hp > 80) {
                    c = 4;
                }
                else if (hp > 70) {
                    c = 8;
                }
                else if (hp > 60) {
                    c = 12;
                }
                else if (hp > 50) {
                    c = 16;
                }
                else if (hp > 40) {
                    c = 20;
                }
                else if (hp > 30) {
                    c = 24;
                }
                else if (hp > 20) {
                    c = 28;
                }
                else if (hp > 10) {
                    c = 32;
                } else {
                    c = 35;
                }
                state.dr += c;
                state.er += c;
            };

            var legendaryEffects = {
                "NonPA": {
                    "Prefix": {
                        "Aristocrats": {
                            name: "Aristocrat's (PTS)",
                            order: 2,
                            func: (state) => {
                                var c = 20 * clamp(state.player.caps, 0, 29000) / 29000.0;
                                state.dr += c;
                                state.er += c;
                                state.rr += c;
                                state.fr += c;
                                state.cr += c;
                                state.pr += c;
                            }
                        },
                        "Bolstering": {
                            name: "Bolstering",
                            order: 2,
                            func: legendaryBolsteringFunc
                        },
                        "Overeaters": {
                            name: "Overeater's (PTS)",
                            order: 2,
                            func: (state) => {
                                var c = Math.round(6 * clamp(state.player.fooddrink, 0, 100) / 100.0);
                                var rs = getOrCreateReductionSlot(state, "overeaters");
                                rs.ballisticReduction += c;
                                rs.energyReduction += c;
                            }
                        },
                        "Vanguard": {
                            name: "Vanguard's",
                            order: 2,
                            func: legendaryVanguardsFunc
                        },
                        "Mutants": {
                            name: "Mutant's",
                            order: 2,
                            func: (state) => {
                                if (state.player.mutations > 0) {
                                    state.dr += 10;
                                    state.er += 10;
                                }
                            }
                        },
                        "Nocturnal": {
                            name: "Nocturnal",
                            order: 10,
                            func: (state) => {
                                if (state.player.night) {
                                    state.dr *= 1.10;
                                    state.er *= 1.10;
                                }
                            }
                        },
                        "Heavyweight": {
                            name: "Heavyweight",
                            order: 2,
                            func: (state) => {
                                var c = Math.round(20 * clamp(state.player.carrying, 0, 350) / 350.0);
                                state.dr += c;
                                state.er += c;
                                state.rr += c;
                                state.fr += c;
                                state.cr += c;
                                state.pr += c;
                            }
                        },
                        "Assassins": {
                            name: "Assassin's",
                            order: 2,
                            func: createVersusFunc(["Human", "Player"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Ghoulslayers": {
                            name: "Ghoul Slayer's",
                            order: 2,
                            func: createVersusFunc(["Ghoul"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Mutantslayers": {
                            name: "Mutant Slayer's",
                            order: 2,
                            func: createVersusFunc(["SuperMutant"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Hunters": {
                            name: "Hunter's",
                            order: 2,
                            func: createVersusFunc(["Animal"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Exterminators": {
                            name: "Exterminator's",
                            order: 2,
                            func: createVersusFunc(["Insect", "Mirelurk"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Troubleshooters": {
                            name: "Troubleshooter's",
                            order: 2,
                            func: createVersusFunc(["Robot"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Zealots": {
                            name: "Zealot's",
                            order: 2,
                            func: createVersusFunc(["Scorched"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                    },
                    "Major": {
                        "Radresist": {
                            name: "+25 rad resistance",
                            order: 2,
                            func: (state) => state.rr += 25
                        },
                        "Poisonresist": {
                            name: "+25 poison resistance",
                            order: 2,
                            func: (state) => state.pr += 25
                        },
                        "Fireresist": {
                            name: "+25 fire resistance",
                            order: 2,
                            func: (state) => state.fr += 25
                        },
                        "Cryoresist": {
                            name: "+25 cryo resistance",
                            order: 2,
                            func: (state) => state.cr += 25
                        },
                        "Hardy": {
                            name: "-10% explosive DMG",
                            order: 2,
                            func: (state) => {
                                var rs = getOrCreateReductionSlot(state, "base");
                                rs.explosiveReduction += 10;
                            }
                        }
                    },
                    "Minor": {
                        "Blocker": {
                            name: "-15% DMG when blocking",
                            order: 2,
                            func: (state) => {
                                if (state.player.blocking) {
                                    var rs = getOrCreateReductionSlot(state, "LegendaryBlocker");
                                    rs.ballisticReduction += 15;
                                    rs.energyReduction += 15;
                                }
                            }
                        },
                        "Cavailier": {
                            name: "-15% DMG while sprinting",
                            order: 2,
                            func: (state) => {
                                if (state.player.stance === "Sprint") {
                                    var rs = getOrCreateReductionSlot(state, "Sprint");
                                    rs.ballisticReduction += 15 * 3 / 4;
                                    rs.energyReduction += 15 * 3 / 4;
                                }
                            }
                        },
                        /*
                        "Limbdamage": {
                            name: "15% less limb damage",
                            ballisticReductionPercent: 15,
                            energyReductionPercent: 15,
                            chance: 15
                        },
                        */
                        "Sentinel": {
                            name: "-15% DMG while standing still",
                            order: 2,
                            func: (state) => {
                                if (state.player.stance === "Still") {
                                    var rs = getOrCreateReductionSlot(state, "Still");
                                    rs.ballisticReduction += 15 * 3 / 4;
                                    rs.energyReduction += 15 * 3 / 4;
                                }
                            }
                        }
                    },
                    "4th": {
                        "Elemental-Fire": {
                            name: "+20 Fire Resist (random)",
                            order: 2,
                            func: (state) => {
                                state.fr += 20;
                            }
                        },
                        "Elemental-Cold": {
                            name: "+20 Cold Resist (random)",
                            order: 2,
                            func: (state) => {
                                state.cr += 20;
                            }
                        },
                        "Elemental-Poison": {
                            name: "+20 Poison Resist (random)",
                            order: 2,
                            func: (state) => {
                                state.pr += 20;
                            }
                        }
                    }
                },
                "PA": {
                    "Prefix": {
                        "Aristocrats": {
                            name: "Aristocrat's (PTS)",
                            order: 2,
                            func: (state) => {
                                var c = Math.round(35 * clamp(state.player.caps, 0, 29000) / 29000.0);
                                state.dr += c;
                                state.er += c;
                                state.rr += c;
                                state.fr += c;
                                state.cr += c;
                                state.pr += c;
                            }
                        },
                        "Bolstering": {
                            name: "Bolstering",
                            order: 2,
                            func: legendaryBolsteringFunc
                        },
                        "Overeaters": {
                            name: "Overeater's (PTS)",
                            order: 2,
                            func: (state) => {
                                var c = Math.round(6 * clamp(state.player.fooddrink, 0, 100) / 100.0);
                                var rs = getOrCreateReductionSlot(state, "overeaters");
                                rs.ballisticReduction += c;
                                rs.energyReduction += c;
                            }
                        },
                        "Vanguard": {
                            name: "Vanguard's",
                            order: 2,
                            func: legendaryVanguardsFunc
                        },
                        "Mutants": {
                            name: "Mutant's",
                            order: 2,
                            func: (state) => {
                                if (state.player.mutations > 0) {
                                    state.dr += 10;
                                    state.er += 10;
                                }
                            }
                        },
                        "Nocturnal": {
                            name: "Nocturnal",
                            order: 10,
                            func: (state) => {
                                if (state.player.night) {
                                    state.dr *= 1.10;
                                    state.er *= 1.10;
                                }
                            }
                        },
                        "Heavyweight": {
                            name: "Heavyweight (PTS)",
                            order: 2,
                            func: (state) => {
                                var c = Math.round(35 * clamp(state.player.carrying, 0, 350) / 350.0);
                                state.dr += c;
                                state.er += c;
                                state.rr += c;
                                state.fr += c;
                                state.cr += c;
                                state.pr += c;
                            }
                        },
                        "Assassins": {
                            name: "Assassin's",
                            order: 2,
                            func: createVersusFunc(["Human", "Player"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Ghoulslayers": {
                            name: "Ghoul Slayer's",
                            order: 2,
                            func: createVersusFunc(["Ghoul"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Mutantslayers": {
                            name: "Mutant Slayer's",
                            order: 2,
                            func: createVersusFunc(["SuperMutant"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Hunters": {
                            name: "Hunter's",
                            order: 2,
                            func: createVersusFunc(["Animal"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Exterminators": {
                            name: "Exterminator's",
                            order: 2,
                            func: createVersusFunc(["Insect", "Mirelurk"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Troubleshooters": {
                            name: "Troubleshooter's",
                            order: 2,
                            func: createVersusFunc(["Robot"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                        "Zealots": {
                            name: "Zealot's",
                            order: 2,
                            func: createVersusFunc(["Scorched"], ["ballisticReduction", "energyReduction"], [15, 15])
                        },
                    },
                    "Major": {
                        "Radresist": {
                            name: "+25 rad resistance",
                            order: 2,
                            func: (state) => state.rr += 25
                        },
                        "Poisonresist": {
                            name: "+25 poison resistance",
                            order: 2,
                            func: (state) => state.pr += 25
                        },
                        "Fireresist": {
                            name: "+25 fire resistance",
                            order: 2,
                            func: (state) => state.fr += 25
                        },
                        "Cryoresist": {
                            name: "+25 cryo resistance",
                            order: 2,
                            func: (state) => state.cr += 25
                        },
                        "Hardy": {
                            name: "-10% explosive DMG",
                            order: 2,
                            func: (state) => {
                                var rs = getOrCreateReductionSlot(state, "base");
                                rs.explosiveReduction += 10;
                            }
                        }
                    },
                    "Minor": {
                        "Blocker": {
                            name: "-15% DMG when blocking",
                            order: 2,
                            func: (state) => {
                                if (state.player.blocking) {
                                    var rs = getOrCreateReductionSlot(state, "LegendaryBlocker");
                                    rs.ballisticReduction += 15;
                                    rs.energyReduction += 15;
                                }
                            }
                        },
                        "Cavailier": {
                            name: "-15% DMG while sprinting",
                            order: 2,
                            func: (state) => {
                                if (state.player.stance === "Sprint") {
                                    var rs = getOrCreateReductionSlot(state, "Sprint");
                                    rs.ballisticReduction += 15 * 3 / 4;
                                    rs.energyReduction += 15 * 3 / 4;
                                }
                            }
                        },
                        /*
                        "Limbdamage": {
                            name: "15% less limb damage",
                            ballisticReductionPercent: 15,
                            energyReductionPercent: 15,
                            chance: 15
                        },
                        */
                        "Sentinel": {
                            name: "-15% DMG while standing still",
                            order: 2,
                            func: (state) => {
                                if (state.player.stance === "Still") {
                                    var rs = getOrCreateReductionSlot(state, "Still");
                                    rs.ballisticReduction += 15 * 3 / 4;
                                    rs.energyReduction += 15 * 3 / 4;
                                }
                            }
                        }
                    },
                    "4th": {
                        "Elemental-Fire": {
                            name: "+20 Fire Resist (random)",
                            order: 2,
                            func: (state) => {
                                rs.fr += 20;
                            }
                        },
                        "Elemental-Cold": {
                            name: "+20 Cold Resist (random)",
                            order: 2,
                            func: (state) => {
                                rs.cr += 20;
                            }
                        },
                        "Elemental-Poison": {
                            name: "+20 Poison Resist (random)",
                            order: 2,
                            func: (state) => {
                                rs.pr += 20;
                            }
                        }
                    }
                }
            };

            function createSimpleFoodFunc(meat, resistName, resistAmount) {
                return (state) => {
                    if (meat) {
                        if (state.player.carnivore) {
                            if (state.player.teammates > 0 && state.player.strangeInNumbers) {
                                state[resistName] += 5 * resistAmount / 2;
                            } else {
                                state[resistName] += 2 * resistAmount;
                            }
                        }
                        else if (!state.player.herbivore) {
                            state[resistName] += resistAmount;
                        }
                    } else {
                        if (state.player.herbivore) {
                            if (state.player.teammates > 0 && state.player.strangeInNumbers) {
                                state[resistName] += 5 * resistAmount / 2;
                            } else {
                                state[resistName] += 2 * resistAmount;
                            }
                        }
                        else if (!state.player.carnivore) {
                            state[resistName] += resistAmount;
                        }
                    }
                };
            }

            var consumables = {
                "Food": {
                    "Bakedbloatlfy": {
                        name: "Baked Bloatfly (+10 RR)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "rr", 10)
                    },
                    "Bloatflyloaf": {
                        name: "Bloatfly Loaf (+30 RR)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "rr", 30)
                    },
                    "Cranberryjam": {
                        name: "Cranberry Jam (+10 DR)",
                        order: 2,
                        func: createSimpleFoodFunc(false, "dr", 10)
                    },
                    "Crispycavecricket": {
                        name: "Crispy Cave Cricket (+10 ER)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "er", 10)
                    },
                    "Firecaptastysouffle": {
                        name: "Firecap Tasty Souffle (+35 ER)",
                        order: 2,
                        func: createSimpleFoodFunc(false, "er", 35)
                    },
                    "Friedfogcrawler": {
                        name: "Fried Fog Crawler (+20 DR)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "dr", 20)
                    },
                    "Headhuntercheese": {
                        name: "Headhunter's Headcheese (+10 DR)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "dr", 10)
                    },
                    "Megaslothtenderloin": {
                        name: "Megasloth Tenderloin (+35 ER)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "er", 35)
                    },
                    "Mirelurkcakealoi": {
                        name: "Mirelurk Cake with Bloodleaf Aloi (+30 ER)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "er", 30)
                    },
                    "Mirelurkjerky": {
                        name: "Mirelurk Jerky (+15 ER)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "er", 15)
                    },
                    "Potholepotpie": {
                        name: "Pothole Potpie (+10 DR)",
                        order: 2,
                        func: createSimpleFoodFunc(false, "dr", 10)
                    },
                    "Radscorpionfilet": {
                        name: "Radscorpion Filet (+35 ER)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "er", 35)
                    },
                    "Radscorpionsteak": {
                        name: "Radscorpion Steak (+25 ER)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "er", 25)
                    },
                    "Roastmegasloth": {
                        name: "Roast Megaslot (+25 ER)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "er", 25)
                    },
                    "Scorchbeast Steak": {
                        name: "Scorchbeast Steak (+15 DR)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "dr", 15)
                    },
                    "Strawberryperkgum": {
                        name: "Strawberry Perk Bubblegum (+1 DR)",
                        order: 2,
                        func: (state) => state.dr =+ 1,
                    },
                    "Cavefungussoup": {
                        name: "Cave Fungus Soup (+10 PR)",
                        order: 2,
                        func: createSimpleFoodFunc(false, "pr", 10)
                    },
                    "Firecapsoup": {
                        name: "Firecap Soup (+25 ER)",
                        order: 2,
                        func: createSimpleFoodFunc(false, "er", 25)
                    },
                    "Glowingfungussoup": {
                        name: "Glowing Fungus Soup (+20 RR)",
                        order: 2,
                        func: createSimpleFoodFunc(false, "rr", 20)
                    },
                    "Glowingfunguspuree": {
                        name: "Glowing Fungus Puree (+35 ER)",
                        order: 2,
                        func: createSimpleFoodFunc(false, "er", 35)
                    },
                    "Radstagstew": {
                        name: "Radstag Stew (+35 ER)",
                        order: 2,
                        func: createSimpleFoodFunc(true, "er", 35)
                    },
                    "Siltbeanpuree": {
                        name: "Silt Bean Puree (+15 DR)",
                        order: 2,
                        func: createSimpleFoodFunc(false, "dr", 15)
                    },
                    "Tatosoup": {
                        name: "Tato Soup (+10 PR)",
                        order: 2,
                        func: createSimpleFoodFunc(false, "pr", 10)
                    },
                },
                "Drink": {
                    "Leadchampagne": {
                        name: "Lead Champagne (+15 DR, +100 RR)",
                        debuff: ["dr", "rr"],
                        order: 2,
                        func: (state) => {
                            var party = 1
                            if (state.player.partyPerson) {
                                party *= state.player.partyPerson;
                            }
                            state.dr += 15 * party;
                            state.rr += 100 * party;
                        }
                    },
                    "Leadchampagnebellini": {
                        name: "Lead Champagne Bellini (+15 DR)",
                        debuff: ["dr"],
                        order: 2,
                        func: (state) => {
                            var party = 1
                            if (state.player.partyPerson) {
                                party *= state.player.partyPerson;
                            }
                            state.dr += 15 * party;
                        }
                    },
                    "Leadchampagnemimosa": {
                        name: "Lead Champagne Mimosa (+100 RR)",
                        debuff: ["rr"],
                        order: 2,
                        func: (state) => {
                            var party = 1
                            if (state.player.partyPerson) {
                                party *= state.player.partyPerson;
                            }
                            state.rr += 100 * party;
                        }
                    },
                    "Nukacolablood": {
                        name: "Nuka Cola My Blood (-15% DMG from Scorched)",
                        debuff: ["nukascorched"],
                        order: 2,
                        func: createNukaScorched()
                    },
                    "Nukacolascorched": {
                        name: "Nuka Cola Scorched (-15% DMG from Scorched)",
                        debuff: ["nukascorched"],
                        order: 2,
                        func: createNukaScorched()
                    },
                    "Nukacolavaccinated": {
                        name: "Nuka Cola Vaccinated (-15% DMG from Scorched)",
                        debuff: ["nukascorched"],
                        order: 2,
                        func: createNukaScorched()
                    },
                    "Nukacolaorange": {
                        name: "Nuka Cola Orange (+25 RR)",
                        debuff: ["rr"],
                        order: 2,
                        func: (state) => {
                            var nuka = 1;
                            if (state.player.colanut) {
                                nuka *= state.player.colanut;
                            }
                            state.rr += 25 * nuka;
                        }
                    },
                    "Steepedstranglerbloomtea": {
                        name: "Steeped Strangler Bloom Tea (+20 RR)",
                        debuff: ["rr"],
                        order: 2,
                        func: (state) => state.rr += 20,
                    },
                    /*
                    "Whiterussian": {
                        name: "White Russian (-20% limb DMG)",
                        ballisticReductionPercent: 20,
                        energyReductionPercent: 20,
                        chance: 15
                    },
                    */
                },
                "Chem": {
                    "Fury": {
                        name: "Fury (+25 DR)",
                        debuff: ["dr"],
                        order: 2,
                        func: (state) => state.dr += 25,
                    },
                    "Glowingbloodpack": {
                        name: "Glowing Blood Pack (+75 RR)",
                        debuff: ["rr"],
                        order: 2,
                        func: (state) => state.rr += 75,
                    },
                    "Insectrepellent": {
                        name: "Insect Rellent (-15% DMG from Insects)",
                        debuff: ["insectrepellent"],
                        order: 2,
                        func: (state) => {
                            if (state.enemy.kind === "Insect") {
                                var rs = getOrCreateReductionSlot(state, "Insect");
                                rs.ballisticReduction += 15;
                                rs.energyReduction += 15;
                            }
                        },
                    },
                    "Irradiatedbloodpack": {
                        name: "Irradiated Blood Pack (+75 RR)",
                        debuff: ["rr"],
                        order: 2,
                        func: (state) => state.rr += 75,
                    },
                    "Medx": {
                        name: "Med-X (+25 DR)",
                        debuff: ["dr", "medx"],
                        order: 2,
                        func: (state) => state.dr += 25,
                    },
                    "MedxAddict": {
                        name: "Med-X Addiction (-10 DR)",
                        debuff: ["medx"],
                        order: 2,
                        func: (state) => state.dr -= 10,
                    },
                    "Psycho": {
                        name: "Psycho (+25 DR)",
                        debuff: ["dr", "psycho"],
                        order: 2,
                        func: (state) => state.dr += 25,
                    },
                    "PsychoAddict": {
                        name: "Psycho Addiction (-10 DR)",
                        debuff: ["psycho"],
                        order: 2,
                        func: (state) => state.dr -= 10,
                    },
                    "Psychotats": {
                        name: "Psychotats (+15 DR)",
                        debuff: ["dr"],
                        order: 2,
                        func: (state) => state.dr += 15,
                    },
                    "Radx": {
                        name: "Rad-X (+100 RR)",
                        debuff: ["rr"],
                        order: 2,
                        func: (state) => state.rr += 100,
                    },
                    "Radxdiluted": {
                        name: "Rad-X Diluted (+50 RR)",
                        debuff: ["rr"],
                        order: 2,
                        func: (state) => state.rr += 50,
                    },
                    "Radshield": {
                        name: "Radshield (+300 RR)",
                        debuff: ["rr"],
                        order: 2,
                        func: (state) => state.rr += 300,
                    },
                    "Superchem1": {
                        name: "Super Chem Mk1 (+25 DR)",
                        debuff: ["dr"],
                        order: 2,
                        func: (state) => state.dr += 25,
                    },
                },
                "Magazine": {
                    "Astoundingly8": {
                        name: "Astoundingly... #8 (-20% DMG from Robots)",
                        order: 2,
                        func: createVersusFunc(["Robot"], ["ballisticReduction", "energyReduction"], [20, 20])
                    },
                    "Astoundingly9": {
                        name: "Astoundingly... #9 (+15 PR)",
                        order: 2,
                        func: state => state.pr += 15,
                    },
                    "Grognak3": {
                        name: "Grognak... #3 (+15 PR)",
                        order: 2,
                        func: state => state.pr += 15,
                    },
                    "Grognak8": {
                        name: "Grognak... #8 (+2 DR)",
                        order: 2,
                        func: state => state.dr += 2,
                    },
                    "Grognak10": {
                        name: "Grognak... #10 (+15 ER)",
                        order: 2,
                        func: state => state.er += 15,
                    },
                    "Guns6": {
                        name: "Guns... #6 (+10 DR at night)",
                        order: 2,
                        func: state => {
                            if (state.player.night) {
                                state.dr += 10;
                            }
                        }
                    },
                    "Live6": {
                        name: "Live... #6 (+10 DR in team)",
                        order: 2,
                        func: state => {
                            if (state.player.teammates > 0) {
                                state.dr += 10;
                            }
                        }
                    },
                    "Live9": {
                        name: "Live... #9 (-25% DMG from Robots)",
                        order: 2,
                        func: createVersusFunc(["Robot"], ["ballisticReduction", "energyReduction"], [25, 25])
                    },
                    "Scouts2": {
                        name: "Scout's... #2 (-25% DMG from Insects)",
                        order: 2,
                        func: createVersusFunc(["Insect"], ["ballisticReduction", "energyReduction"], [25, 25])
                    },
                    "Scouts7": {
                        name: "Scout's... #7 (-25% DMG from Animals)",
                        order: 2,
                        func: createVersusFunc(["Animal"], ["ballisticReduction", "energyReduction"], [25, 25])
                    },
                    "Tesla1": {
                        name: "Tesla... #1 (-25% DMG from Robots)",
                        order: 2,
                        func: createVersusFunc(["Robot"], ["ballisticReduction", "energyReduction"], [25, 25])
                    },
                    "Tesla2": {
                        name: "Tesla... #2 (-20% DMG from plasma)",
                        order: 2,
                        func: (state) => {
                            if (state.enemy.energyType === "plasma") {
                                var rs = getOrCreateReductionSlot(state, "Plasma");
                                rs.ballisticReduction += 20;
                                rs.energyReduction += 20;
                            }
                        },
                    },
                    "Tesla6": {
                        name: "Tesla... #6 (+15 RR)",
                        order: 2,
                        func: (state) => state.rr += 15
                    },
                    "US1": {
                        name: "U.S... #1 (+10 DR while sneaking)",
                        order: 2,
                        func: (state) => {
                            if (state.player.sneaking) {
                                state.dr += 10;
                            }
                        }
                    },
                    "US3": {
                        name: "U.S... #3 (-10% DMG from Players)",
                        order: 2,
                        func: createVersusFunc(["Player"], ["ballisticReduction", "energyReduction"], [10, 10])
                    },
                    "Unstoppables1": {
                        name: "Unstop... #1 (5% chance for 0 DMG)",
                        order: 2,
                        func: (state) => {
                            var rs = getOrCreateReductionSlot(state, "unstoppables");
                            rs.ballisticReduction += 5;
                            rs.energyReduction += 5;
                        }
                    },
                    "Unstoppables2": {
                        name: "Unstop... #2 (20% chance for 0 DMG from Scorched)",
                        order: 2,
                        func: (state) => {
                            if (state.enemy.kind === "Scorched") {
                                var rs = getOrCreateReductionSlot(state, "unstoppables");
                                rs.ballisticReduction += 20;
                                rs.energyReduction += 20;
                            }
                        }
                    },
                    "Unstoppables3": {
                        name: "Unstop... #3 (30% chance for 0 DMG from explosions)",
                        order: 2,
                        func: (state) => {
                            var rs = getOrCreateReductionSlot(state, "unstoppables");
                            rs.explosiveReduction += 30
                        }
                    },
                    "Unstoppables4": {
                        name: "Unstop... #4 (30% chance for 0 melee DMG)",
                        order: 2,
                        func: (state) => {
                            if (state.enemy.damageType === "melee") {
                                var rs = getOrCreateReductionSlot(state, "unstoppables");
                                rs.ballisticReduction += 30;
                                rs.energyReduction += 30;
                            }
                        }
                    },
                    "Unstoppables5": {
                        name: "Unstop... #5 (30% chance for 0 energy DMG)",
                        order: 2,
                        func: (state) => {
                            var rs = getOrCreateReductionSlot(state, "unstoppables");
                            rs.energyReduction += 30
                        }
                    },
                },
            };

            function createNukaScorched() {
                return (state) => {
                            if (state.enemy.kind === "Scorched") {
                                var nuka = 1;
                                if (state.player.colanut) {
                                    nuka *= state.player.colanut;
                                }
                                var rs = getOrCreateReductionSlot(state, "scorched");
                                rs.ballisticReduction += 15 * nuka;
                                rs.energyReduction += 15 * nuka;
                            }
                        };
            }

            function createVersusFunc(versusList, reductionKeyList, valueList) {
                return state => {
                    if (versusList.includes(state.enemy.kind)) {
                        var rs = getOrCreateReductionSlot(state, state.enemy.kind);
                        for (var i = 0; i < reductionKeyList.length; i++) {
                            rs[reductionKeyList[i]] += valueList[i];
                        }
                    }
                }
            }

            var backpackLevels = [1, 10, 20, 30, 40, 50];
            var backpackMods = {
                "Armorplated": {
                    name: "Armor Plated",
                    order: 2,
                    func: (state, level) => {
                        var arg = [15, 30, 45, 60, 75, 90];
                        state.dr += arg[level];
                    }
                },
                "Highcapacity": {
                    name: "High capacity",
                    order: 2,
                    func: (state, level) => {
                        var arg = [-10, -20, -30, -40, -50, -60];
                        state.er += arg[level];
                        state.rr += arg[level];
                    }
                },
                "Insulated": {
                    name: "Insulated",
                    order: 2,
                    func: (state, level) => {
                        var arg = [15, 30, 45, 60, 75, 90];
                        state.er += arg[level];
                    }
                },
                "Leadlined": {
                    name: "Lead Lined",
                    order: 2,
                    func: (state, level) => {
                        var arg = [15, 30, 45, 60, 75, 90];
                        state.rr += arg[level];
                    }
                },
            };

            var brotherhoodUnderarmorLinings = {
                "Standard": {
                    name: "Standard",
                    default: true
                },
                "Treated": {
                    name: "Treated",
                    order: 2,
                    func: (state) => {
                        state.dr += 6;
                        state.er += 4;
                        state.rr += 2;
                    }
                },
                "Resistant": {
                    name: "Resistant",
                    order: 2,
                    func: (state) => {
                        state.dr += 8;
                        state.er += 6;
                        state.rr += 3;
                    }
                },
                "Protective": {
                    name: "Protective",
                    order: 2,
                    func: (state) => {
                        state.dr += 10;
                        state.er += 8;
                        state.rr += 4;
                    }
                },
                "Shielded": {
                    name: "Shielded",
                    order: 2,
                    func: (state) => {
                        state.dr += 13;
                        state.er += 9;
                        state.rr += 5;
                    }
                },

            }

            var underarmor = {
                "BrotherhoodFatigues": {
                    name: "Brotherhood Fatigues",
                    mods: brotherhoodUnderarmorLinings
                },
                "BrotherhoodKnight": {
                    name: "Brotherhood Knight",
                    mods: brotherhoodUnderarmorLinings
                },
                "BrotherhoodOfficer": {
                    name: "Brotherhood Officer",
                    mods: brotherhoodUnderarmorLinings
                },
                "BrotherhoodSoldier": {
                    name: "Brotherhood Soldier",
                    mods: brotherhoodUnderarmorLinings
                },
                "FlannelShirt": {
                    name: "Flanner Shirt and Jeans",
                    mods: {
                        "Standard": {
                            name: "Standard",
                            default: true
                        },
                        "Treated": {
                            name: "Treated",
                            order: 2,
                            func: (state) => {
                                state.dr += 2;
                                state.er += 2;
                                state.rr += 2;
                            }
                        },
                        "Resistant": {
                            name: "Resistant",
                            order: 2,
                            func: (state) => {
                                state.dr += 3;
                                state.er += 3;
                                state.rr += 0;
                            }
                        },
                        "Protective": {
                            name: "Protective",
                            order: 2,
                            func: (state) => {
                                state.dr += 4;
                                state.er += 4;
                                state.rr += 4;
                            }
                        },
                        "Shielded": {
                            name: "Shielded",
                            order: 2,
                            func: (state) => {
                                state.dr += 5;
                                state.er += 5;
                                state.rr += 5;
                            }
                        },
                    }
                },
                "ForestOperative": {
                    name: "Forest Operative",
                    mods: {
                        "Standard": {
                            name: "Standard",
                            default: true
                        },
                        "Treated": {
                            name: "Treated",
                            order: 2,
                            func: (state) => {
                                state.dr += 4;
                                state.er += 6;
                                state.rr += 1;
                            }
                        },
                        "Resistant": {
                            name: "Resistant",
                            order: 2,
                            func: (state) => {
                                state.dr += 6;
                                state.er += 8;
                                state.rr += 3;
                            }
                        },
                        "Protective": {
                            name: "Protective",
                            order: 2,
                            func: (state) => {
                                state.dr += 8;
                                state.er += 10;
                                state.rr += 4;
                            }
                        },
                        "Shielded": {
                            name: "Shielded",
                            order: 2,
                            func: (state) => {
                                state.dr += 9;
                                state.er += 13;
                                state.rr += 5;
                            }
                        },
                    }
                },
                "Harness": {
                    name: "Forest Operative",
                    mods: {
                        "Standard": {
                            name: "Standard",
                            default: true
                        },
                        "Treated": {
                            name: "Treated",
                            order: 2,
                            func: (state) => {
                                state.dr += 4;
                                state.er += 2;
                                state.rr += 0;
                            }
                        },
                        "Resistant": {
                            name: "Resistant",
                            order: 2,
                            func: (state) => {
                                state.dr += 6;
                                state.er += 3;
                                state.rr += 0;
                            }
                        },
                        "Protective": {
                            name: "Protective",
                            order: 2,
                            func: (state) => {
                                state.dr += 8;
                                state.er += 4;
                                state.rr += 0;
                            }
                        },
                        "Shielded": {
                            name: "Shielded",
                            order: 2,
                            func: (state) => {
                                state.dr += 10;
                                state.er += 5;
                                state.rr += 0;
                            }
                        },
                    }
                },
                "LongJohns": {
                    name: "Long Johns",
                    mods: {
                        "Standard": {
                            name: "Standard",
                            default: true
                        },
                        "Treated": {
                            name: "Treated",
                            order: 2,
                            func: (state) => {
                                state.dr += 4;
                                state.er += 2;
                                state.rr += 0;
                            }
                        },
                        "Resistant": {
                            name: "Resistant",
                            order: 2,
                            func: (state) => {
                                state.dr += 6;
                                state.er += 3;
                                state.rr += 0;
                            }
                        },
                        "Protective": {
                            name: "Protective",
                            order: 2,
                            func: (state) => {
                                state.dr += 8;
                                state.er += 4;
                                state.rr += 0;
                            }
                        },
                        "Shielded": {
                            name: "Shielded",
                            order: 2,
                            func: (state) => {
                                state.dr += 10;
                                state.er += 5;
                                state.rr += 0;
                            }
                        },
                    }
                },
                "MarineWetsuit": {
                    name: "Marine Wetsuit",
                    mods: {
                        "Standard": {
                            name: "Standard",
                            default: true
                        },
                        "Treated": {
                            name: "Treated",
                            order: 2,
                            func: (state) => {
                                state.dr += 4;
                                state.er += 4;
                                state.rr += 4;
                            }
                        },
                        "Resistant": {
                            name: "Resistant",
                            order: 2,
                            func: (state) => {
                                state.dr += 6;
                                state.er += 6;
                                state.rr += 6;
                            }
                        },
                        "Protective": {
                            name: "Protective",
                            order: 2,
                            func: (state) => {
                                state.dr += 8;
                                state.er += 8;
                                state.rr += 8;
                            }
                        },
                        "Shielded": {
                            name: "Shielded",
                            order: 2,
                            func: (state) => {
                                state.dr += 9;
                                state.er += 9;
                                state.rr += 9;
                            }
                        },
                    }
                },
                "MilitaryFatigues": {
                    name: "Military Fatigues",
                    mods: {
                        "Standard": {
                            name: "Standard",
                            default: true
                        },
                        "Treated": {
                            name: "Treated",
                            order: 2,
                            func: (state) => {
                                state.dr += 2;
                                state.er += 2;
                                state.rr += 2;
                            }
                        },
                        "Resistant": {
                            name: "Resistant",
                            order: 2,
                            func: (state) => {
                                state.dr += 3;
                                state.er += 3;
                                state.rr += 0;
                            }
                        },
                        "Protective": {
                            name: "Protective",
                            order: 2,
                            func: (state) => {
                                state.dr += 4;
                                state.er += 4;
                                state.rr += 4;
                            }
                        },
                        "Shielded": {
                            name: "Shielded",
                            order: 2,
                            func: (state) => {
                                state.dr += 5;
                                state.er += 5;
                                state.rr += 5;
                            }
                        },
                    }
                },
                "RaiderLeathers": {
                    name: "Raider Leathers",
                    mods: {
                        "Standard": {
                            name: "Standard",
                            default: true
                        },
                        "Treated": {
                            name: "Treated",
                            order: 2,
                            func: (state) => {
                                state.dr += 4;
                                state.er += 2;
                                state.rr += 0;
                            }
                        },
                        "Resistant": {
                            name: "Resistant",
                            order: 2,
                            func: (state) => {
                                state.dr += 6;
                                state.er += 3;
                                state.rr += 0;
                            }
                        },
                        "Protective": {
                            name: "Protective",
                            order: 2,
                            func: (state) => {
                                state.dr += 8;
                                state.er += 4;
                                state.rr += 0;
                            }
                        },
                        "Shielded": {
                            name: "Shielded",
                            order: 2,
                            func: (state) => {
                                state.dr += 10;
                                state.er += 5;
                                state.rr += 0;
                            }
                        },
                    }
                },
                "RoadLeathers": {
                    name: "Road Leathers",
                    mods: {
                        "Standard": {
                            name: "Standard",
                            default: true
                        },
                        "Treated": {
                            name: "Treated",
                            order: 2,
                            func: (state) => {
                                state.dr += 4;
                                state.er += 2;
                                state.rr += 0;
                            }
                        },
                        "Resistant": {
                            name: "Resistant",
                            order: 2,
                            func: (state) => {
                                state.dr += 6;
                                state.er += 3;
                                state.rr += 0;
                            }
                        },
                        "Protective": {
                            name: "Protective",
                            order: 2,
                            func: (state) => {
                                state.dr += 8;
                                state.er += 4;
                                state.rr += 0;
                            }
                        },
                        "Shielded": {
                            name: "Shielded",
                            order: 2,
                            func: (state) => {
                                state.dr += 10;
                                state.er += 5;
                                state.rr += 0;
                            }
                        },
                    }
                },
                "SecretService": {
                    name: "Secret Service",
                    mods: {
                        "Standard": {
                            name: "Standard",
                            default: true
                        },
                        "Treated": {
                            name: "Treated",
                            order: 2,
                            func: (state) => {
                                state.dr += 6;
                                state.er += 6;
                                state.rr += 6;
                            }
                        },
                        "Resistant": {
                            name: "Resistant",
                            order: 2,
                            func: (state) => {
                                state.dr += 9;
                                state.er += 9;
                                state.rr += 9;
                            }
                        },
                        "Protective": {
                            name: "Protective",
                            order: 2,
                            func: (state) => {
                                state.dr += 12;
                                state.er += 12;
                                state.rr += 12;
                            }
                        },
                        "Shielded": {
                            name: "Shielded",
                            order: 2,
                            func: (state) => {
                                state.dr += 16;
                                state.er += 16;
                                state.rr += 16;
                            }
                        },
                    }
                },
                "Undershirt": {
                    name: "Undershirt and Jeans",
                    mods: {
                        "Standard": {
                            name: "Standard",
                            default: true
                        },
                        "Treated": {
                            name: "Treated",
                            order: 2,
                            func: (state) => {
                                state.dr += 2;
                                state.er += 2;
                                state.rr += 2;
                            }
                        },
                        "Resistant": {
                            name: "Resistant",
                            order: 2,
                            func: (state) => {
                                state.dr += 3;
                                state.er += 3;
                                state.rr += 0;
                            }
                        },
                        "Protective": {
                            name: "Protective",
                            order: 2,
                            func: (state) => {
                                state.dr += 4;
                                state.er += 4;
                                state.rr += 4;
                            }
                        },
                        "Shielded": {
                            name: "Shielded",
                            order: 2,
                            func: (state) => {
                                state.dr += 5;
                                state.er += 5;
                                state.rr += 0;
                            }
                        },
                    }
                },
                "UrbanOperative": {
                    name: "Urban Operative",
                    mods: {
                        "Standard": {
                            name: "Standard",
                            default: true
                        },
                        "Treated": {
                            name: "Treated",
                            order: 2,
                            func: (state) => {
                                state.dr += 4;
                                state.er += 6;
                                state.rr += 1;
                            }
                        },
                        "Resistant": {
                            name: "Resistant",
                            order: 2,
                            func: (state) => {
                                state.dr += 6;
                                state.er += 8;
                                state.rr += 3;
                            }
                        },
                        "Protective": {
                            name: "Protective",
                            order: 2,
                            func: (state) => {
                                state.dr += 8;
                                state.er += 10;
                                state.rr += 4;
                            }
                        },
                        "Shielded": {
                            name: "Shielded",
                            order: 2,
                            func: (state) => {
                                state.dr += 9;
                                state.er += 13;
                                state.rr += 5;
                            }
                        },
                    }
                },
                "Vault76": {
                    name: "Vault 76",
                    mods: {
                        "Standard": {
                            name: "Standard",
                            default: true
                        },
                        "Treated": {
                            name: "Treated",
                            order: 2,
                            func: (state) => {
                                state.dr += 2;
                                state.er += 2;
                                state.rr += 2;
                            }
                        },
                        "Resistant": {
                            name: "Resistant",
                            order: 2,
                            func: (state) => {
                                state.dr += 3;
                                state.er += 3;
                                state.rr += 3;
                            }
                        },
                        "Protective": {
                            name: "Protective",
                            order: 2,
                            func: (state) => {
                                state.dr += 4;
                                state.er += 4;
                                state.rr += 4;
                            }
                        },
                        "Shielded": {
                            name: "Shielded",
                            order: 2,
                            func: (state) => {
                                state.dr += 5;
                                state.er += 5;
                                state.rr += 5;
                            }
                        },
                    }
                },
                "VaultTecUni": {
                    name: "Vault Tec University",
                    mods: {
                        "Standard": {
                            name: "Standard",
                            default: true
                        },
                        "Treated": {
                            name: "Treated",
                            order: 2,
                            func: (state) => {
                                state.dr += 2;
                                state.er += 2;
                                state.rr += 2;
                            }
                        },
                        "Resistant": {
                            name: "Resistant",
                            order: 2,
                            func: (state) => {
                                state.dr += 3;
                                state.er += 3;
                                state.rr += 3;
                            }
                        },
                        "Protective": {
                            name: "Protective",
                            order: 2,
                            func: (state) => {
                                state.dr += 4;
                                state.er += 4;
                                state.rr += 4;
                            }
                        },
                        "Shielded": {
                            name: "Shielded",
                            order: 2,
                            func: (state) => {
                                state.dr += 5;
                                state.er += 5;
                                state.rr += 5;
                            }
                        },
                    }
                },
            };

            function get(id) {
                return document.getElementById(id);
            }
            function getValue(id) {
                return get(id).value;
            }
            function getBool(id) {
                return get(id).checked;
            }

            function getOpt(id) {
                var sel = get(id);
                return sel.options[sel.selectedIndex];
            }

            function createSetFullLink(cll, part, index, slot) {
                var span = document.createElement("span");
                span.innerHTML = "&nbsp;&nbsp;&nbsp;";
                cll.appendChild(span);
                var fullSet = document.createElement("a");
                fullSet.innerText = "<*all>";
                fullSet.href = "#";
                fullSet.onclick = evt => makeFullSetSlot(part, index, slot);
                cll.appendChild(fullSet);
            }

            function createCatLevelRadio(group, name, title) {
                var lbl = document.createElement("label");
                lbl.className = "ptr";

                var radio = document.createElement("input");
                radio.name = group;
                radio.id = group + name;
                radio.type = "radio";
                radio.value = name;

                lbl.appendChild(radio);
                lbl.appendChild(document.createTextNode(title));

                return { lbl: lbl, radio: radio };
            }

            function create3Spaces() {
                var span = document.createElement("span");
                span.innerHTML = "&nbsp;";
                return span;
            }

            function createCategoryLevel(group, makeSel, partTypeSel, partCategorySel, partLevelSel) {
                if (!selectTypeCatLevelReverseMode) {
                    selectTypeCatLevelForwardMode = true;
                    try {
                        makeSel.selectedIndex = 0;
                        makeSel.dispatchEvent(new Event("input"));
                    } finally {
                        selectTypeCatLevelForwardMode = false;
                    }
                    get(group + "SetAll").style.display = "none";
                }
                partCategorySel.innerHTML = "";
                partLevelSel.innerHTML = "";

                if (partTypeSel.selectedIndex > 0) {
                    let opt = partTypeSel.options[partTypeSel.selectedIndex];
                    
                    let categoryAndLevelSelected = {};
                    categoryAndLevelSelected.key = opt.value;
                    var d = opt.data;
                    if (d.categories.length > 0) {
                        for (let cat of d.categories) {
                            var lblAndRadio = createCatLevelRadio(group + "Cat", cat, " " + cat);
                            partCategorySel.appendChild(lblAndRadio.lbl);
                            partCategorySel.appendChild(create3Spaces());

                            lblAndRadio.radio.oninput = evt => {
                                categoryAndLevelSelected.category = cat;
                                onCategoryLevelSelection(makeSel, categoryAndLevelSelected);
                            };
                        }
                    } else {
                        categoryAndLevelSelected.category = "";
                    }
                    if (d.levels.length == 1) {
                        partLevelSel.innerHTML = "Level - " + d.levels[0];
                        categoryAndLevelSelected.level = d.levels[0];
                    } else {
                        for (let lvl of d.levels) {
                            var lblAndRadio = createCatLevelRadio(group + "Lvl", lvl, " " + lvl);
                            partLevelSel.appendChild(lblAndRadio.lbl);
                            partLevelSel.appendChild(create3Spaces());

                            lblAndRadio.radio.oninput = evt => {
                                categoryAndLevelSelected.level = lvl;
                                onCategoryLevelSelection(makeSel, categoryAndLevelSelected);
                            };
                        }
                    }

                    onCategoryLevelSelection(makeSel, categoryAndLevelSelected);
                } else {
                    get(group + "SetAll").style.display = "inline";
                }
            }

            function onCategoryLevelSelection(makeSel, categoryAndLevelSelected) {
                if (categoryAndLevelSelected.category !== undefined && categoryAndLevelSelected.level !== undefined) {
                        selectTypeCatLevelForwardMode = true;
                        try {
                            var valueToSelect = categoryAndLevelSelected.key
                            + categoryAndLevelSelected.category
                            + "-" + categoryAndLevelSelected.level;
                            selectValue(makeSel, valueToSelect);
                        } finally {
                            selectTypeCatLevelForwardMode = false;
                        }
                    }

            }

            function createBodyPart(tbl, index, mode, part) {

                var rw = tbl.insertRow(tbl.rows.length);
                var cll = rw.insertCell(rw.cells.length);
                cll.className = "bold topline";
                var titleCll = cll;

                cll = rw.insertCell(rw.cells.length);
                cll.className = "topline";

                let makeSel = document.createElement("select");
                makeSel.style.display = "none";

                var span = document.createElement("span");
                span.id = part + index + "SetAll";
                //span.style.display = "none";
                span.innerHTML = "&nbsp;&nbsp;&nbsp;";
                var fullSet = document.createElement("a");
                fullSet.innerText = "<set all>";
                fullSet.id = part + index + "SetAll";
                fullSet.href = "#";
                fullSet.onclick = evt => makeFullSetSlot(part, index, "");
                span.appendChild(fullSet);

                // -------------------------------------------------

                var hierarchySorted = [];
                for (var e in armorHierarchy[mode]) {
                    hierarchySorted.push({key: e, value: armorHierarchy[mode][e] });
                }
                hierarchySorted.sort((a, b) => a.value.name.localeCompare(b.value.name));

                let partTypeSel = document.createElement("select");
                partTypeSel.id = part + index;
                cll.appendChild(partTypeSel);

                cll.appendChild(span);

                var opt = document.createElement("option");
                opt.text = "None";
                partTypeSel.options.add(opt);

                for (var h of hierarchySorted) {
                    opt = document.createElement("option");
                    opt.text = h.value.name;
                    opt.value = h.key;
                    opt.data = h.value;
                    partTypeSel.options.add(opt);
                }

                let partCategorySel = document.createElement("div");
                cll.appendChild(partCategorySel);
                let partLevelSel = document.createElement("div");
                cll.appendChild(partLevelSel);

                partTypeSel.oninput = (evt) => createCategoryLevel(part + index, makeSel, partTypeSel, partCategorySel, partLevelSel);

                // -------------------------------------------------

                cll.appendChild(makeSel);
                makeSel.id = index + "_Part_" + part;
                makeSel.oninput = evt => recalculateBoth();

                opt = document.createElement("option");
                opt.text = "None";
                makeSel.options.add(opt);

                var armors = armor[mode];

                var armorList = [];
                for (let a in armors) {
                    armorList.push({key: a, value: armors[a] });
                }
                armorList.sort((a, b) => a.value.name.localeCompare(b.value.name));

                for (let akv of armorList) {
                    let a = akv.key;
                    opt = document.createElement("option");
                    opt.text = "---";
                    opt.disabled = true;
                    makeSel.options.add(opt);
                    let am = armors[a];
                    let p = am[part];
                    if (p.use) {
                        p = am[p.use];
                    }
                    let pfunc = p.func;
                    titleCll.innerText = p.name;
                    for (let lvl in am.levels) {
                        opt = document.createElement("option");
                        opt.value = a + "-" + am.levels[lvl];
                        var lvlName = am.levels[lvl];
                        if (lvlName === "Any") {
                            opt.text = armors[a].name;
                        } else {
                            opt.text = armors[a].name + " - Level " + lvlName;
                        }
                        opt.level = lvl;
                        opt.data = {
                            order: p.order,
                            func: (state) => pfunc(state, lvl) 
                        }
                        opt.mods = p.mods;
                        opt.make = a;
                        if (am.set) {
                            opt.make = am.set;
                        }
                        opt.category = am.category;
                        makeSel.options.add(opt);
                    }
                }

                rw = tbl.insertRow(tbl.rows.length);
                rw.id = index + "_Part_" + part + "_ModStart";

                rw = tbl.insertRow(tbl.rows.length);
                cll = rw.insertCell(rw.cells.length);
                cll.innerText = "Mods";
                cll = rw.insertCell(rw.cells.length);
                cll.innerText = "<select armor make above>";

                rw = tbl.insertRow(tbl.rows.length);
                cll = rw.insertCell(rw.cells.length);
                cll.innerText = "Legendary";
                cll = rw.insertCell(rw.cells.length);
                cll.innerText = "<select armor make above>";

                rw = tbl.insertRow(tbl.rows.length);
                rw.id = index + "_Part_" + part + "_ModEnd";

                makeSel.oninput = evt => {
                    createMods(tbl, index, mode, part, makeSel);
                    recalculateBoth();
                };
            }

            function makeFullSetSlot(part, index, slot) {
                var sel = getOpt(index + "_Part_" + part + slot);

                for (var p of ["Helmet", "Torso", "LA", "RA", "LL", "RL"]) {
                    if (p != part) {
                        var s2 = get(index + "_Part_" + p + slot);
                            if (s2 != null) {

                            for (var i = 0; i < s2.options.length; i++) {
                                var o = s2.options[i];
                                if (o.value === sel.value && o.level == sel.level) {
                                    s2.selectedIndex = i;
                                    s2.dispatchEvent(new Event("input"));
                                    break;
                                }
                            }
                        }
                    }
                }
                return false;
            }

            var selectTypeCatLevelReverseMode = false;
            var selectTypeCatLevelForwardMode = false;

            function selectTypeCatLevelReverse(armorId, part, index) {
                if (armorId === "" || armorId === "None") {
                    selectTypeCatLevelReverseMode = true;
                    try {
                        selectValue(get(part + index), "None");
                    } finally {
                        selectTypeCatLevelReverseMode = false;
                    }
                    return;
                }
                var armorIdSplit = armorId.split("-");
                var cat = "";
                var type = "";
                for (var acat of ["Light", "Sturdy", "Heavy"]) {
                    var idx = armorIdSplit[0].indexOf(acat);
                    if (idx > 0) {
                        type = armorIdSplit[0].substring(0, idx);
                        cat = acat;
                        break;
                    }
                }
                if (type === "") {
                    type = armorIdSplit[0];
                }

                selectTypeCatLevelReverseMode = true;
                try {
                    selectValue(get(part + index), type);
                    if (cat !== "") {
                        var rb = get(part + index + "Cat" + cat);
                        rb.checked = true;
                        rb.dispatchEvent(new Event("input"));
                    }
                    var rb = get(part + index + "Lvl" + armorIdSplit[1]);
                    if (rb != null) {
                        rb.checked = true;
                        rb.dispatchEvent(new Event("input"));
                    }
                } finally {
                    selectTypeCatLevelReverseMode = false;
                }
            }

            function createMods(tbl, index, mode, part, sel) {
                if (selectTypeCatLevelReverseMode) {
                    return;
                }
                get(part + index + "SetAll").style.display = "inline";

                var sidx = findRow(tbl, index + "_Part_" + part + "_ModStart") + 1;
                var eidx = findRow(tbl, index + "_Part_" + part + "_ModEnd");
                removeRows(tbl, sidx, eidx);

                let opt = sel.options[sel.selectedIndex];
                let mods = opt.mods;
                let lvl = opt.level;

                if (!selectTypeCatLevelForwardMode) {
                    selectTypeCatLevelReverse(opt.value, part, index);
                }

                if (sel.selectedIndex > 0) {                    

                    rw = tbl.insertRow(sidx++);
                    cll = rw.insertCell(rw.cells.length);

                    cll.innerText = "Mods";

                    if (mods === undefined) {
                        cll = rw.insertCell(rw.cells.length);
                        cll.innerText = "No relevant mod";
                    } else {
                        for (var slot in mods) {
                            rw = tbl.insertRow(sidx++);
                            cll = rw.insertCell(rw.cells.length);

                            cll.innerHTML = "&nbsp;&nbsp;&nbsp;" + slot;
    
                            cll = rw.insertCell(rw.cells.length);
                            let modSel = document.createElement("select");
                            cll.appendChild(modSel);
                            createSetFullLink(cll, part, index, "_Mod_" + slot);
                            modSel.id = index + "_Part_" + part + "_Mod_" + slot;
                            modSel.oninput = evt => recalculateBoth();

                            if (mode === "PA") {
                                opt = document.createElement("option");
                                opt.text = "None";
                                modSel.options.add(opt);
                            }

                            var modList = [];

                            for (var m in mods[slot]) {
                                var mod = mods[slot][m];
                                modList.push({ key:m, value: mod});
                            }

                            modList.sort((a, b) => {
                                if (a.value.default && !b.value.default) {
                                    return -1;
                                }
                                if (!a.value.default && b.value.default) {
                                    return 1;
                                }
                                return a.value.name.localeCompare(b.value.name)
                            });

                            for (let mod of modList) {
                                opt = document.createElement("option");
                                opt.value = mod.key;
                                opt.text = mod.value.name;
                                opt.data = { 
                                    order: mod.value.order, 
                                    func: (state) => mod.value.func(state, lvl) };
                                modSel.options.add(opt);
                            }
                        }
                    }

                    rw = tbl.insertRow(sidx++);
                    cll = rw.insertCell(rw.cells.length);

                    cll.innerText = "Legendary";
                    if (legendaryEffects[mode] === undefined || part === "Helmet") {
                        cll = rw.insertCell(rw.cells.length);
                        cll.innerText = "Can't be legendary";
                    } else {
                        for (var le in legendaryEffects[mode]) {
                            var eff = legendaryEffects[mode][le];
                            rw = tbl.insertRow(sidx++);
                            cll = rw.insertCell(rw.cells.length);

                            cll.innerHTML = "&nbsp;&nbsp;&nbsp;" + le;

                            let legSel = document.createElement("select");
                            cll = rw.insertCell(rw.cells.length);
                            cll.appendChild(legSel);
                            createSetFullLink(cll, part, index, "_Legendary_" + le);
                            legSel.oninput = evt => recalculateBoth();
                            
                            legSel.id = index + "_Part_" + part + "_Legendary_" + le;
                            opt = document.createElement("option");
                            legSel.options.add(opt);

                            var effList = [];
                            for (var e in eff) {
                                effList.push({ key: e, value: eff[e] })
                            }
                            effList.sort((a, b) => a.value.name.localeCompare(b.value.name));

                            for (var e of effList) {
                                opt = document.createElement("option");
                                opt.value = e.key;
                                opt.text = e.value.name;
                                opt.data = { order: e.value.order, func: e.value.func };
                                legSel.options.add(opt);
                            }
                        }
                    }
                } else {
                    rw = tbl.insertRow(sidx++);
                    cll = rw.insertCell(rw.cells.length);
                    cll.innerText = "Mods";
                    cll = rw.insertCell(rw.cells.length);
                    cll.innerText = "<select armor make above>";

                    rw = tbl.insertRow(sidx++);
                    cll = rw.insertCell(rw.cells.length);
                    cll.innerText = "Legendary";
                    cll = rw.insertCell(rw.cells.length);
                    cll.innerText = "<select armor make above>";
                }
            }

            function findRow(tbl, id) {
                for (var i = 0; i < tbl.rows.length; i++) {
                    if (tbl.rows[i].id == id) {
                        return i;
                    }
                }
                return -1;
            }

            function removeRows(tbl, start, end) {
                if (end === undefined) {
                    end = tbl.rows.length;
                }
                for (var i = end - 1; i >= start; i--) {
                    tbl.deleteRow(i);
                }
            }

            function createNumber(tbl, name, key, min, max, value, unit, tip) {
                var rw = tbl.insertRow(tbl.rows.length);
                var cll = rw.insertCell(rw.cells.length);
                cll.innerHTML = "&nbsp;&nbsp;&nbsp;" + name;
                if (tip) {
                    cll.innerHTML += info(tip);
                }

                cll = rw.insertCell(rw.cells.length);

                var input = document.createElement("input");
                cll.appendChild(input);
                input.type = "number";
                input.min = min;
                input.max = max;
                input.value = value;
                input.className = "num6";
                input.id = key;

                if (unit) {
                    cll.appendChild(document.createTextNode(unit));
                }
                return input;
            }

            function createParams(tbl, index, mode) {
                var rw = tbl.insertRow(tbl.rows.length);
                var cll = rw.insertCell(rw.cells.length);
                cll.innerHTML = "Player";
                cll.className = "topline bold";
                cll = rw.insertCell(rw.cells.length);
                cll.className = "topline";

                createNumber(tbl, "Health", index + "_HP", 0, 100, 100, " %", "health").oninput = evt => recalculateBoth();
                if (mode !== "Suit") {
                    createNumber(tbl, "Caps", index + "_Caps", 0, 30000, 0, "", "caps").oninput = evt => recalculateBoth();
                    createNumber(tbl, "Food &amp; Drink", index + "_Fooddrink", 0, 100, 100, " %", "food").oninput = evt => recalculateBoth();
                    createNumber(tbl, "Carrying", index + "_Carry", 0, 30000, 0, " lb", "carry").oninput = evt => recalculateBoth();
                }
                createNumber(tbl, "Teammates", index + "_Teammates", 0, 3, 0, "", "teammates").oninput = evt => recalculateBoth();
                createNumber(tbl, "&nbsp;&nbsp;&nbsp;Deaths", index + "_Teamdeaths", 0, 3, 0, "", "teamdeaths").oninput = evt => recalculateBoth();

                if (mode !== "PA") {
                    createNumber(tbl, "Strength", index + "_Strength", 1, 100, 1, " points", "strength").oninput = evt => recalculateBoth();
                    createNumber(tbl, "Agility", index + "_Agility", 1, 100, 1, " points", "agility").oninput = evt => recalculateBoth();
                    createNumber(tbl, "Junk Amount", index + "_Junkamount", 0, 46, 0, "", "junkamount").oninput = evt => recalculateBoth();
                }

                createYesNo(tbl, index, "Night", "&nbsp;&nbsp;&nbsp;Night time", "night");
                createYesNo(tbl, index, "Block", "&nbsp;&nbsp;&nbsp;Blocking", "blocking");
                createYesNo(tbl, index, "Fireheavy", "&nbsp;&nbsp;&nbsp;Firing a heavy gun", "fireheavy");
                createYesNo(tbl, index, "Sneak", "&nbsp;&nbsp;&nbsp;Sneaking", "sneak");
                createYesNo(tbl, index, "Suppressorweapon", "&nbsp;&nbsp;&nbsp;Suppressor's weapon", "suppressorweapon", orderFunc(2, (state) => {
                    var rs = getOrCreateReductionSlot(state, "Suppressor");
                    rs.ballisticReduction += 25;
                    rs.energyReduction += 25;
                }));

                rw = tbl.insertRow(tbl.rows.length);
                cll = rw.insertCell(rw.cells.length);
                cll.innerHTML = "&nbsp;&nbsp;&nbsp;Stance" + info("stance");

                cll = rw.insertCell(rw.cells.length);

                var stanceSel = document.createElement("select");
                cll.appendChild(stanceSel);
                stanceSel.id = index + "_Stance";

                var opt = document.createElement("option");
                opt.value = "Run";
                opt.text = "Running";
                stanceSel.options.add(opt);

                opt = document.createElement("option");
                opt.value = "Sprint";
                opt.text = "Sprinting";
                stanceSel.options.add(opt);

                opt = document.createElement("option");
                opt.value = "Still";
                opt.text = "Standing Still";
                stanceSel.options.add(opt);

                stanceSel.oninput = evt => recalculateBoth();

                createSelectWithFunc(tbl, "&nbsp;&nbsp;&nbsp;Weapon resistance", index + "_Weaponmode", ["None", "+50 DR while Aiming", "+250 DR while Reloading", "-40% DMG while Power Attacking"], ["", "50", "250", "P40"],
                    "", 2, (state, val) => {
                        if (val.startsWith("P")) {
                            var rs = getOrCreateReductionSlot(state, "powerattack");
                            rs.ballisticReduction += 40;
                            rs.energyReduction += 40;
                        } else {
                            state.dr += parseInt(val);
                        }
                    }, "weaponmode").oninput = evt => recalculateBoth();

                if (mode != "Suit") {
                    createNumber(tbl, "Guardian's", index + "_Guardians", 0, 15, 0, " armor pieces", "guardians").oninput = evt => recalculateBoth();
                }
            }

            function createBlockerFunc(amount) {
                return orderFunc(2, (state) => {
                    if (state.enemy.damageType === "melee") {
                        var rs = getOrCreateReductionSlot(state, "Blocker");
                        rs.ballisticReduction += amount;
                        rs.energyReduction += amount;
                    }
                });
            }

            function clamp(v, min, max) {
                if (v < min) {
                    return min;
                }
                if (v > max) {
                    return max;
                }
                return v;
            }

            function createJunkShieldFunc(amount) {
                return orderFunc(2, state => {
                    var ja = clamp(state.player.junkamount, 0, 46);
                    var res = Math.floor((ja + 4) / 5);
                    state.dr += res * amount;
                    state.er += res * amount;
                });
            }

            function createBodyGuardFunc(amount) {
                return orderFunc(2, state => {
                    var res = amount * clamp(state.player.teammates, 0, 3);
                    state.dr += res;
                    state.er += res;
                });
            }

            function createPerks(tbl, index, mode) {
                rw = tbl.insertRow(tbl.rows.length);
                cll = rw.insertCell(rw.cells.length);
                cll.innerHTML = "Perks";
                cll.className = "bold";

                if (mode !== "PA") {
                    createSelectWithFunc(tbl, "&nbsp;&nbsp;&nbsp;Barbarian", index + "_Barbarian", ["None", "1", "2", "3"], ["", "2", "3", "4"],
                    " (rank)", 2, (state, val) => {
                        state.dr += parseInt(val) * clamp(state.player.strength, 1, 20);
                    }, "barbarian").oninput = evt => recalculateBoth();
                }
                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Blocker", index + "_Blocker", ["None", "1", "2", "3"], ["", "15", "30", "45"], [
                    null,
                    createBlockerFunc(15),
                    createBlockerFunc(30),
                    createBlockerFunc(45)
                ], false, " (rank)", "blocker").oninput = evt => recalculateBoth();
                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Bodyguards", index + "_Bodyguards", ["None", "1", "2", "3", "4"], ["", "6", "8", "10", "12"], [
                    null,
                    createBodyGuardFunc(6),
                    createBodyGuardFunc(8),
                    createBodyGuardFunc(10),
                    createBodyGuardFunc(12),
                ], false, " (rank)", "bodyguards").oninput = evt => recalculateBoth();
                createSelectWithFunc(tbl, "&nbsp;&nbsp;&nbsp;Bullet Shield", index + "_Bulletshield", ["None", "1", "2", "3"], ["", "20", "40", "60"],
                " (rank)", 2, (state, val) => {
                    if (state.player.fireheavy) {
                        state.dr += parseInt(val);
                    }
                }, "bulletshield").oninput = evt => recalculateBoth();
                createSelectWithFunc(tbl, "&nbsp;&nbsp;&nbsp;Class Freak", index + "_Classfreak", ["None", "1", "2", "3"], ["", "25", "50", "75"], " (rank)", 1,
                    (state, val) => state.player.classFreak = parseInt(val)
                , "classfreak").oninput = evt => recalculateBoth();
                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Cola Nut", index + "_Colanut", ["None", "1", "2"], ["", "2", "3"], [
                    null,
                    orderFunc(0, state => state.player.colanut = 2),
                    orderFunc(0, state => state.player.colanut = 3),
                ], false, " (rank)", "colanut").oninput = evt => recalculateBoth();
                createSelectWithFunc(tbl, "&nbsp;&nbsp;&nbsp;Dodgy", index + "_Dodgy", ["None", "1", "2", "3"], ["", "10", "20", "30"],
                " (rank)", 2, (state, val) => {
                    var rs = getOrCreateReductionSlot(state, "Dodgy");
                    rs.ballisticReduction += parseInt(val);
                    rs.energyReduction += parseInt(val);
                }, "dodgy").oninput = evt => recalculateBoth();
                if (mode !== "PA") {
                    createSelectWithFunc(tbl, "&nbsp;&nbsp;&nbsp;Evasive", index + "_Evasive", ["None", "1", "2", "3"], ["", "1", "2", "3"],
                    " (rank)", 2, (state, val) => {
                        var c = parseInt(val) * clamp(state.player.agility, 1, 15);
                        state.dr += c;
                        state.er += c;
                    }, "evasive").oninput = evt => recalculateBoth();
                }
                createSelectWithFunc(tbl, "&nbsp;&nbsp;&nbsp;Fireproof", index + "_Fireproof", ["None", "1", "2", "3"], ["", "15", "30", "45"],
                " (rank)", 2, (state, val) => {
                    var rs = getOrCreateReductionSlot(state, "Fireproof");
                    rs.fireReduction += parseInt(val);
                    rs.explosiveReduction += parseInt(val);
                }, "fireproof").oninput = evt => recalculateBoth();
                if (mode !== "PA") {
                    createSelectWithFunc(tbl, "&nbsp;&nbsp;&nbsp;Ironclad", index + "_Ironclad", ["None", "1", "2", "3", "4", "5"], ["", "10", "20", "30", "40", "50"],
                    " (rank)", 2, (state, val) => {
                        var c = parseInt(val);
                        state.dr += c;
                        state.er += c;
                    }, "ironclad").oninput = evt => recalculateBoth();
                }
                if (mode !== "PA") {
                    createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Junk Shield", index + "_Junkshield", ["None", "1", "2", "3"], ["", "10", "20", "30"], [
                        null,
                        createJunkShieldFunc(1),
                        createJunkShieldFunc(2),
                        createJunkShieldFunc(3),
                    ], false, " (rank)", "junkshield").oninput = evt => recalculateBoth();
                }
                createSelectWithFunc(tbl, "&nbsp;&nbsp;&nbsp;Lone Wanderer", index + "_Lonewanderer", ["None", "1", "2", "3"], ["", "10", "15", "20"],
                " (rank)", 2, (state, val) => {
                    var rs = getOrCreateReductionSlot(state, "Lonewanderer");
                    rs.ballisticReduction += parseInt(val);
                    rs.energyReduction += parseInt(val);
                }, "lonewanderer").oninput = evt => recalculateBoth();
                if (mode !== "PA") {
                    createSelectWithFunc(tbl, "&nbsp;&nbsp;&nbsp;Moving Target", index + "_Movingtarget", ["None", "1", "2", "3"], ["", "15", "30", "45"],
                    " (rank)", 2, (state, val) => {
                        if (state.player.stance === "Sprint") {
                            var c = parseInt(val);
                            state.dr += c;
                            state.er += c;
                        }
                    }, "movingtarget").oninput = evt => recalculateBoth();
                }
                createSelectWithFunc(tbl, "&nbsp;&nbsp;&nbsp;Nerd Rage", index + "_Nerdrage", ["None", "1", "2", "3"], ["", "20", "30", "40"],
                " (rank)", 2, (state, val) => {
                    if (state.player.hp <= 20) {
                        state.dr += parseInt(val);
                    }
                }, "nerdrage").oninput = evt => recalculateBoth();
                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Party Person", index + "_Partyperson", ["None", "1", "2"], ["", "2", "3"], [
                    null,
                    orderFunc(0, state => state.player.partyPerson = 2),
                    orderFunc(0, state => state.player.partyPerson = 3),
                ], false, " (rank)", "partyperson").oninput = evt => recalculateBoth();
                createSelectWithFunc(tbl, "&nbsp;&nbsp;&nbsp;Rad Resistant", index + "_Radresistant", ["None", "1", "2", "3", "4"], ["", "10", "20", "30", "40"],                
                " (rank)", 2, (state, val) => {
                    state.rr += parseInt(val);
                }, "radresistant").oninput = evt => recalculateBoth();
                createSelectWithFunc(tbl, "&nbsp;&nbsp;&nbsp;Refractor", index + "_Refractor", ["None", "1", "2", "3", "4"], ["", "10", "20", "30", "40"],
                " (rank)", 2, (state, val) => {
                    state.er += parseInt(val);
                }, "refractor").oninput = evt => recalculateBoth();
                if (mode !== "PA") {
                    createSelectWithFunc(tbl, "&nbsp;&nbsp;&nbsp;Serendipity", index + "_Serendipity", ["None", "1", "2", "3"], ["", "15", "30", "45"],
                    " (rank)", 2, (state, val) => {
                        if (state.player.hp <= 30) {
                            var rs = getOrCreateReductionSlot(state, "Serendipity");
                            var c = parseInt(val);
                            rs.ballisticReduction += c;
                            rs.energyReduction += c;
                        }
                    }, "serendipity").oninput = evt => recalculateBoth();
                    //createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Adamantium Skeleton", index + "_Adamantium", ["None", "1", "2", "3"], ["", "30", "60", "100"]).oninput = evt => recalculateBoth();
                }
                createYesNo(tbl, index, "Strangeinnumbers", "&nbsp;&nbsp;&nbsp;Strange In Numbers", "strangeinnumbers", 
                    orderFunc(0, state => state.player.strangeInNumbers = true)
                );
                createSelectWithFunc(tbl, "&nbsp;&nbsp;&nbsp;Suppressor", index + "_Suppressor", ["None", "1", "2", "3"], ["", "10", "20", "30"],
                " (rank)", 2, (state, val) => {
                    var rs = getOrCreateReductionSlot(state, "Suppressor");
                    rs.ballisticReduction += parseInt(val);
                    rs.energyReduction += parseInt(val);
                }, "suppressor").oninput = evt => recalculateBoth();

                rw = tbl.insertRow(tbl.rows.length);
                cll = rw.insertCell(rw.cells.length);
                cll.innerHTML = "Legendary Perks";
                cll.className = "bold";

                createSelectWithFunc(tbl, "&nbsp;&nbsp;&nbsp;Blood Sacrifice", index + "_Bloodsacrifice", ["None", "1", "2", "3", "4"], ["", "25", "30", "35", "40"],
                " (rank)", 2, (state, val) => {
                    if (state.player.teamdeaths > 0) {
                        state.dr += parseInt(val);
                    }
                }, "bloodsacrifice").oninput = evt => recalculateBoth();
                createSelectWithFunc(tbl, "&nbsp;&nbsp;&nbsp;Funky Duds", index + "_Funkyduds", ["None", "1", "2", "3", "4"], ["", "50", "100", "150", "200"],
                " (rank)", 2, (state, val) => {
                    if (state.player.fullSet) {
                        state.pr += parseInt(val);
                    }
                }, "funkyduds").oninput = evt => recalculateBoth();
                createSelectWithFunc(tbl, "&nbsp;&nbsp;&nbsp;Sizzling Style", index + "_Sizzlingstyle", ["None", "1", "2", "3", "4"], ["", "50", "100", "150", "200"],
                " (rank)", 2, (state, val) => {
                    if (state.player.fullSet) {
                        state.fr += parseInt(val);
                    }
                }, "sizzlingstyle").oninput = evt => recalculateBoth();
                createSelectWithFunc(tbl, "&nbsp;&nbsp;&nbsp;What Rads", index + "_Whatrads", ["None", "1", "2", "3", "4"], ["", "50", "75", "100", "300"],
                " (rank)", 2, (state, val) => {
                    if (state.player.fullSet) {
                        state.rr += parseInt(val);
                    }
                }, "whatrads").oninput = evt => recalculateBoth();

            }

            function createSelectWithFunc(tbl, name, key, texts, values, unit, order, func, tip) {
                var data = [ null ];
                for (var i  = 1; i < values.length; i++) {
                    let val = values[i];
                    data.push(orderFunc(order, state => func(state, val)));
                }
                return createSelectWithData(tbl, name, key, texts, values, data, false, unit, tip);
            }

            function createOptions(sel, texts, values, data) {
                for (var i = 0; i < texts.length; i++) {
                    var opt = document.createElement("option");
                    opt.text = texts[i];
                    opt.value = values[i];
                    if (data) {
                        opt.data = data[i];
                    }
                    sel.options.add(opt);
                }
            }

            function createSelectWithData(tbl, name, key, texts, values, data, fullLine, unit, tip) {
                var rw = tbl.insertRow(tbl.rows.length);
                var cll = rw.insertCell(rw.cells.length);
                cll.innerHTML = name;
                if (tip) {
                    cll.innerHTML += info(tip);
                }

                if (fullLine) {
                    rw = tbl.insertRow(tbl.rows.length);
                }
                cll = rw.insertCell(rw.cells.length);
                if (fullLine) {
                    cll.colSpan = 2;
                    var span = document.createElement("span");
                    span.innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
                    cll.appendChild(span);
                }
                var sel = document.createElement("select");
                sel.id = key;
                cll.appendChild(sel);

                createOptions(sel, texts, values, data);

                if (unit) {
                    cll.appendChild(document.createTextNode(unit));
                }

                return sel;
            }

            function createMutations(tbl, index, mode) {
                var rw = tbl.insertRow(tbl.rows.length);
                var cll = rw.insertCell(rw.cells.length);
                cll.innerHTML = "Mutations";
                cll.className = "bold";

                createSelectWithFunc(tbl, "&nbsp;&nbsp;&nbsp;Empath", index + "_Empath",
                        ["None", "Self", "Teammate", "Both"],
                        ["", "Self", "Teammate", "Both"],
                        "", 2, (state, val) => {
                            var rs = getOrCreateReductionSlot(state, "Empath");
                            if (val === "Self" || val === "Both") {
                                var cf = 0;
                                if (state.player.classFreak) {
                                    cf = state.player.classFreak;
                                }
                                rs.ballisticReduction += -33 * (1 - cf / 100);
                                rs.energyReduction += -33 * (1 - cf / 100);
                            }
                            if (val === "Teammate" || val === "Both") {
                                rs.ballisticReduction += 25;
                                rs.energyReduction += 25;
                            }
                        }
                ,"empath").oninput = evt => recalculateBoth();

                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Food-related", index + "_Foodbuff", 
                    ["None", "Carnivore", "Herbivore"], 
                    ["", "Carnivore", "Herbivore"],
                    [
                        null,
                        orderFunc(1, state => {
                            state.player.carnivore = true;
                            state.player.mutations++;
                        }),
                        orderFunc(1, state => { 
                            state.player.herbivore = true; 
                            state.player.mutations++;
                        }),
                    ]
                ,false, "", "foodrelated").oninput = evt => recalculateBoth();

                createYesNo(tbl, index, "Grounded", "&nbsp;&nbsp;&nbsp;Grounded", "grounded", 
                    orderFunc(1, state => {
                        if (state.player.strangeInNumbers && state.player.teammates > 0) {
                            state.er += 125;
                        } else {
                            state.er += 100;
                        }
                        state.player.mutations++;
                    })
                );
                createYesNo(tbl, index, "Scalyskin", "&nbsp;&nbsp;&nbsp;Scaly Skin", "scalyskin", 
                    orderFunc(1, state => {
                        if (state.player.strangeInNumbers && state.player.teammates > 0) {
                            state.dr += 62;
                            state.er += 62;
                        } else {
                            state.dr += 50;
                            state.er += 50;
                        }
                        state.player.mutations++;
                    })
                );
            }

            function createConsumableList(cll, index, mode, consumableName) {
                var foodDiv = document.createElement("div");
                foodDiv.style.height = 120;
                foodDiv.style.paddingLeft = 40;
                foodDiv.style.overflowY = "scroll";
                cll.appendChild(foodDiv);
                let foodList = [];
                for (var food in consumables[consumableName]) {
                    var f = consumables[consumableName][food];

                    foodList.push({key: food, value: f });
                }
                foodList.sort((a, b) => a.value.name.localeCompare(b.value.name));
                var fcnt = 0;
                for (let f of foodList) {
                    if (fcnt++ > 0) {
                        foodDiv.appendChild(document.createElement("br"));
                    }
                    var lbl = document.createElement("label");
                    foodDiv.appendChild(lbl);

                    var cb = document.createElement("input");
                    cb.type = "checkbox";
                    cb.id = index + "_" + consumableName + "_" + f.key;
                    cb.value = "Food_" + f.key;
                    cb.data = {
                        order: f.value.order,
                        func: f.value.func,
                    };
                    f.cb = cb;
                    f.debuff = f.value.debuff;
                    cb.oninput = evt => {
                        debuff(foodList, f);
                        recalculateBoth();
                    };
                    lbl.appendChild(cb);

                    lbl.appendChild(document.createTextNode(" " + f.value.name));
                }
            }

            function debuff(list, current) {
                if (current.value.debuff) {
                    for (var key of current.value.debuff) {
                        for (var f of list) {
                            if (f != current) {
                                if (f.debuff && f.debuff.includes(key)) {
                                    f.cb.checked = false;
                                }
                            }
                        }
                    }
                }
            }

            function createConsumables(tbl, index, mode) {
                var rw = tbl.insertRow(tbl.rows.length);
                var cll = rw.insertCell(rw.cells.length);
                cll.innerHTML = "Consumables";
                cll.className = "bold";

                rw = tbl.insertRow(tbl.rows.length);                
                cll = rw.insertCell(rw.cells.length);

                cll.innerHTML = "&nbsp;&nbsp;&nbsp;Food";
                rw = tbl.insertRow(tbl.rows.length);                
                cll = rw.insertCell(rw.cells.length);
                cll.colSpan = 2;

                createConsumableList(cll, index, mode, "Food");


                rw = tbl.insertRow(tbl.rows.length);                
                cll = rw.insertCell(rw.cells.length);
                cll.innerHTML = "&nbsp;&nbsp;&nbsp;Drink";

                rw = tbl.insertRow(tbl.rows.length);                
                cll = rw.insertCell(rw.cells.length);
                cll.colSpan = 2;

                createConsumableList(cll, index, mode, "Drink");

                rw = tbl.insertRow(tbl.rows.length);                
                cll = rw.insertCell(rw.cells.length);
                cll.innerHTML = "&nbsp;&nbsp;&nbsp;Chem";

                rw = tbl.insertRow(tbl.rows.length);                
                cll = rw.insertCell(rw.cells.length);
                cll.colSpan = 2;

                createConsumableList(cll, index, mode, "Chem");

                var texts = ["None"];
                var values = [""];
                var data = [null];
                var magList = [];
                for (var mag in consumables["Magazine"]) {
                    var m = consumables["Magazine"][mag];
                    magList.push({ key: mag, value: m })
                }
                magList.sort((a, b) => a.value.name.localeCompare(b.value.name));

                for (var kv of magList) {
                    texts.push(kv.value.name);
                    values.push(kv.key);
                    data.push({ order: kv.value.order, func: kv.value.func });

                }
                createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Magazine", index + "_Magazine", texts, values, data, true).oninput = evt => recalculateBoth();
            }

            function createResults(tbl, index, mode) {
                var rw = tbl.insertRow(tbl.rows.length);
                var cll = rw.insertCell(rw.cells.length);

                cll.className = "topline results";
                cll.innerText = "Resistances";

                cll = rw.insertCell(rw.cells.length);
                cll.className = "topline results";
                cll.id = "Resistances" + index;

                rw = tbl.insertRow(tbl.rows.length);
                cll = rw.insertCell(rw.cells.length);

                cll.className = "results";
                cll.innerText = "Reductions";

                cll = rw.insertCell(rw.cells.length);
                cll.className = "results";
                cll.id = "Reductions" + index;
            }

            function createYesNo(tbl, index, key, name, tip, data) {
                var rw = tbl.insertRow(tbl.rows.length);
                var cll = rw.insertCell(rw.cells.length);
                cll.innerHTML = name;
                if (tip !== undefined) {
                    cll.innerHTML += info(tip);
                }

                cll = rw.insertCell(rw.cells.length);
                
                var yes = createRadio(index + "_" + key, index + "_" + key + "_yes", "Yes");
                yes.radio.data = data;
                yes.radio.oninput = evt => recalculateBoth();
                cll.appendChild(yes.label);

                var sep = document.createElement("span");
                cll.appendChild(sep);
                sep.innerHTML = "&nbsp;&nbsp;&nbsp;";

                var no = createRadio(index + "_" + key, index + "_" + key + "_no", "No");
                no.radio.oninput = evt => recalculateBoth();
                no.radio.checked = "checked";
                cll.appendChild(no.label);
            }

            function createRadio(key, id, name) {
                var lblYes = document.createElement("label");
                lblYes.className = "ptr";

                var yes = document.createElement("input");
                lblYes.appendChild(yes);
                yes.id = id;
                yes.type = "radio";
                yes.name = key;

                lblYes.appendChild(document.createTextNode(name));

                return { label: lblYes, radio : yes };
            }

            function createUnderarmor(tbl, index, mode) {
                var rw = tbl.insertRow(tbl.rows.length);
                var cll = rw.insertCell(rw.cells.length);
                cll.className = "topline bold";
                cll.innerText = "Underarmor";
                cll = rw.insertCell(rw.cells.length);
                cll.className = "topline";

                var ulist = [];
                for (ua in underarmor) {
                    ulist.push({key: ua, value: underarmor[ua]});
                }
                ulist.sort((a, b) => a.value.name.localeCompare(b.value.name));

                let uMakeSel = document.createElement("select");
                cll.appendChild(uMakeSel);

                var opt = document.createElement("option");
                opt.text = "None";
                uMakeSel.options.add(opt);

                rw = tbl.insertRow(tbl.rows.length);
                cll = rw.insertCell(rw.cells.length);
                cll.innerText = "Lining";
                cll = rw.insertCell(rw.cells.length);

                let uLiningSel = document.createElement("select");
                cll.appendChild(uLiningSel);
                uLiningSel.style.display = "none";
                let uLiningNone = document.createElement("span");
                uLiningNone.innerText = "< select an underarmor >";
                uLiningNone.style.display = "inline";
                cll.appendChild(uLiningNone);

                let underarmorSel = document.createElement("select");
                underarmorSel.id = index + "_Underarmor";
                underarmorSel.style.display = "none";
                cll.appendChild(underarmorSel);

                opt = document.createElement("option");
                opt.text = "None";
                underarmorSel.options.add(opt);

                for (let ua of ulist) {
                    opt = document.createElement("option");
                    opt.text = ua.value.name;
                    opt.value = ua.key;
                    uMakeSel.options.add(opt);

                    for (let lnKey in ua.value.mods) {
                        let ln = ua.value.mods[lnKey];

                        opt = document.createElement("option");
                        opt.text = ua.value.name + " - " + ln.name;
                        opt.key = ua.key;
                        opt.mod = lnKey;
                        opt.value = ua.key + "-" + lnKey;
                        opt.data = { order: ln.order, func: ln.func };
                        underarmorSel.options.add(opt);
                    }
                }

                uMakeSel.oninput = evt => onUnderarmorMakeSelect(underarmorSel, uMakeSel, uLiningSel, uLiningNone);
                uLiningSel.oninput = evt => onLiningSelect(underarmorSel, uMakeSel, uLiningSel, uLiningNone);
                underarmorSel.oninput = evt => onUnderarmorSelect(underarmorSel, uMakeSel, uLiningSel, uLiningNone);
            }

            var underarmorForwardSelectMode = false;
            var underarmorReverseSelectMode = false;
            
            function onLiningSelect(usel, umakesel, uliningsel, uLiningNone) {
                if (underarmorReverseSelectMode) {
                    return;
                }
                underarmorForwardSelectMode = true;
                try {
                    if (umakesel.selectedIndex > 0 && uliningsel.selectedIndex > 0) {
                        var optMake = umakesel.options[umakesel.selectedIndex];
                        var optLining = uliningsel.options[uliningsel.selectedIndex];

                        selectValue(usel, optMake.value + "-" + optLining.value);
                    }
                } finally {
                    underarmorForwardSelectMode = false;
                }
                recalculateBoth();
            }

            function onUnderarmorMakeSelect(usel, umakesel, uliningsel, uLiningNone) {
                if (!underarmorReverseSelectMode) {
                    usel.selectedIndex = 0;
                }
                if (umakesel.selectedIndex > 0) {
                    uLiningNone.style.display = "none";
                    uliningsel.style.display = "inline";

                    uliningsel.options.length = 0;
                    var ua = umakesel.options[umakesel.selectedIndex];
                    for (var lnKey in underarmor[ua.value].mods) {
                        var opt = document.createElement("option");
                        opt.text = underarmor[ua.value].mods[lnKey].name;
                        opt.value = lnKey;
                        uliningsel.options.add(opt);
                    }
                } else {
                    uLiningNone.style.display = "inline";
                    uliningsel.style.display = "none";
                }
                recalculateBoth();
            }
            function onUnderarmorSelect(usel, umakesel, uliningsel, uLiningNone) {
                if (underarmorForwardSelectMode) {
                    return;
                }
                underarmorReverseSelectMode = true;
                try {
                    if (usel.selectedIndex > 0) {
                        var opt = usel.options[usel.selectedIndex];
                        selectValue(umakesel, opt.key);
                        uliningsel.style.display = "inline";
                        uLiningNone.style.display = "none";
                        selectValue(uliningsel, opt.mod);
                    } else {
                        umakesel.selectedIndex = 0;
                        uliningsel.style.display = "none";
                        uLiningNone.style.display = "inline";
                    }
                } finally {
                    underarmorReverseSelectMode = false;
                }
                recalculateBoth();
            }

            function createBackpack(tbl, index, mode) {
                var rw = tbl.insertRow(tbl.rows.length);
                var cll = rw.insertCell(rw.cells.length);
                cll.className = "topline bold";
                cll.innerText = "Other";
                cll = rw.insertCell(rw.cells.length);
                cll.className = "topline";

                var modList = [];
                for (var bm in backpackMods) {
                    modList.push({key: bm, value: backpackMods[bm] })
                }
                modList.sort((a, b) => a.value.name.localeCompare(b.value.name));

                rw = tbl.insertRow(tbl.rows.length);
                cll = rw.insertCell(rw.cells.length);
                cll.innerHTML = "&nbsp;&nbsp;&nbsp;Backpack";

                cll = rw.insertCell(rw.cells.length);

                let modSel = document.createElement("select");
                modSel.id = "Backpack" + index + "Mod";

                let modLevelSel = document.createElement("select");
                modLevelSel.id = index + "_Backpack";
                modLevelSel.style.display = "none";

                let backpackLevelRadios = [];

                modSel.oninput = evt => {
                    onBackpackForwardSelect(modLevelSel, modSel, backpackLevelRadios);
                };

                cll.appendChild(modSel);

                var opt = document.createElement("option");
                    opt.value = "";
                    opt.text = "None";
                    modSel.options.add(opt);

                for (let bm of modList) {
                    opt = document.createElement("option");
                    opt.value = bm.key;
                    opt.text = bm.value.name;
                    modSel.options.add(opt);
                }

                let levelSel = document.createElement("div");
                cll.appendChild(levelSel);


                for (let lvl of backpackLevels) {
                    var rb = createCatLevelRadio("Backpack" + index + "Lvl", lvl, lvl);
                    levelSel.append(rb.lbl);
                    levelSel.appendChild(create3Spaces());
                    backpackLevelRadios.push(rb.radio);

                    rb.radio.oninput = evt => {
                        onBackpackForwardSelect(modLevelSel, modSel, backpackLevelRadios);
                    };
                }

                cll.appendChild(modLevelSel);

                opt = document.createElement("option");
                    opt.value = "";
                    opt.text = "None";
                    modLevelSel.options.add(opt);

                for (let bm of modList) {
                    for (let blIdx = 0; blIdx < backpackLevels.length; blIdx++) {
                        let bl = backpackLevels[blIdx];
                        opt = document.createElement("option");
                        opt.value = bm.key + "-" + bl;
                        opt.text = bm.value.name + " - " + bl;
                        opt.lvl = bl;
                        opt.key = bm.key;
                        opt.data = { 
                            order: bm.value.order, 
                            func: (state) => bm.value.func(state, blIdx)
                        };
                        modLevelSel.options.add(opt);
                    }
                }
                modLevelSel.oninput = evt => {
                    onBackpackReverseSelect(modLevelSel, modSel, backpackLevelRadios);
                    recalculateBoth();
                }
                // createSelectWithData(tbl, "&nbsp;&nbsp;&nbsp;Backpack", index + "_Backpack", texts, values, data).oninput = evt => recalculateBoth();
            }

            var backpackForwardSelectMode = false;
            var backpackReverseSelectMode = false;

            function onBackpackForwardSelect(sel, modSel, backpackLevelRadios) {
                if (backpackReverseSelectMode) {
                    return;
                }
                backpackForwardSelectMode = true;
                try {
                    if (modSel.selectedIndex == 0) {
                        sel.selectedIndex = 0;
                        sel.dispatchEvent(new Event("input"));
                    } else {
                        var opt = modSel.options[modSel.selectedIndex];
                        var mod = opt.value;
                        var lvl = "";
                        for (var rb of backpackLevelRadios) {
                            if (rb.checked) {
                                lvl = rb.value;
                                break;
                            }
                        }
                        if (lvl !== "") {
                            selectValue(sel, mod + "-" + lvl);
                        }
                    }
                } finally {
                    backpackForwardSelectMode = false;
                }
            }

            function onBackpackReverseSelect(sel, modSel, backpackLevelRadios) {
                if (backpackForwardSelectMode) {
                    return;
                }
                backpackReverseSelectMode = true;
                try {
                    if (sel.selectedIndex == 0) {
                        modSel.selectedIndex = 0;
                        for (var rb of backpackLevelRadios) {
                            rb.checked = false;
                        }
                        modSel.dispatchEvent(new Event("input"));
                    } else {
                        var opt = sel.options[sel.selectedIndex];
                        for (var rb of backpackLevelRadios) {
                            rb.checked = rb.value == opt.lvl;
                        }
                        selectValue(modSel, opt.key);
                    }
                } finally {
                    backpackReverseSelectMode = false;
                }

            }

            function createSide(index, mode) {                
                var tbl = get("table" + index);
                removeRows(tbl, 1);
                if (mode === "PA") {
                    createBodyPart(tbl, index, mode, "Helmet");
                }
                if (mode !== "Suit") {
                    createBodyPart(tbl, index, mode, "Torso");
                    createBodyPart(tbl, index, mode, "LA");
                    createBodyPart(tbl, index, mode, "RA");
                    createBodyPart(tbl, index, mode, "LL");
                    createBodyPart(tbl, index, mode, "RL");
                }
                if (mode === "Suit") {
                    createBodyPart(tbl, index, mode, "Body");
                }
                if (mode === "NonPA") {
                    createUnderarmor(tbl, index, mode);
                }
                if (mode !== "PA") {
                    createBackpack(tbl, index, mode);
                }
                createParams(tbl, index, mode);
                createPerks(tbl, index, mode);
                createMutations(tbl, index, mode);
                createConsumables(tbl, index, mode);

                createResults(tbl, index, mode);

                recalculateBoth();
            }

            function orderFunc(order, func) {
                return {
                    order: order,
                    func: func
                };
            }

            function getOrCreateReductionSlot(state, name) {
                var rs = state.reductionSlots[name];
                if (!rs) {
                    rs = {
                        ballisticReduction: 0,
                        energyReduction: 0,
                        radiationReduction: 0,
                        fireReduction: 0,
                        cryoReduction: 0,
                        poisonReduction: 0,
                        explosiveReduction: 0,
                    }
                    state.reductionSlots[name] = rs;
                }

                return rs;
            }

            function recalculate(index) {

                let state = {
                    player: {},
                    enemy: {}
                };

                state.dr = 0;
                state.er = 0;
                state.rr = 0;
                state.fr = 0;
                state.cr = 0;
                state.pr = 0;
                state.xr = 0;

                state.enemy.kind = getOpt("enemykind").value;
                state.enemy.ballisticDamage = parseInt(getValue("dmgBallistic"));
                state.enemy.energyDamage = parseInt(getValue("dmgEnergy"));
                state.enemy.radiationDamage = parseInt(getValue("dmgRadiation"));
                state.enemy.fireDamage = parseInt(getValue("dmgFire"));
                state.enemy.cryoDamage = parseInt(getValue("dmgCryo"));
                state.enemy.poisonDamage = parseInt(getValue("dmgPoison"));
                state.enemy.explosiveDamage = parseInt(getValue("dmgExplosive"));
                state.enemy.armorIgnore = parseInt(getValue("armorIgnore"));
                state.enemy.damageType = getBool("dmgTypeMelee") ? "melee" : "ranged";
                state.enemy.energyType = getBool("energyTypePlasma") ? "plasma" : "laser";

                state.ballisticReduction = 0;
                state.energyReduction = 0;
                state.radiationReduction = 0;
                state.fireReduction = 0;
                state.cryoReduction = 0;
                state.poisonReduction = 0;
                state.explosiveReduction = 0;

                if (get(index + "_HP") == null) {
                    return state;
                }

                if (getBool("NonPA" + index)) {
                    state.player.mode = "NonPA";
                }
                if (getBool("PA" + index)) {
                    state.player.mode = "PA";
                }
                if (getBool("Suit" + index)) {
                    state.player.mode = "Suit";
                }

                state.player.hp = parseInt(getValue(index + "_HP"));
                if (state.player.mode !== "Suit") {
                    state.player.caps = parseInt(getValue(index + "_Caps"));
                    state.player.carrying = parseInt(getValue(index + "_Carry"));
                    state.player.fooddrink = parseInt(getValue(index + "_Fooddrink"));
                } else {
                    state.player.caps = 0;
                    state.player.carrying = 0;
                    state.player.fooddrink = 0;
                }
                state.player.teammates = parseInt(getValue(index + "_Teammates"));
                state.player.teamdeaths = parseInt(getValue(index + "_Teamdeaths"));
                state.player.night = getBool(index + "_Night_yes");
                state.player.blocking = getBool(index + "_Block_yes");
                state.player.sneaking = getBool(index + "_Sneak_yes");
                state.player.fireheavy = getBool(index + "_Fireheavy_yes");
                state.player.stance = getValue(index + "_Stance");
                state.player.mutations = 0;


                state.reductionSlots = {};

                if (state.player.mode !== "PA") {
                    state.player.strength = parseInt(getValue(index + "_Strength"));
                    state.player.agility = parseInt(getValue(index + "_Agility"));
                    state.player.junkamount = parseInt(getValue(index + "_Junkamount"));
                }
                if (state.player.mode !== "Suit") {
                    var nguardians = parseInt(getValue(index + "_Guardians"));
                    state.fr += nguardians * 10;
                    state.cr += nguardians * 10;
                    state.pr += nguardians * 10;
                }

                var modifiers = [];

                var armorMakes = [];
                var armorPieces = 0;
                var armorCategories = [];

                outer:
                for (var tagName of ["input", "select"]) {
                    for (var elem of document.getElementsByTagName(tagName)) {
                        if (elem.id.startsWith(index + "_")) {
                            if (elem.id.startsWith(index + "_Part_")) {
                                if (elem.selectedIndex && elem.selectedIndex > 0) {
                                    var opt = elem.options[elem.selectedIndex];
                                    if (opt.make && opt.category) {
                                        if (!armorMakes.includes(opt.make)) {
                                            armorMakes.push(opt.make);
                                        }
                                        if (!armorCategories.includes(opt.category)) {
                                            armorCategories.push(opt.category);
                                        }
                                        armorPieces++;
                                    }
                                }
                            }
                            if (elem.selectedIndex && elem.selectedIndex > 0) {
                                var opt = elem.options[elem.selectedIndex];
                                if (!opt.data) {
                                    continue;
                                }
                                if (opt.data.order === undefined) {
                                    //alert(elem.id + " no order specified in its data attribute")
                                    continue;
                                }
                                if (!opt.data.func) {
                                    //alert(elem.id + " no function specified in its data attribute")
                                    continue;
                                }
                                modifiers.push(opt.data);
                            } else {
                                if (!elem.data) {
                                    continue;
                                }
                                if (elem.data.order === undefined) {
                                    //alert(elem.id + " no order specified in its data attribute")
                                    continue;
                                }
                                if (!elem.data.func) {
                                    //alert(elem.id + " no function specified in its data attribute")
                                    continue;
                                }
                                if (elem.type === "radio" && elem.id.endsWith("_yes") && elem.checked) {
                                    modifiers.push(elem.data);
                                }
                                else if (elem.type === "checkbox" && elem.checked) {
                                    modifiers.push(elem.data);
                                }
                            }
                        }
                    }
                }

                state.player.fullSet = false;
                state.player.fullSetCategory = false;

                if (state.player.mode === "PA") {
                    state.player.fullSet = armorPieces === 6 && armorMakes.length === 1;
                    state.player.fullSetCategory = true;
                    state.dr += 2;
                    state.er += 2;
                } else {
                    state.player.fullSet = armorPieces === 5 && armorMakes.length === 1;
                    state.player.fullSetCategory = armorPieces === 5 && armorMakes.length === 1 && armorCategories.length === 1;
                }

                modifiers.sort((a, b) => a.order < b.order ? -1 : (a.order > b.order ? 1 : 0));

                for (var mod of modifiers) {
                    mod.func(state);
                }

                state.ballisticReduction = 1;
                state.energyReduction = 1;
                state.radiationReduction = 1;
                state.fireReduction = 1;
                state.cryoReduction = 1;
                state.poisonReduction = 1;
                state.explosiveReduction = 1;

                for (var rsKey in state.reductionSlots) {
                    var rs = state.reductionSlots[rsKey];
                    state.ballisticReduction *= (1 - rs.ballisticReduction / 100.0);
                    state.energyReduction *= (1 - rs.energyReduction / 100.0);
                    state.radiationReduction *= (1 - rs.radiationReduction / 100.0);
                    state.fireReduction *= (1 - rs.fireReduction / 100.0);
                    state.cryoReduction *= (1 - rs.cryoReduction / 100.0);
                    state.poisonReduction *= (1 - rs.poisonReduction / 100.0);
                    state.explosiveReduction *= (1 - rs.explosiveReduction / 100.0);
                }

                state.ballisticReduction = 1 - state.ballisticReduction;
                state.energyReduction = 1 - state.energyReduction;
                state.radiationReduction = 1 - state.radiationReduction;
                state.fireReduction = 1 - state.fireReduction;
                state.cryoReduction = 1 - state.cryoReduction;
                state.poisonReduction = 1 - state.poisonReduction;
                state.explosiveReduction = 1 - state.explosiveReduction;

                // results

                var resiliences = get("Resistances" + index);

                resiliences.innerHTML = createDamageDisplayHTML(
                    state.dr, state.er, 
                    state.rr, state.fr, 
                    state.cr, state.pr, 
                    state.xr, "", 0);

                var reductions = get("Reductions" + index);

                reductions.innerHTML = createDamageDisplayHTML(
                    state.ballisticReduction * 100.0, state.energyReduction * 100.0, 
                    state.radiationReduction * 100.0, state.fireReduction * 100.0,
                    state.cryoReduction * 100.0, state.poisonReduction * 100.0, 
                    state.explosiveReduction * 100.0, " %", 2);

                get("dr" + index).innerText = state.dr.toFixed(0);
                get("er" + index).innerText = state.er.toFixed(0);
                get("rr" + index).innerText = state.rr.toFixed(0);
                get("fr" + index).innerText = state.fr.toFixed(0);
                get("cr" + index).innerText = state.cr.toFixed(0);
                get("pr" + index).innerText = state.pr.toFixed(0);
                get("xr" + index).innerText = state.xr.toFixed(0);

                get("dred" + index).innerText = (100 * state.ballisticReduction).toFixed(2) + "%";
                get("ered" + index).innerText = (100 * state.energyReduction).toFixed(2) + "%";
                get("rred" + index).innerText = (100 * state.radiationReduction).toFixed(2) + "%";
                get("fred" + index).innerText = (100 * state.fireReduction).toFixed(2) + "%";
                get("cred" + index).innerText = (100 * state.cryoReduction).toFixed(2) + "%";
                get("pred" + index).innerText = (100 * state.poisonReduction).toFixed(2) + "%";
                get("xred" + index).innerText = (100 * state.explosiveReduction).toFixed(2) + "%";

                return state;
            }

            function createDamageDisplayHTML(ballistic, energy, radiation, fire, cold, poison, explosive, unit, decimals) {
                var result = "";
                if (ballistic < 0.01) {
                    result += "<span class='halfopaque'>&nbsp;&nbsp;&nbsp;\u2316&nbsp;" + ballistic.toFixed(decimals) + unit + "</span>";
                } else {
                    result += "&nbsp;&nbsp;&nbsp;\u2316&nbsp;" + ballistic.toFixed(decimals) + unit;
                }
                if (energy < 0.01) {
                    result += "<span class='halfopaque'>&nbsp;&nbsp;&nbsp;\u21AF&nbsp;" + energy.toFixed(decimals) + unit + "</span>";
                } else {
                    result += "&nbsp;&nbsp;&nbsp;\u21AF&nbsp;" + energy.toFixed(decimals) + unit;
                }
                if (radiation < 0.01) {
                    result += "<br><span class='halfopaque'>&nbsp;&nbsp;&nbsp;\u2622&nbsp;" + radiation.toFixed(decimals) + unit + "</span>";
                } else {
                    result += "<br>&nbsp;&nbsp;&nbsp;\u2622&nbsp;" + radiation.toFixed(decimals) + unit;
                }

                if (fire < 0.01) {
                    result += "<span class='halfopaque'>&nbsp;&nbsp;&nbsp;&#x1F525;&nbsp;" + fire.toFixed(decimals) + unit + "</span>";
                } else {
                    result += "&nbsp;&nbsp;&nbsp;&#x1F525;&nbsp;" + fire.toFixed(decimals);
                }
                if (cold < 0.01) {
                    result += "<br><span class='halfopaque'>&nbsp;&nbsp;&nbsp;&#x2744;&nbsp;" + cold.toFixed(decimals) + unit + "</span>";
                } else {
                    result += "<br>&nbsp;&nbsp;&nbsp;&#x2744;&nbsp;" + cold.toFixed(decimals);
                }
                if (poison < 0.01) {
                    result += "<span class='halfopaque'>&nbsp;&nbsp;&nbsp;&#x1F4A7;&nbsp;" + poison.toFixed(decimals) + unit + "</span>";
                } else {
                    result += "&nbsp;&nbsp;&nbsp;&#x1F4A7;&nbsp;" + poison.toFixed(decimals);
                }
                if (explosive < 0.01) {
                    result += "<br><span class='halfopaque'>&nbsp;&nbsp;&nbsp;&#x1F4A5;&nbsp;" + explosive.toFixed(decimals) + unit + "</span>";
                } else {
                    result += "<br>&nbsp;&nbsp;&nbsp;&#x1F4A5;&nbsp;" + explosive.toFixed(decimals) + unit;
                }
                return result;
            }

            function damageFormula(damage, reduction, resistance, ignore) {
                if (reduction > 0) {
                    damage *= (1 - reduction);
                }
                if (ignore > 0) {
                    resistance *= (1 - ignore / 100);
                }
                if (resistance <= 0) {
                    return damage;
                }
                return damage * Math.min(0.99, 0.5 * Math.pow(damage / resistance, 0.365))
            }

            function compareResults(s1, s2) {
                var damageDealtValues = ["ballisticDamage", "energyDamage", "radiationDamage", "fireDamage", "cryoDamage", "poisonDamage", "explosiveDamage"];
                var resistanceValues = ["dr", "er", "rr", "fr", "cr", "pr", "xr"];
                var reductionValues = ["ballisticReduction", "energyReduction", "radiationReduction", "fireReduction", "cryoReduction", "poisonReduction", "explosiveReduction"];
                var damageReceivedValues = ["ballistic", "energy", "radiation", "fire", "cryo", "poison", "explosive"];
                var damageTypes = ["\u2316&nbsp;Ballistic", "\u21AF&nbsp;Energy", "\u2622&nbsp;Radiation", "&#x1F525;&nbsp;Fire", "&#x2744;&nbsp;Cryo", "&#x1F4A7;&nbsp;Poison", "&#x1F4A5;&nbsp;Explosive"];

                var tbl = get("comparisonTable");
                removeRows(tbl, 2, tbl.rows.length);

                var totalDmg1 = 0;
                var totalDmg2 = 0;

                for (var i = 0; i < damageDealtValues.length; i++) {

                    var dmg1 = 0;
                    if (s1) {
                        dmg1 = damageFormula(s1.enemy[damageDealtValues[i]], s1[reductionValues[i]], s1[resistanceValues[i]], s1.enemy.armorIgnore);
                    }
                    var dmg2 = 0;
                    if (s2) {
                        dmg2 = damageFormula(s2.enemy[damageDealtValues[i]], s2[reductionValues[i]], s2[resistanceValues[i]], s2.enemy.armorIgnore);
                    }

                    totalDmg1 += dmg1;
                    totalDmg2 += dmg2;

                    var rw = tbl.insertRow(tbl.rows.length);
                    var cll = rw.insertCell(rw.cells.length);
                    
                    cll.innerHTML = damageTypes[i];

                    cll = rw.insertCell(rw.cells.length);
                    cll.innerText = dmg1.toFixed(2);
                    cll.className = "right";

                    cll = rw.insertCell(rw.cells.length);
                    cll.className = "right";
                    if (dmg2 != 0) {
                        cll.innerText = (100 * (dmg1 - dmg2) / dmg2).toFixed(2) + "%";
                    }

                    cll = rw.insertCell(rw.cells.length);

                    var cll = rw.insertCell(rw.cells.length);
                    cll.innerHTML = damageTypes[i];

                    cll = rw.insertCell(rw.cells.length);
                    cll.innerText = dmg2.toFixed(2);
                    cll.className = "right";

                    cll = rw.insertCell(rw.cells.length);
                    cll.className = "right";
                    if (dmg1 != 0) {
                        cll.innerText = (100 * (dmg2 - dmg1) / dmg1).toFixed(2) + "%";
                    }
                }

                var rw = tbl.insertRow(tbl.rows.length);
                var cll = rw.insertCell(rw.cells.length);
                
                cll.innerText = "Total";
                cll.className = "bold topline";

                cll = rw.insertCell(rw.cells.length);
                cll.innerText = totalDmg1.toFixed(2);
                cll.className = "right bold topline";

                cll = rw.insertCell(rw.cells.length);
                cll.className = "right bold topline";
                if (totalDmg2 != 0) {
                    cll.innerText = (100 * (totalDmg1 - totalDmg2) / totalDmg2).toFixed(2) + "%";
                }

                cll = rw.insertCell(rw.cells.length);

                var cll = rw.insertCell(rw.cells.length);
                cll.innerText = "Total";
                cll.className = "bold topline";

                cll = rw.insertCell(rw.cells.length);
                cll.innerText = totalDmg2.toFixed(2);
                cll.className = "right bold topline";

                cll = rw.insertCell(rw.cells.length);
                cll.className = "right bold topline";
                if (totalDmg1 != 0) {
                    cll.innerText = (100 * (totalDmg2 - totalDmg1) / totalDmg1).toFixed(2) + "%";
                }
            }

            function recalculateBoth() {
                var s1 = recalculate(1);
                var s2 = recalculate(2);
                compareResults(s1, s2);

                var ll = createLink(1);
                var rr = createLink(2);
                var ee = createEnemyLink();
                get("linkleftleft").href="?left=" + ll + "&enemy=" + ee;
                get("linkrightright").href="?right=" + rr + "&enemy=" + ee;
                get("linkboth").href="?left=" + ll + "&right=" + rr + "&enemy=" + ee;
            }

            function createLink(index) {
                var components = [];
                var nonpa = getBool("NonPA" + index);
                var pa = getBool("PA" + index);
                var suit = getBool("Suit" + index);

                if (nonpa || pa || suit) {
                    if (nonpa) components.push("NonPA");
                    if (pa) components.push("PA");
                    if (suit) components.push("Suit");

                    for (var elem of document.getElementsByTagName("select")) {
                        if (elem.id.startsWith(index + "_") && elem.selectedIndex > 0) {
                            var key = elem.id.substring(2).replace(/_/g, "~");
                            var value = elem.options[elem.selectedIndex].value;
                            components.push(key + "-" + value);
                        }
                    }
                    for (var elem of document.getElementsByTagName("input")) {
                        if (elem.id.startsWith(index + "_")) {
                            if ((elem.id.endsWith("_yes") || elem.type === "checkbox") && elem.checked) {
                                var key = elem.id.substring(2);
                                if (key.endsWith("_yes")) {
                                    key = key.substring(0, key.length - 4);
                                }
                                components.push(key.replace(/_/g, "~"));
                            }
                            if (elem.type === "number" && elem.value > 0) {
                                var key = elem.id.substring(2).replace(/_/g, "~");
                                var value = elem.value;
                                components.push(key + "-" + value);
                            }
                        }
                    }
                }
                return components.join("_");
            }

            function createEnemyLink() {
                var components = [];

                components.push("Kind-" + getOpt("enemykind").value);
                var k = ["BD", "ED", "RD", "FD", "CD", "PD", "XD", "AA"];
                var j = 0;
                for (var p of ["dmgBallistic", "dmgEnergy", "dmgRadiation", "dmgFire", "dmgCryo", "dmgPoison", "dmgExplosive", "armorIgnore"]) {
                    var v = getValue(p);
                    if (v != 0 || (p == "dmgBallistic" && v != 100)) {
                        components.push(k[j] + "-" + v);
                    }
                    j++;
                }
                components.push(getBool("dmgTypeMelee") ? "Melee" : "Ranged");
                components.push(getBool("energyTypePlasma") ? "Plasma" : "Laser")

                return components.join("_");
            }

            get("NonPA1").oninput = evt => createSide(1, "NonPA");
            get("PA1").oninput = evt => createSide(1, "PA");
            get("Suit1").oninput = evt => createSide(1, "Suit");
            get("NonPA2").oninput = evt => createSide(2, "NonPA");
            get("PA2").oninput = evt => createSide(2, "PA");
            get("Suit2").oninput = evt => createSide(2, "Suit");

            get("enemykind").oninput = evt => recalculateBoth();
            get("dmgBallistic").oninput = evt => recalculateBoth();
            get("dmgEnergy").oninput = evt => recalculateBoth();
            get("dmgRadiation").oninput = evt => recalculateBoth();
            get("dmgFire").oninput = evt => recalculateBoth();
            get("dmgCryo").oninput = evt => recalculateBoth();
            get("dmgPoison").oninput = evt => recalculateBoth();
            get("dmgExplosive").oninput = evt => recalculateBoth();
            get("armorIgnore").oninput = evt => recalculateBoth();
            get("dmgTypeMelee").oninput = evt => recalculateBoth();
            get("dmgTypeRanged").oninput = evt => recalculateBoth();
            get("energyTypePlasma").oninput = evt => recalculateBoth();
            get("energyTypeLaser").oninput = evt => recalculateBoth();
            get("copyleft").onclick = evt => copy(false);
            get("copyright").onclick = evt => copy(true);

            get("enemykindselect").innerHTML += info("enemykind");
            get("damagetypemelee").innerHTML += info("damagetypemelee");
            get("energytypeplasma").innerHTML += info("energytypeplasma");

            function processSearch(index, argValues) {

                // select mode first
                var j = 0;
                for (var av of argValues) {
                    if (av === "NonPA") {
                        var cb = get("NonPA" + index);
                        cb.checked = true;
                        cb.dispatchEvent(new Event("input"));
                        argValues.splice(j, 1);
                        break;
                    }
                    else if (av === "PA") {
                        var cb = get("PA" + index);
                        cb.checked = true;
                        cb.dispatchEvent(new Event("input"));
                        argValues.splice(j, 1);
                        break;
                    }
                    else if (av === "Suit") {
                        var cb = get("Suit" + index);
                        cb.checked = true;
                        cb.dispatchEvent(new Event("input"));
                        argValues.splice(j, 1);
                        break;
                    }
                    j++;
                }
                for (j = 0; j < argValues.length; j++) {
                    argValues[j] = argValues[j].replace(/~/g, "_");
                }
                // select part next
                var argValuesOther = []; 
                for (var av of argValues) {
                    if (av.startsWith("Part_") && !av.includes("_Mod_") && !av.includes("_Legendary_")) {
                        var key = av;
                        var param = "";
                        var idx = av.indexOf("-");
                        if (idx > 0) {
                            key = av.substring(0, idx);
                            param = av.substring(idx + 1);
                        }
                        var sel = get(index + "_" + key);
                        selectValue(sel, param);
                    } else {
                        argValuesOther.push(av);
                    }
                }

                // adjust parameters last
                for (var av of argValuesOther) {
                    var key = av;
                    var param = "";
                    var idx = av.indexOf("-");
                    if (idx > 0) {
                        key = av.substring(0, idx);
                        param = av.substring(idx + 1);
                    }
                    var f = get(index + "_" + key);
                    if (f != null) {
                        if (f.selectedIndex !== undefined) {
                            selectValue(f, param);   
                        } else
                        if (f.type === "radio" || f.type === "checkbox") {
                            f.checked = true;
                        }
                        else if (f.type === "number") {
                            f.value = param;
                        } 
                    } else {
                        f = get(index + "_" + av + "_yes");
                        if (f != null) {
                            f.checked = true;
                        }
                    }
                }
            }

            function selectValue(sel, value) {
                for (var i = 0; i < sel.options.length; i++) {
                    var opt = sel.options[i];
                    if (opt.value == value) {
                        opt.selected = true;
                        sel.dispatchEvent(new Event("input"));
                        break;
                    }
                }
            }
            function selectValueNoEvent(sel, value) {
                for (var i = 0; i < sel.options.length; i++) {
                    var opt = sel.options[i];
                    if (opt.value == value) {
                        opt.selected = true;
                        break;
                    }
                }
            }

            function processEnemy(argValues) {
                var k = ["BD", "ED", "RD", "FD", "CD", "PD", "XD", "AA"];
                var f = ["dmgBallistic", "dmgEnergy", "dmgRadiation", "dmgFire", "dmgCryo", "dmgPoison", "dmgExplosive", "armorIgnore"];

                for (var av of argValues) {
                    var param = "";
                    var idx = av.indexOf("-");
                    if (idx > 0) {
                        param = av.substring(idx + 1);
                    }
                    if (av.startsWith("Kind-")) {
                        selectValue(get("enemykind"), param);
                    }
                    if (av === "Melee") {
                        getBool("dmgTypeMelee").checked = true;
                    }
                    if (av === "Ranged") {
                        getBool("dmgTypeRanged").checked = true;
                    }
                    if (av === "Plasma") {
                        getBool("energyTypePlasma").checked = true;
                    }
                    if (av === "Laser") {
                        getBool("energyTypeLaser").checked = true;
                    }
                    for (var i = 0; i < k.length; i++) {
                        if (av.startsWith(k[i] + "-")) {
                            get(f[i]).value = param;
                        }
                    }
                }
            }

            function copy(leftToRight) {
                var src = 2;
                var dst = 1;
                if (leftToRight) {
                    src = 1;
                    dst = 2;
                }
                get("NonPA" + dst).checked = false;
                get("PA" + dst).checked = false;
                get("Suit" + dst).checked = false;
                var tbl = get("table" + dst);
                removeRows(tbl, 1, tbl.rows.length);
                var ll = createLink(src);
                processSearch(dst, ll.split("_"));
                recalculateBoth();
            }

            function clearPage() {
                if (location.search !== "" && location.search !== "?") {
                    location.search = "";
                } else {
                    location.reload();
                }
            }

            setTimeout(() => {
                var q = location.search;
                if (q !== "" && q !== "?") {
                    if (q.startsWith("?")) {
                        q = q.substring(1);
                    }
                    var args = q.split("&");
                    var calc = false;
                    for (var arg of args) {
                        if (arg.startsWith("left=")) {
                            calc = true;
                            processSearch(1, arg.substring(5).split("_"));
                        } else
                        if (arg.startsWith("right=")) {
                            calc = true;
                            processSearch(2, arg.substring(6).split("_"));
                        } else
                        if (arg.startsWith("enemy=")) {
                            calc = true;
                            processEnemy(arg.substring(6).split("_"));
                        }
                    }
                    if (calc) {
                        recalculateBoth();
                    }
                }
            }, 0);
    </script>
</body>
</html>