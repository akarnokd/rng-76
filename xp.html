<html lang="en">
    <head>
        <title>Fallout 76 Experience Calculator</title>
        <style>
            * {
                font-family: sans-serif;
                font-size: 20px;
            }
            td {
                padding: 2px;
            }
            
            table.infoTable {
               border: 1px solid black;
               border-collapse: collapse;
            }
            table.infoTable td {
               border: 1px solid black;
            }

            td.sep {
                border-top: 1px solid black;
            }
            td.sep2 {
                border-top: 3px solid black;
                border-style: double none none none;
            }
            td.total {
                font-size: 24px;
            }
            table.enemies {
                border-collapse: collapse;
            }
            table.enemies td {
                border: 1px solid black;
            }
        </style>
        <meta name="keywords" content="Fallout,Fallout 76,XP,Experience,SPECIAL,S.P.E.C.I.A.L.,Intelligence,Int,Score,S.C.O.R.E.,level,boost">
    </head>
    <body>
        <center>
            <span style="font-size: 36px; font-weight: bold;">Fallout 76 Experience Calculator (0.0.11)</span><br/>
            <br>
            <a href="#" target='_blank' id='thelink'>Link to this setup</a>
            &nbsp;&nbsp;&nbsp;&nbsp;<a href="?">Clear</a>
            <br>
            <table>
                <tr>
                    <td class='sep'>Base intelligence</td>
                    <td class='sep'><input type='number' id='baseint' min='1' max='15' value='1' style='width: 75px;'></td>
                </tr>
                <tr>
                    <td id='infoLegendaryInt'>Legendary intelligence</td>
                    <td><input type='number' id='legendaryint' min='0' max='5' value='0' style='width: 75px;'></td>
                </tr>
                <tr>
                    <td id='infoPlayerHealth'>Player health</td>
                    <td><input type='number' id='playerhealth' min='1' max='100' value='100'> %</td>
                </tr>
                <tr>
                    <td class='sep'>Perks</td>
                    <td class='sep'>&nbsp;</td>
                </tr>
                <tr>
                    <td id='infoClassFreak'>&nbsp;&nbsp;&nbsp;Class Freak</td>
                    <td>
                        <select id='classFreak'>
                            <option value=''>N/A</option>
                            <option value='1'>1</option>
                            <option value='2'>2</option>
                            <option value='3'>3</option>
                        </select>
                        (rank)
                    </td>
                </tr>
                <tr>
                    <td id='infoColaNut'>&nbsp;&nbsp;&nbsp;Cola Nut</td>
                    <td>
                        <select id='colaNut'>
                            <option value=''>N/A</option>
                            <option value='1'>1</option>
                            <option value='2'>2</option>
                        </select>
                        (rank)
                    </td>
                </tr>
                <tr>
                    <td id='infoInspirational'>&nbsp;&nbsp;&nbsp;Inspirational</td>
                    <td>
                        <select id='inspirational'>
                            <option value=''>N/A</option>
                            <option value='1'>1</option>
                            <option value='2'>2</option>
                            <option value='3'>3</option>
                        </select>
                        (rank)
                    </td>
                </tr>
                <tr>
                    <td id='infoNightperson'>&nbsp;&nbsp;&nbsp;Night person</td>
                    <td>
                        <select id='nightperson'>
                            <option value=''>N/A</option>
                            <option value='1'>1</option>
                            <option value='2'>2</option>
                            <option value='3'>3</option>
                        </select>
                        (rank)
                    </td>
                </tr>
                <tr>
                    <td id='infoStrange'>&nbsp;&nbsp;&nbsp;<label for='strange'>Strange in numbers</label></td>
                    <td>
                        <input type='checkbox' id='strange'>
                    </td>
                </tr>
                <tr>
                    <td class='sep'>Mutations</td>
                    <td class='sep'>&nbsp;</td>
                </tr>
                <tr>
                    <td id='infoFoodMutation'>&nbsp;&nbsp;&nbsp;Food related</td>
                    <td>
                        <select id='foodMutation'>
                            <option value=''>N/A</option>
                            <option value='Carnivore'>Carnivore</option>
                            <option value='Herbivore'>Herbivore</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td id='infoEgghead'>&nbsp;&nbsp;&nbsp;<label for='egghead'>Egghead</label></td>
                    <td>
                        <input type='checkbox' id='egghead'>
                    </td>
                </tr>
                <tr>
                    <td id='infoHerdMentality'>&nbsp;&nbsp;&nbsp;<label for='herdmentality'>Herd Mentality</label></td>
                    <td>
                        <input type='checkbox' id='herdmentality'>
                    </td>
                </tr>
                <tr>
                    <td id='infoMarsupial'>&nbsp;&nbsp;&nbsp;<label for='marsupial'>Marsupial</label></td>
                    <td>
                        <input type='checkbox' id='marsupial'>
                    </td>
                </tr>
                <tr>
                    <td id='infoHealingFactor'>&nbsp;&nbsp;&nbsp;<label for='healingfactor'>Healing Factor</label></td>
                    <td>
                        <input type='checkbox' id='healingfactor'>
                    </td>
                </tr>
                <tr>
                    <td class='sep'>Armor</td>
                    <td class='sep'>&nbsp;</td>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;&nbsp;Torso</td>
                    <td>
                        <input type='checkbox' id='torsoUnyield'><label for='torsoUnyield'>Is Unyielding</label>
                        &nbsp;&nbsp;&nbsp;<input type='checkbox' id='torsoInt'><label for='torsoInt'>Has +1 INT</label>
                    </td>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;&nbsp;Left Arm</td>
                    <td>
                        <input type='checkbox' id='leftArmUnyield'><label for='leftArmUnyield'>Is Unyielding</label>
                        &nbsp;&nbsp;&nbsp;<input type='checkbox' id='leftArmInt'><label for='leftArmInt'>Has +1 INT</label>
                    </td>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;&nbsp;Right Arm</td>
                    <td>
                        <input type='checkbox' id='rightArmUnyield'><label for='rightArmUnyield'>Is Unyielding</label>
                        &nbsp;&nbsp;&nbsp;<input type='checkbox' id='rightArmInt'><label for='rightArmInt'>Has +1 INT</label>
                    </td>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;&nbsp;Left Leg</td>
                    <td>
                        <input type='checkbox' id='leftLegUnyield'><label for='leftLegUnyield'>Is Unyielding</label>
                        &nbsp;&nbsp;&nbsp;<input type='checkbox' id='leftLegInt'><label for='leftLegInt'>Has +1 INT</label>
                    </td>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;&nbsp;Right Leg</td>
                    <td>
                        <input type='checkbox' id='rightLegUnyield'><label for='rightLegUnyield'>Is Unyielding</label>
                        &nbsp;&nbsp;&nbsp;<input type='checkbox' id='rightLegInt'><label for='rightLegInt'>Has +1 INT</label>
                    </td>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;&nbsp;Power Armor Helmet</td>
                    <td>
                        <input type='checkbox' id='internalDb'><label for='internalDb'>Internal Database (+2 INT)</label>
                    </td>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;&nbsp;Underarmor</td>
                    <td>
                        <select id='underarmor'>
                            <option value=''>N/A</option>
                            <option value='Casual1'>Casual Treated (+1 INT)</option>
                            <option value='Casual1'>Casual Resistant (+1 INT)</option>
                            <option value='Casual1'>Casual Protective (+1 INT)</option>
                            <option value='Casual3'>Casual Shielded (+3 INT)</option>
                            <option value='Vault2'>Vault Suit Protective (+2 INT)</option>
                            <option value='Valut2'>Vault Suit Shielded (+2 INT)</option>
                            <option value='Flanel3'>Flanel Shirt (+3 INT)</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td class='sep' id='infoFoodDrink'>Food/Drink intelligence</td>
                    <td class='sep'>
                        <select id='foodInt'>
                            <option value=''>N/A</option>
                            <option value='SBBrain'>Broiled Scorchbeast Brain (+3 INT)</option>
                            <option value='BrainBombs'>Brain Bombs (+3 INT)</option>
                            <option value='TatoFlowerTea'>Steepled Tato Flower Tea (+2 INT)</option>
                            <option value='StapledAsterTea'>Stapled Aster Tea (+2 INT)</option>
                            <option value='BrainFungusSoup'>Brain Fungus soup (+2 INT)</option>
                            <option value='OwletNuggets'>Owlet Nuggets (+1 INT)</option>
                            <option value='SBStew'>Scorchbeast Mixed Stew (+1 INT)</option>
                            <option value='SimpleAsterTea'>Simple Aster Tea (+1 INT)</option>
                            <option value='Alcohol'>Alcohols (-1 INT)</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td id='infoChem'>Chem intelligence</td>
                    <td>
                        <select id='chemInt'>
                            <option value=''>N/A</option>
                            <option value='BerryMentats'>Berry Mentats (+5 INT)</option>
                            <option value='DaddyO'>Daddy-O (+3 INT)</option>
                            <option value='XCell'>X-Cell (+2 INT)</option>
                            <option value='Mentats'>Mentats (+2 INT)</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td id='infoBobbleheadInt'><label for='bobbleheadInt'>Bobblehead: Intelligence</label></td>
                    <td>
                        <input type='checkbox' id='bobbleheadInt'>
                    </td>
                </tr>
                <tr>
                    <td class='sep'>XP boosts</td>
                    <td class='sep'>&nbsp;</td>
                </tr>
                <tr>
                    <td id='infoFoodDrinkXP'>&nbsp;&nbsp;&nbsp;Food/Drink</td>
                    <td>
                        <select id='foodXP'>
                            <option value=''>N/A</option>
                            <option value='CranberryCobbler'>Cranberry Cobbler (+5% XP)</option>
                            <option value='CranberryRelish'>Cranberry Relish (+10% XP)</option>
                            <option value='NukaCranberry'>Nuka Cola Cranberry (+2% XP*)</option>
                            <option value='CannedMeatStew'>Canned Meat Stew (+5% XP)</option>
                            <option value='TastySquirrelStew'>Tasty Squirrel Stew (+10% XP)</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td id='infoLeader'>&nbsp;&nbsp;&nbsp;<label for='bobbleheadLeader'>Bobblehead: Leader</label></td>
                    <td>
                        <input type='checkbox' id='bobbleheadLeader'>
                    </td>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;&nbsp;Event</td>
                    <td>
                        <input type='checkbox' id='eventMothman'><label for='eventMothman' id='infoMothman'>The Path to Enlightement</label>
                    </td>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;&nbsp;Community Event</td>
                    <td>
                        <select id='community'>
                            <option value=''>N/A</option>
                            <option value='DoubleXP'>Double XP</option>
                            <option value='TripleXP'>Triple XP</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td id='infoLunchbox'>&nbsp;&nbsp;&nbsp;Lunchbox</td>
                    <td>
                        <select id='lunchbox'>
                            <option value=''>N/A</option>
                            <option value='1'>+25% XP</option>
                            <option value='2'>+50% XP</option>
                            <option value='3'>+75% XP</option>
                            <option value='4'>+100% XP</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td id='infoRest'>&nbsp;&nbsp;&nbsp;Rested</td>
                    <td>
                        <input type='checkbox' id='wellrested'>
                    </td>
                </tr>
                <tr>
                    <td class='sep' id='infoTeamType'>Team</td>
                    <td class='sep'>
                        <select id='teamType'>
                            <option value=''>Solo</option>
                            <option value='private'>Private</option>
                            <option value='public'>Public</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td id='infoTeamBuilder'>&nbsp;&nbsp;&nbsp;Casual team</td>
                    <td>
                        <select id='teamBuilder'>
                            <option value=''>Not in team</option>
                            <option value='1'>Alone (+1 INT)</option>
                            <option value='2'>1 Bond (+2 INT)</option>
                            <option value='3'>2 Bonds (+3 INT)</option>
                            <option value='4'>3 Bonds (+4 INT)</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td id='infoTeamEvent'>&nbsp;&nbsp;&nbsp;Event team</td>
                    <td>
                        <select id='teamEvent'>
                            <option value=''>Not in team</option>
                            <option value='1'>Alone (+25% XP)</option>
                            <option value='2'>1 Bond (+50% XP)</option>
                            <option value='3'>2 Bonds (+75% XP)</option>
                            <option value='4'>3 Bonds (+100% XP)</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td id='infoTeamHunter'>&nbsp;&nbsp;&nbsp;Hunter team</td>
                    <td>
                        <select id='teamHunter'>
                            <option value=''>Not in team</option>
                            <option value='1'>Alone (+25% XP)</option>
                            <option value='2'>1 Bond (+50% XP)</option>
                            <option value='3'>2 Bonds (+75% XP)</option>
                            <option value='4'>3 Bonds (+100% XP)</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td id='infoLiveandlove'>&nbsp;&nbsp;&nbsp;Magazine: Live and Love 8</td>
                    <td>
                        <input type='checkbox' id='liveandlove'>
                    </td>
                </tr>
                <tr>
                    <td class='sep2 total'>Total intelligence</td>
                    <td class='sep2 total' id='totalInt'>1</td>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;&nbsp;Equivalent XP bonus</td>
                    <td id='totalIntPercent'>3%</td>
                </tr>
                <tr>
                    <td class='total' id='infoTotalXP'>Total XP bonus</td>
                    <td class='total' id='totalXPBonus'>0 %</td>
                </tr>
                <tr>
                    <td id='infoTotalXPEvent'>&nbsp;&nbsp;&nbsp;Completing events</td>
                    <td id='totalXPBonusEvent'>0 %</td>
                </tr>
                <tr>
                    <td id='infoTotalXPHunter'>&nbsp;&nbsp;&nbsp;Killing legendaries</td>
                    <td id='totalXPBonusHunter'>0 %</td>
                </tr>
                <tr>
                    <td class='total' id='infoOverallXP'>Overall XP buff</td>
                    <td class='total' id='totalXPBuff'>0 %</td>
                </tr>
                <tr>
                    <td id='infoOverallXPEvent'>&nbsp;&nbsp;&nbsp;Completing events</td>
                    <td id='totalXPBuffEvent'>0 %</td>
                </tr>
                <tr>
                    <td id='infoOverallXPHunter'>&nbsp;&nbsp;&nbsp;Killing legendaries</td>
                    <td id='totalXPBuffHunter'>0 %</td>
                </tr>
            </table>
            <br>
            <table id='enemyTable' class='enemies'>
                <tr>
                    <td colspan='4' style='background-color: #FFCC00;'>Enemy:
                        &nbsp;<select id='enemy'>
                            <option value=''>pick...</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td style='text-align: center; font-weight: bold;'>Level</td>
                    <td width='100' style='text-align: center; font-weight: bold;'>Base</td>
                    <td width='100' style='text-align: center; font-weight: bold;'>XP</td>
                    <td width='100' style='text-align: center; font-weight: bold;'>&#x2605; XP</td>
                </tr>
            </table>
            <br>
            <table id='eventTable' class='enemies'>
                <tr>
                    <td colspan='4' style='background-color: #FFCC00;'>Event:
                        &nbsp;<select id='event'>
                            <option value=''>pick...</option>
                        </select>
                        &nbsp;<a href='https://nukacrypt.com/search' id='eventnukacrypt' target='_blank' title='See this on Nukacrypt'>&#x2622;</a>
                    </td>
                </tr>
                <tr>
                    <td style='text-align: center; font-weight: bold;'>Condition</td>
                    <td width='100' style='text-align: center; font-weight: bold;'>Base</td>
                    <td width='100' style='text-align: center; font-weight: bold;'>XP</td>
                    <td width='100' style='text-align: center; font-weight: bold;'>Event XP</td>
                </tr>
            </table>
        </center>
        <script>

            function interpolate(curve, x) {
                var first = curve[0];

                if (x <= first.x) {
                    return first.y;
                }

                var last = curve[curve.length - 1];
                if (x >= last.x) {
                    return last.y;
                }

                for (var i = 0; i < curve.length - 1; i++) {
                    var p1 = curve[i];
                    var p2 = curve[i + 1];
                    if (p1.x <= x && x < p2.x) {
                        var dx = p2.x - p1.x;
                        var dy = p2.y - p1.y;
                        return (x - p1.x) / dx * dy + p1.y;
                    }
                }
                return -1;
            }

            var curveHard = [
                { x: 1, y: 15 },
                { x: 100, y: 200 }
            ];

            var curveMedium = [
                { x: 1, y: 10 },
                { x: 100, y: 125 }
            ];

            var curveBoss = [
                { x: 1, y: 20 },
                { x: 100, y: 500 }
            ];

            var curveEasy = [
                { x: 1, y: 5 },
                { x: 100, y: 75 }
            ];

            var curveCritter = [
                { x: 1, y: 2 },
                { x: 100, y: 40 }
            ];

            function xpHard(level) {
                return interpolate(curveHard, level);
            }
            function xpMedium(level) {
                return interpolate(curveMedium, level);
            }
            function xpBoss(level) {
                return interpolate(curveBoss, level);
            }

            var enemies = [
                {
                    name: "Super Mutant",
                    xp: xpHard,
                    levels: [1, 5, 10, 16, 22, 28, 35, 42, 48, 50, 59, 60, 68, 75, 80, 90, 100, 115]
                },
                {
                    name: "Scorched",
                    xp: xpMedium,
                    levels: [1, 6, 14, 23, 32, 40, 47, 50, 54, 60, 62, 68, 74, 75, 80, 90, 100]
                },
                {
                    name: "Scorchbeast Queen",
                    xp: xpBoss,
                    levels: [95]
                },
                {
                    name: "Scorchbeast",
                    xp: xpBoss,
                    levels: [50, 65, 80, 100]
                },
                {
                    name: "Ghoul",
                    xp: xpMedium,
                    levels: [1, 3, 9, 15, 22, 32, 42, 52, 62, 75, 100]
                },
                {
                    name: "Glowing One",
                    xp: xpHard,
                    levels: [22, 32, 40, 58, 75, 95, 100, 115]
                },
                {
                    name: "Yao Guai",
                    xp: xpHard,
                    levels: [16, 26, 31, 36, 41, 46, 56, 66, 76, 86, 100, 115]
                },
                { 
                    name: "Fog Crawler",
                    xp: xpHard,
                    levels: [39, 51, 63, 75, 100]
                },
                {
                    name: "Sheepsquatch",
                    xp: xpBoss,
                    levels: [50, 65, 80, 100]
                },
                {
                    name: "Imposter Sheepsquatch",
                    xp: xpHard,
                    levels: [70]
                },
                {
                    name: "Deathclaw",
                    xp: xpBoss,
                    levels: [31, 41, 51, 61, 71, 81, 91, 100]
                },
                { 
                    name: "Sentry Bot",
                    xp: xpBoss,
                    levels: [23, 30, 40, 45, 50, 60, 75, 100]
                },
                {
                    name: "Mirelurk King",
                    xp: xpHard,
                    levels: [30, 40, 50, 65, 80, 100]
                },
                {
                    name: "Mirelurk Queen",
                    xp: xpBoss,
                    levels: [20, 35, 50, 65, 80, 100]
                },
                {
                    name: "Mirelurk Hunter",
                    xp: xpHard,
                    levels: [24, 34, 46, 58, 70, 85, 100]
                }
            ];

            enemies.sort((a, b) => {
                return a.name.localeCompare(b.name);
            });

            var enemiesSel = get("enemy");
            for (var e of enemies) {
                var opt = document.createElement("option");
                opt.text = e.name;
                opt.value = encodeURIComponent(e.name);
                opt.xp = e.xp;
                opt.levels = e.levels
                opt.formid = e.formid;
                enemiesSel.options.add(opt);
            }

            // _________________________________________________________

            function simpleEvent(name, xp, formid) {
                return {
                    name: name,
                    formid: formid,
                    conditions: [
                        {
                            name: "Complete",
                            xp: xp
                        }
                    ]
                };
            }

            var events = [
                simpleEvent("Public event: Line in the sand", 250),
                {
                    name: "Daily: Big Game Hunter",
                    formid: "0011D76B",
                    conditions: [
                        {
                            name: "0 kills + complete",
                            xp: 500
                        },
                        {
                            name: "1 kill + complete",
                            xp: 525
                        },
                        {
                            name: "2 kills + complete",
                            xp: 550
                        },
                        {
                            name: "3 kills + complete",
                            xp: 575
                        }
                    ]
                },
                simpleEvent("Daily: Buried with Honor", 200),
                simpleEvent("Daily: Cop a squatter", 600, "00116532"),
                {
                    name: "Daily: Dross toss",
                    formid: "00320E08",
                    conditions: [
                        {
                            name: "Not all targets hit",
                            xp: 300
                        },
                        {
                            name: "All targets hit",
                            xp: 600
                        }
                    ]
                },
                simpleEvent("Daily: Ecological Balance", 60),
                {
                    name: "Daily: Heart of the enemy",
                    formid: "00065DFE",
                    conditions: [
                        {
                            name: "First time",
                            xp: 25 + 800
                        },
                        {
                            name: "Subsequently",
                            xp: 800
                        }
                    ]
                },
                simpleEvent("Daily: Idle explosives", 300),
                simpleEvent("Daily: Lucky mucker", 600, "00320E0A"),
                simpleEvent("Mistaken identity", 400),
                simpleEvent("Daily: Pass the buck", 200),
                simpleEvent("Daily: Play time", 600, "00116532"),
                simpleEvent("Daily: Queen of the hunt", 300),
                simpleEvent("Daily: Someone to talk to", 250),
                simpleEvent("Daily: Strange brew", 150),
                simpleEvent("Daily: Target rich environment", 25),
                {
                    name: "Daily: The chow line",
                    formid: "00320E09",
                    conditions: [
                        {
                            name: "Run out of time",
                            xp: 300
                        },
                        {
                            name: "Ate all hotdogs",
                            xp: 600
                        }
                    ]
                },
                simpleEvent("Daily: Thrill of the grill", 250),
                simpleEvent("Daily: Trick or treat", 500, "00137931"),
                simpleEvent("Daily: Waste not", 300),
                simpleEvent("Event: Always Vigilant", 300),
                {
                    name: "Enclave event: A real blast",
                    conditions: [
                        {
                            name: "Lures ignored",
                            xp: 300
                        },
                        {
                            name: "Lures reset",
                            xp: 350
                        }
                    ]

                },
                simpleEvent("Event: Back on the beat", 25),
                simpleEvent("Event: Battle bot", 300),
                simpleEvent("Enclave event: Bots on parade", 250),
                simpleEvent("Event: Census violence", 350),
                simpleEvent("Event: Collision course", 150),
                simpleEvent("Public event: Distinguished Guests", 150),
                simpleEvent("Event: Dogwood die off", 250),
                simpleEvent("Enclave event: Dropped connection", 250),
                simpleEvent("Public event: Feed the people", 25),
                simpleEvent("Event: Fertile soil", 150),
                simpleEvent("Event: Grafton day", 200),
                simpleEvent("Public event: Guided meditation", 200),
                simpleEvent("Public event: Heart of the swamp", 350),
                simpleEvent("Event: Irrational fear", 300),
                simpleEvent("Event: It's a trap", 350),
                simpleEvent("Public event: Jail break", 50),
                simpleEvent("Public event: Lode baring", 350),
                simpleEvent("Event: Manhunt", 300),
                simpleEvent("Event: The messenger", 350),
                simpleEvent("Public event: One violent night", 250),
                simpleEvent("Event: Patrol duty", 250),
                {
                    name: "Event: Powering up Monongah",
                    conditions: [
                        {
                            name: "Basic repairs",
                            xp: 450
                        },
                        { 
                            name: "Full repairs",
                            xp: 600
                        }
                    ]
                },
                {
                    name: "Event: Powering up Poseidon",
                    conditions: [
                        {
                            name: "Basic repairs",
                            xp: 450
                        },
                        { 
                            name: "Full repairs",
                            xp: 600
                        }
                    ]
                },
                {
                    name: "Event: Powering up Thunder Mountain",
                    conditions: [
                        {
                            name: "Basic repairs",
                            xp: 450
                        },
                        { 
                            name: "Full repairs",
                            xp: 600
                        }
                    ]
                },
                simpleEvent("Event: Project beanstalk", 200),
                simpleEvent("Event: Protest march", 200),
                simpleEvent("Public event: Scorched earth", 1200),
                {
                    name: "Public event: Swarm of Suitors",
                    conditions: [
                        {
                            name: "Suitors killed in time",
                            xp: 200
                        },
                        {
                            name: "Queen killed",
                            xp: 0
                        }
                    ]
                },
                simpleEvent("Public event: Tea time", 150),
                simpleEvent("Public event: Path to enlightement", 200),
                simpleEvent("Daily: Operation tidy", 300),
                simpleEvent("Daily: Stings and things", 300),
                simpleEvent("Daily: Tipsy-taste test", 250),
                simpleEvent("Daily: Wasted on Alcohol", 250),
                simpleEvent("Public event: Campfire tales", 250),
                simpleEvent("Public event: Encryptid", 800),
                simpleEvent("Public event: Free range", 400),
                simpleEvent("Public event: Project paradise", 400),
                simpleEvent("Public event: Fasnacht day", 250),
                simpleEvent("Public event: Grahm's meat cook", 500),
                simpleEvent("Public event: Mischief night", 250),
                simpleEvent("Public event: Primal cuts", 150),
                simpleEvent("Daily: Photo opportunity", 700),
                simpleEvent("Public event: Radiation rumble", 350),
                { 
                    name: "Daily: Retirement plan", 
                    conditions: [
                        {
                            name: "First time",
                            xp: 800,
                        },
                        {
                            name: "2..7 times",
                            xp: 800,
                        },
                        {
                            name: "8..14 times",
                            xp: 800,
                        },
                        {
                            name: "15..28 times",
                            xp: 800,
                        },
                        {
                            name: "29..60 times",
                            xp: 800,
                        },
                        { 
                            name: "61..180 times",
                            xp: 800
                        },
                        {
                            name: "181+ times",
                            xp: 800
                        }
                    ] 
                },
                {
                    name: "Event: Riding shotgun",
                    conditions: [
                        {
                            name: "Basic reward",
                            xp: 200
                        },
                        { 
                            name: "One Brahmin survived",
                            xp: 300,
                        },
                        { 
                            name: "Both Brahmin survived",
                            xp: 400,
                        },
                        {
                            name: "Found 1 Package",
                            xp: 450
                        },
                        {
                            name: "Found 2 Packages too",
                            xp: 500
                        },
                        {
                            name: "Found 3 Packages too",
                            xp: 550
                        },
                        {
                            name: "Found 4 Packages too",
                            xp: 600
                        }
                    ]
                },
                simpleEvent("Daily: The Importance of Communication", 700),
                simpleEvent("Daily: Vital equipment", 700),
                {
                    name: "Ally: Daily quest (radiant)",
                    conditions: [
                        {
                            name: "Level 39",
                            xp: interpolate(curveMedium, 39)
                        },
                        {
                            name: "Level 66",
                            xp: interpolate(curveMedium, 66)
                        }
                    ]
                }
            ];

            events.sort((a, b) => {
                return a.name.localeCompare(b.name);
            });

            var eventsSel = get("event");
            for (var e of events) {
                var opt = document.createElement("option");
                opt.text = e.name;
                opt.value = encodeURIComponent(e.name);
                opt.conditions = e.conditions;
                opt.formid = e.formid;
                eventsSel.options.add(opt);
            }

            // tips ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

            var infoMap = new Map();

            infoMap.set("infoLegendaryInt", 
                "One of the legendary perks, 4 ranks; +1, +2, +3, +5 INT respectively."
                + "<br>It is stacks with the base <b>intelligence</b> regarding XP"
                 + "<br> but will only unlock up to 15 total slots."
            );
            infoMap.set("infoPlayerHealth", 
                "Affects the <b>intelligence</b> boost from Unyielding armor pieces."
            );

            infoMap.set("infoEgghead", 
                "+6 Intelligence at the cost of -3 Strength and -3 Endurance."
            );

            infoMap.set("infoClassFreak", 
                "Negative effects of mutations are reduced by 25, 50 or 75%."
            );
            infoMap.set("infoHerdMentality", 
                "+2 Intelligence when in a team (no need for proximity)."
            );
            infoMap.set("infoMarsupial", 
                "-4 Intelligence. See <b>Class Freak</b> perk to reduce the negative effect."
            );
            infoMap.set("infoFoodDrink", 
                "These are mutually exclusive, thus consuming one while another is active will replace that buff."
            );
            infoMap.set("infoChem", 
                "These are mutually exclusive, thus consuming one while another is active will replace that buff."
            );
            infoMap.set("infoBobbleheadInt", 
                "+2 Intelligence. Mutually exclusive with the <b>Leader</b> bobblehead."
            );
            infoMap.set("infoLeader", 
                "+5% XP gained. Mutually exclusive with the <b>Intelligence</b> bobblehead."
            );
            infoMap.set("infoColaNut", 
                "Cola-based drinks have double (rank 1) or triple (rank 2) effects."
            );
            infoMap.set("infoFoodDrinkXP", 
                "These are mutually exclusive, thus consuming one while another is active will replace that buff."
                + "<br>Note that <b>Nuka Cola Cranberry</b> benefits from <b>Cola Nut</b> and the XP boost is increased accordingly."
            );
            infoMap.set("infoMothman", 
                "Public event with +5% XP reward."
                 + "<br>Go to the Landview Lighthouse east of Vault 76 and interact with the Wise Mothman at the end."
            );
            infoMap.set("infoTeamType", 
                "Affects the mutations and perks."
                 + "<br>Private teams do not provide additional intelligence or XP bonus at the moment."
                 + "<br>You can switch between public teams as bonds persist until you log out or server hop,"
                 + "<br>therefore, you can pick buffs for multiple team modes in this section."
            );
            infoMap.set("infoInspirational", 
                "Bonus 5, 10 or 15% XP while in a team."
                 + "<br>Does not work while in a public team alone."
            );
            infoMap.set("infoTeamBuilder", 
                "Bonus intelligence for each player you bonded with."
                 + "<br>Bond persists even when switching public teams. Logging out or server hopping removes the bond."
                 + "<br>You can switch to the Events team at the end of events, then back without penalty,"
                  + "<br>to benefit from the bonus XP for completing an event."
            );

            infoMap.set("infoTeamEvent", 
                "Bonus XP for completing events for each player you bonded with."
                 + "<br>Bond persists even when switching public teams. Logging out or server hopping removes the bond."
                 + "<br>You can switch to the Events team at the end of events, then back, to benefit from the bonus XP for completing an event."
            );
            infoMap.set("infoTeamHunter", 
                "Bonus XP for killing legendaries for each player you bonded with."
                 + "<br>Bond persists even when switching public teams. Logging out or server hopping removes the bond."
                 + "<br>You can switch to the Events team at the end of events, then back, to benefit from the bonus XP for completing an event."
                 + "<br>Note that horde events end when the primary target is killed so there might not be time to switch."
                 + "<br>Keeping the primary target of horde events alive may result in an unlimited number of mob spawns, of which legendaries may spawn as well."
            );
            infoMap.set("infoLunchbox", 
                "Lunchboxes are rewards from the legendary run. Opening them around other players grants XP boost to you and them."
                 + "<br>Note that having more than 4 lunchboxes opened results in a <b>glitch</b> where no boost is applied until"
                 + "<br>the extra lunchboxes above 4 will run out of time."
            );

            infoMap.set("infoStrange", 
                "Positive mutations are +25% stronger when teammates are mutated too."
                + "<br>Doesn't work when in alone in a public team."
            );

            infoMap.set("infoTotalXP", 
                "The combined bonus for all the direct XP-boosting settings above."
            );
            infoMap.set("infoOverallXP", 
                "The combined bonus for all the direct XP-boosting settings above and the effects of Intelligence."
            );
            infoMap.set("infoNightperson", 
                "Gain +1, +2 or +3 Intelligence and Perception between 6 PM and 6 AM. Perception perk."
            );

            infoMap.set("infoFoodMutation", 
                "Doubles the effect of meat-based (carnivore) or plant-based (herbivore) consumables."
            );
            infoMap.set("infoRest", 
                "+5% XP. Includes Well Rested, Kindred Spirit and Lover's Embrace (their duration vary only)."
            );
            infoMap.set("infoLiveandlove", 
                "+5% XP while in a team."
            );
            infoMap.set("infoHealingFactor",
                "Chem effects are reduced by 55%. The Class Freak perk can change this to 41.25, 27.5 or 13.75%."
            );

            appendInfo("infoLegendaryInt", "infoLegendaryInt");
            appendInfo("infoPlayerHealth", "infoPlayerHealth");
            appendInfo("infoEgghead", "infoEgghead");
            appendInfo("infoClassFreak", "infoClassFreak");
            appendInfo("infoHerdMentality", "infoHerdMentality");
            appendInfo("infoFoodDrink", "infoFoodDrink");
            appendInfo("infoBobbleheadInt", "infoBobbleheadInt");
            appendInfo("infoColaNut", "infoColaNut");
            appendInfo("infoFoodDrinkXP", "infoFoodDrinkXP");
            appendInfo("infoLeader", "infoLeader");
            appendInfo("infoMothman", "infoMothman");
            appendInfo("infoTeamType", "infoTeamType");
            appendInfo("infoInspirational", "infoInspirational");
            appendInfo("infoTeamBuilder", "infoTeamBuilder");
            appendInfo("infoTeamEvent", "infoTeamEvent");
            appendInfo("infoTeamHunter", "infoTeamHunter");
            appendInfo("infoStrange", "infoStrange");
            appendInfo("infoLunchbox", "infoLunchbox");
            appendInfo("infoTotalXP", "infoTotalXP");
            appendInfo("infoOverallXP", "infoOverallXP");
            appendInfo("infoNightperson", "infoNightperson");
            appendInfo("infoMarsupial", "infoMarsupial");
            appendInfo("infoFoodMutation", "infoFoodMutation");
            appendInfo("infoChem", "infoChem");
            appendInfo("infoRest", "infoRest");
            appendInfo("infoLiveandlove", "infoLiveandlove");
            appendInfo("infoHealingFactor", "infoHealingFactor");


            function appendInfo(id, key) {
                document.getElementById(id).innerHTML += info(key);
            }

            function stripHTML(txt) {
                return txt.replace(/\<br\>/g, "\r\n")
                        .replace(/\<b\>/g, "")
                        .replace(/\<\/b\>/g, "")
                ;
            }

            // add HTML explanation marker
            function info(name) {
                return "&nbsp;<sup><a href='#' style='font-size: 14; font-weight: bold;' onclick='showinfo(this, \"" + name + "\"); return false;' title=\""
                + stripHTML(infoMap.get(name)) + "\">?</a></sup>";
            }

            // popup for explanation
            function showinfo(target, name) {
                var div = document.getElementById("InfoDiv" + name);
                if (div == null) {
                    var div = document.createElement("div");
                    div.style.border = "1px solid black";
                    div.style.padding = "3px";
                    div.style.position = "absolute";
                    div.style.backgroundColor = "#FFFFD0";
                    div.style.zIndex = 99;
                    div.id = "InfoDiv" + name;
                    var txt = infoMap.get(name);

                    if (txt == null) {
                        txt = "??? " + name + " ???";
                    }
                    txt += "<hr><font style='font-size: 14px'>Click to close.</font>";
                    div.innerHTML = txt;

                    target.parentElement.appendChild(div);
                    div.onclick = function() {
                        target.parentElement.removeChild(div);
                    }
                } else {
                    target.parentElement.removeChild(div);
                }
            }

            function valueOf(id) {
                var node = get(id);

                if (node.selectedIndex !== undefined) {
                    return node.options[node.selectedIndex].value;
                }
                if (node.type !== undefined) {
                    if (node.type === "checkbox" || node.type === "radio") {
                        return node.checked;
                    }
                    if (node.type === "number") {
                        return parseInt(node.value);
                    }
                }
                return "";
            }

            for (var e of document.getElementsByTagName("input")) {
                if (e.id !== "bobbleheadInt" && e.id !== "bobbleheadLeader") {
                    e.oninput = calculate;
                }
            }
            for (var e of document.getElementsByTagName("select")) {
                e.oninput = calculate;
            }

            var cbBobbleheadInt = document.getElementById("bobbleheadInt");
            var cbBobbleheadLeader = document.getElementById("bobbleheadLeader");
            cbBobbleheadInt.oninput = function() {
                if (cbBobbleheadInt.checked) {
                    cbBobbleheadLeader.checked = false;
                }
                calculate();
            };
            cbBobbleheadLeader.oninput = function() {
                if (cbBobbleheadLeader.checked) {
                    cbBobbleheadInt.checked = false;
                }
                calculate();
            };

            function get(id) {
                return document.getElementById(id);
            }

            function cap(value, min, max) {
                if (isNaN(value) || value < min) {
                    return min;
                }
                if (value > max) {
                    return max;
                }
                return value;
            }

            function unyieldBonus(health) {
                if (health < 25) {
                    return 3;
                }
                if (health < 50) {
                    return 2;
                }
                if (health < 75) {
                    return 1;
                }
                return 0;
            }

            function calculate() {

                var int = cap(valueOf("baseint"), 1, 15);
                var xp = [];

                int += cap(valueOf("legendaryint"), 0, 5);

                // PERKS ================================================
                
                var strange = valueOf("strange");
                var nightperson = valueOf("nightperson");
                var classFreak = valueOf("classFreak");
                var colaNut = valueOf("colaNut");
                var inspire = valueOf("inspirational");

                if (nightperson == "1") {
                    int += 1;
                }
                else if (nightperson == "2") {
                    int += 2;
                }
                else if (nightperson == "3") {
                    int += 3;
                }

                // MUTATIONS ================================================


                var isEgghead = valueOf("egghead");
                if (isEgghead) {
                    if (strange) {
                        int += 8;
                    } else {
                        int += 6;
                    }
                }

                var isHerd = valueOf("herdmentality");
                if (isHerd) {
                    if (strange) {
                        int += 3;
                    } else {
                        int += 2;
                    }
                }
                
                var isMarsupial = valueOf("marsupial");
                if (isMarsupial) {
                    if (classFreak == "1") {
                        int -= 3;
                    }
                    else if (classFreak == "2") {
                        int -= 2;
                    }
                    else if (classFreak == "3") {
                        int -= 1;
                    }
                    else {
                        int -= 4;
                    }
                }

                // ARMOR ================================================
                var hp = cap(valueOf("playerhealth"), 1, 100);

                for (var part of ["torso", "leftArm", "rightArm", "leftLeg", "rightLeg"]) {
                    if (valueOf(part + "Unyield")) {
                        int += unyieldBonus(hp);
                    }
                    if (valueOf(part + "Int")) {
                        int++;
                    }
                }

                if (valueOf("internalDb")) {
                    int += 2;
                }

                var underarmor = valueOf("underarmor");
                if (underarmor != "") {
                    int += parseInt(underarmor.substring(underarmor.length - 1));
                }


                // CONSUMABLES ==========================================

                var foodMutate = valueOf("foodMutation");
                var herbivoreBuff = 1;
                if (foodMutate == "Herbivore") {
                    if (strange) {
                        herbivoreBuff = 2 * 1.25;
                    } else {
                        herbivoreBuff = 2;
                    }
                }
                var carnivoreBuff = 1;
                if (foodMutate == "Carnivore") {
                    if (strange) {
                        carnivoreBuff = 2 * 1.25;
                    } else {
                        carnivoreBuff = 2;
                    }
                }

                var foodInt = valueOf("foodInt");
                if (foodInt != "") {
                    if (foodInt == "SBBrain") {
                        int += carnivoreBuff * 3;
                    }
                    if (foodInt == "BrainBombs") {
                        int += herbivoreBuff * 3;
                    }
                    if (foodInt == "TatoFlowerTea") {
                        int += 2;
                    }
                    if (foodInt == "StapledAsterTea") {
                        int += 2;
                    }
                    if (foodInt == "BrainFungusSoup") {
                        int += herbivoreBuff * 2;
                    }
                    if (foodInt == "OwletNuggets") {
                        int += carnivoreBuff * 1;
                    }
                    if (foodInt == "SBStew") {
                        int += carnivoreBuff * 1;
                    }
                    if (foodInt == "SimpleAsterTea") {
                        int++;
                    }
                    if (foodInt == "Alcohol") {
                        int--;
                    }
                }

                var healingFactor = valueOf("healingfactor");
                var chemBuffMultiply = 1;
                if (healingFactor) {
                    var debuff = 0.55;
                    if (classFreak == '1') {
                        debuff *= 0.75;
                    }
                    if (classFreak == '2') {
                        debuff *= 0.5;
                    }
                    if (classFreak == '3') {
                        debuff *= 0.25;
                    }
                    chemBuffMultiply = 1 - debuff;
                }

                var chemInt = valueOf("chemInt");
                if (chemInt != "") {
                    if (chemInt == "BerryMentats") {
                        int += 5 * chemBuffMultiply;
                    }
                    if (chemInt == "DaddyO") {
                        int += 3 * chemBuffMultiply;
                    }
                    if (chemInt == "XCell") {
                        int += 2 * chemBuffMultiply;
                    }
                    if (chemInt == "Mentats") {
                        int += 2 * chemBuffMultiply;
                    }
                }

                if (valueOf("bobbleheadInt")) {
                    int += 2;
                }

                // XP BOOSTERS =============================================

                var foodXP = valueOf("foodXP");
                if (foodXP == "CranberryCobbler") {
                    xp.push(herbivoreBuff * 5);
                }
                if (foodXP == "CranberryRelish") {
                    xp.push(herbivoreBuff * 10);
                }
                if (foodXP == "CannedMeatStew") {
                    xp.push(carnivoreBuff * 5);
                }
                if (foodXP == "TastySquirrelStew") {
                    xp.push(carnivoreBuff * 10);
                }
                if (foodXP == "NukaCranberry") {
                    if (colaNut == "1") {
                        xp.push(4);
                    }             
                    else if (colaNut == "2") {
                        xp.push(6);
                    }
                    else {
                        xp.push(2);
                    }
                }

                if (valueOf("bobbleheadLeader")) {
                    xp.push(5);
                }
                if (valueOf("eventMothman")) {
                    xp.push(5);
                }
                
                var community = valueOf("community");
                if (community == "DoubleXP") {
                    xp.push(100);
                }
                if (community == "TripleXP") {
                    xp.push(200);
                }

                var lunchbox = valueOf("lunchbox");
                if (lunchbox != "") {
                    xp.push(25 * parseInt(lunchbox));
                }
                var wellrested = valueOf("wellrested");
                if (wellrested != "") {
                    xp.push(5);
                }

                // TEAM EFFECTS ===============================

                var teamType = valueOf("teamType");
                var eventBonus = 0;
                var hunterBonus = 0;

                if (teamType == "public") {
                    var teamBuilder = valueOf("teamBuilder");
                    if (teamBuilder != "") {
                        int += parseInt(teamBuilder);
                    }

                    var teamEvent = valueOf("teamEvent");
                    if (teamEvent != "") {
                        eventBonus = parseInt(teamEvent);
                    }

                    var teamHunter = valueOf("teamHunter");
                    if (teamHunter != "") {
                        hunterBonus = parseInt(teamHunter);
                    }
                }

                if (teamType != "") {
                    if (valueOf("liveandlove")) {
                        xp.push(5);                    
                    }
                    if (inspire != "") {
                        xp.push(parseInt(inspire) * 5);
                    }
                }
                // ----------------


                int = cap(int, 1, 100);

                var totalInt = get("totalInt");
                totalInt.innerText = "" + int.toFixed(2);

                get("totalIntPercent").innerText = (intToXp(int) * 100 - 100).toFixed(2) + " %";

                var productXP = 1;
                for (var x of xp) {
                    productXP *= 1 + x / 100;
                }

                var totalXP = get("totalXPBonus");
                totalXP.innerText = (productXP * 100 - 100).toFixed(2) + " %";

                var productXPEvent = productXP * (1 + eventBonus / 4);
                var totalXPEvent = get("totalXPBonusEvent");
                totalXPEvent.innerText = (productXPEvent * 100 - 100).toFixed(2) + " %";

                var productXPHunter = productXP * (1 + hunterBonus / 4);
                var totalXPHunter = get("totalXPBonusHunter");
                totalXPHunter.innerText = (productXPHunter * 100 - 100).toFixed(2) + " %";

                var totalXPBuff = productXP * intToXp(int);
                var totalXPBuffEvent = productXPEvent * intToXp(int);
                var totalXPBuffHunter = productXPHunter * intToXp(int);

                var totalBuff = get("totalXPBuff");
                totalBuff.innerText = (totalXPBuff * 100 - 100).toFixed(2) + " %";

                var totalBuffEvent = get("totalXPBuffEvent");
                totalBuffEvent.innerText = (totalXPBuffEvent * 100 - 100).toFixed(2) + " %";

                var totalBuffHunter = get("totalXPBuffHunter");
                totalBuffHunter.innerText = (totalXPBuffHunter * 100 - 100).toFixed(2) + " %";

                generateLink();
                populateEnemies(totalXPBuff, totalXPBuffHunter);
                populateEvents(totalXPBuff, totalXPBuffEvent);
            }

            function populateEnemies(normalXP, legendaryXP) {
                var tbl = get("enemyTable");

                for (var i = tbl.rows.length - 1; i > 1; i--) {
                    tbl.deleteRow(i);
                }

                var enemy = get("enemy");
                if (enemy.selectedIndex > 0) {
                    var opt = enemy.options[enemy.selectedIndex];

                    for (var lvl of opt.levels) {
                        var xpBase = opt.xp(lvl);

                        var rw = tbl.insertRow(tbl.rows.length);
                        var cll = rw.insertCell(rw.cells.length);
                        cll.innerText = "" + lvl;
                        cll.style.textAlign = "right";

                        cll = rw.insertCell(rw.cells.length);
                        cll.innerText = "" + xpBase.toFixed(1);
                        cll.style.textAlign = "right";

                        cll = rw.insertCell(rw.cells.length);
                        cll.innerText = "" + Math.floor(xpBase * normalXP);
                        cll.style.textAlign = "right";

                        cll = rw.insertCell(rw.cells.length);
                        cll.innerText = "" + Math.floor(xpBase * legendaryXP);
                        cll.style.textAlign = "right";
                    }
                } else {
                    var rw = tbl.insertRow(tbl.rows.length);
                    var cll = rw.insertCell(0);
                    cll.colSpan = '4';
                    cll.style.textAlign = "center";
                    cll.style.fontStyle = "italic";
                    cll.innerText = "Select an enemy.";
                }
            }


            function populateEvents(normalXP, eventXP) {
                var tbl = get("eventTable");

                for (var i = tbl.rows.length - 1; i > 1; i--) {
                    tbl.deleteRow(i);
                }

                var enemy = get("event");
                if (enemy.selectedIndex > 0) {
                    var opt = enemy.options[enemy.selectedIndex];

                    var nukalink = get("eventnukacrypt");
                    if (opt.formid !== undefined) {
                        nukalink.href = "https://nukacrypt.com/database/json/" + opt.formid;
                    } else {
                        nukalink.href = "https://nukacrypt.com/search";
                    }

                    for (var cond of opt.conditions) {
                        var rw = tbl.insertRow(tbl.rows.length);
                        var cll = rw.insertCell(rw.cells.length);
                        cll.innerText = "" + cond.name;

                        var xpBase = cond.xp;

                        cll = rw.insertCell(rw.cells.length);
                        cll.innerText = "" + Math.floor(xpBase);
                        cll.style.textAlign = "right";

                        cll = rw.insertCell(rw.cells.length);
                        cll.innerText = "" + Math.floor(xpBase * normalXP);
                        cll.style.textAlign = "right";

                        cll = rw.insertCell(rw.cells.length);
                        cll.innerText = "" + Math.floor(xpBase * eventXP);
                        cll.style.textAlign = "right";
                    }
                } else {
                    var rw = tbl.insertRow(tbl.rows.length);
                    var cll = rw.insertCell(0);
                    cll.colSpan = '4';
                    cll.style.textAlign = "center";
                    cll.style.fontStyle = "italic";
                    cll.innerText = "Select an event.";
                }
            }

            function generateLink() {
                var lnk = get("thelink");

                var txt = [];

                for (var e of document.getElementsByTagName("input")) {
                    if (e.type === "radio" || e.type === "checkbox") {
                        if (e.checked) {
                            txt.push(e.id + "=true");
                        }
                    } else {
                        txt.push(e.id + "=" + e.value);
                    }
                }
                for (var e of document.getElementsByTagName("select")) {
                    if (e.selectedIndex > 0) {
                        txt.push(e.id + "=" + e.options[e.selectedIndex].value);
                    }
                }

                lnk.href = "?" + txt.join("&");
            }

            function intToXp(int) {
                return 1 + 3 * int / 100;
            }

            var q = location.search;
            if (q.length > 1) {
                if (q.startsWith("?")) {
                    q = q.substring(1);
                }
                var params = q.split("&");

                for (var p of params) {
                    var kv = p.split("=");

                    var ctrl = get(kv[0]);
                    if (ctrl != null) {
                        if (ctrl.selectedIndex !== undefined) {
                            for (var opt of ctrl.options) {
                                if (opt.value == kv[1]) {
                                    opt.selected = true;
                                    break;
                                }
                            }
                        }
                        else if (kv[1] == "true") {
                            ctrl.checked = true;
                        }
                        else {
                            ctrl.value = kv[1];
                        }
                    }
                }
            }

            calculate();
        </script>
    </body>
</html>